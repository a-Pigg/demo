"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[1121],{22754:function(e,t,i){i.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"attc"},[t("ul",{staticClass:"upload-files"},e._l(e.files,(function(i,s){return t("li",{key:s,staticClass:"upload-files-item"},[t("i",{staticClass:"el-icon-paperclip"}),t("span",{staticClass:"file-name"},[e._v(e._s(i.name))]),t("div",{staticClass:"icons"},[t("i",{staticClass:"el-icon-download",on:{click:function(t){return e.downloadFile(i)}}}),t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.deleteFile(s)}}})])])})),0),t("div",{directives:[{name:"show",rawName:"v-show",value:e.files.length<5,expression:"files.length < 5"}],staticClass:"upload-btn"},[t("i",{staticClass:"el-icon-upload"}),t("span",{staticClass:"tips"},[e._v(e._s(e.$t("h.uploadAssetAttachments")))]),t("input",{ref:"uploadFileRef",attrs:{type:"file",id:"upload-file"},on:{change:e.handleFileChange}})])])},a=[],l=(i(57658),i(20629)),r=i(79992),o={data(){return{}},props:{value:{type:Array,default:()=>[]}},computed:{...(0,l.rn)(["maxLimit"]),files:{get(){return this.value},set(e){this.$emit("update:value",e)}}},methods:{handleFileChange(e){const t=e.target.files[0];if(this.maxLimit.pictureSize&&t.size>1024*this.maxLimit.pictureSize)return this.$message.error(`${this.$t("h.tips19")}${this.maxLimit.pictureSize}kb`);(0,r.sT)(t).then((e=>{this.$refs.uploadFileRef.value="",this.files.push({name:t.name,type:t.name.slice(t.name.lastIndexOf(".")),base64:e})})).catch((()=>{this.$refs.uploadFileRef.value="",this.$message.error(this.$t("h.tips20"))}))},deleteFile(e){this.files.splice(e,1)},downloadFile(e){(0,r.M)(e.base64,"_blank",e.name)}}},n=o,d=i(1001),c=(0,d.Z)(n,s,a,!1,null,"69b17a0f",null),u=c.exports},93237:function(e,t,i){i.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.fileValue,expression:"!fileValue"}],staticClass:"upload-btn"},[t("input",{ref:"uploadInputRef",attrs:{type:"file",id:"upload-btn-input",accept:"image/*"},on:{change:e.handlePhotoChange}}),t("i",{staticClass:"el-icon-plus"})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.fileValue,expression:"fileValue"}],staticClass:"upload-img"},[t("button",{staticClass:"close-btn",on:{click:e.deletePhotpFile}},[t("i",{staticClass:"el-icon-close"})]),t("img",{attrs:{src:e.fileValue,alt:""}})])])},a=[],l=i(20629),r=i(79992),o={data(){return{}},computed:{...(0,l.rn)(["maxLimit"]),fileValue:{get(){return this.value},set(e){this.$emit("update:value",e)}}},props:{value:{type:String,default:""}},methods:{handlePhotoChange(e){let t=e.target.files[0];return 0!=t.type.indexOf("image")?this.$message.error(this.$t("h.tips21")):this.maxLimit.pictureSize&&t.size>1024*this.maxLimit.pictureSize?this.$message.error(`${this.$t("h.tips19")}${this.maxLimit.pictureSize}kb`):void(0,r.sT)(t).then((e=>{this.fileValue=e})).catch((()=>{this.deletePhotpFile(),this.$message.error(this.$t("h.tips20"))}))},deletePhotpFile(e){e.preventDefault(),this.fileValue="",this.$refs.uploadInputRef.value=""}}},n=o,d=i(1001),c=(0,d.Z)(n,s,a,!1,null,"4fe71eb7",null),u=c.exports},98884:function(e,t,i){i.d(t,{Z:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"dialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.title))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.dialogVisible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("ds-table",{attrs:{tableData:e.deleteErrorData,columns:e.deleteColumns,tableConfig:e.errorTableConfig}})],1)])},a=[],l=i(60983),r={components:{DsTable:l.Z},data(){return{errorTableConfig:{index:!0}}},props:{deleteDialogVisible:{type:Boolean,default:!1},deleteErrorData:{type:Array,default:()=>[]},deleteColumns:{type:Array},title:{type:String,default:"删除失败详情"}},computed:{dialogVisible:{get(){return this.deleteDialogVisible},set(e){this.$emit("update:deleteDialogVisible",e)}}},methods:{dialogVisibleClosed(){this.$emit("closed")}}},o=r,n=i(1001),d=(0,n.Z)(o,s,a,!1,null,"3e3e8f93",null),c=d.exports},88048:function(e,t,i){i.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.fileValue,expression:"!fileValue"}],staticClass:"upload-btn"},[t("input",{ref:"uploadInputRef",attrs:{type:"file",id:"upload-btn-input",accept:"image/*"},on:{change:e.handlePhotoChange}}),t("i",{staticClass:"el-icon-plus"})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.fileValue,expression:"fileValue"}],staticClass:"upload-img"},[t("button",{staticClass:"close-btn",on:{click:e.deletePhotpFile}},[t("i",{staticClass:"el-icon-close"})]),t("img",{attrs:{src:e.fileValue,alt:""}})])])},a=[],l=i(20629),r=i(79992),o={data(){return{}},computed:{...(0,l.rn)(["maxLimit"]),fileValue:{get(){return this.value},set(e){this.$emit("update:value",e)}}},props:{value:{type:String,default:""}},methods:{handlePhotoChange(e){let t=e.target.files[0];return 0!=t.type.indexOf("image")?this.$message.error(this.$t("h.tips21")):this.maxLimit.pictureSize&&t.size>1024*this.maxLimit.pictureSize?this.$message.error(`${this.$t("h.tips19")}${this.maxLimit.pictureSize}kb`):void(0,r.sT)(t).then((e=>{this.fileValue=e})).catch((()=>{this.deletePhotpFile(),this.$message.error(this.$t("h.tips20"))}))},deletePhotpFile(e){e.preventDefault(),this.fileValue="",this.$refs.uploadInputRef.value=""}}},n=o,d=i(1001),c=(0,d.Z)(n,s,a,!1,null,"7d478ed2",null),u=c.exports},66126:function(e,t,i){i.d(t,{Z:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"upload"},[e.fileValue.value?t("div",{staticClass:"upload-icon"},[t("button",{staticClass:"close-btn",on:{click:e.cancalUploadFile}},[t("i",{staticClass:"el-icon-close"})]),t("i",{staticClass:"el-icon-document"}),t("h5",{staticClass:"file-name"},[e._v(e._s(e.fileValue.name))])]):t("div",{staticClass:"upload-btn"},[t("input",{ref:"uploadInputRef",attrs:{type:"file",id:"upload-btn-input",accept:".xlsx, .xls"},on:{change:e.handleFileChange}}),t("i",{staticClass:"el-icon-plus"})])])},a=[],l=i(79992),r={data(){return{}},props:{value:{type:Object,default:()=>({value:"",name:""})},loading:{type:Boolean,default:!1}},computed:{fileValue:{get(){return this.value},set(e){this.$emit("update:value",e)}}},methods:{handleFileChange(e){const t=e.target.files[0].type,i="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",s="application/vnd.ms-excel";let a=!0;t!==i&&t!==s&&(a=!1);let r=!0,o=this.getFileExtension(e.target.files[0].name);if("xls"!=o&&"xlsx"!=o&&(r=!1),!a&&!r)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips108")});(0,l.sT)(e.target.files[0]).then((t=>{this.fileValue.value=t,this.fileValue.name=e.target.files[0].name})).catch((()=>{this.cancalUploadFile(),this.$message.error(this.$t("h.tips109"))}))},cancalUploadFile(e){e.preventDefault(),this.fileValue.value="",this.fileValue.name=""},getFileExtension(e){return e.split(".").pop()}}},o=r,n=i(1001),d=(0,n.Z)(o,s,a,!1,null,"09bbdb75",null),c=d.exports},75916:function(e,t,i){i.r(t),i.d(t,{default:function(){return W}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"received"},[t("el-card",{staticClass:"received-card"},[t("div",{staticClass:"received-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{type:"primary",size:"small"}},[e._v(" "+e._s(e.$t("h.newBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.newReceivedBill.apply(null,arguments)}}},[e._v(e._s(e.$t("h.newEnterWareBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.bulkReceivedBill.apply(null,arguments)}}},[e._v(e._s(e.$t("h.bulkBtn")))])],1)],1),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.editBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.editReceivedBill.apply(null,arguments)}}},[e._v(e._s(e.$t("h.changeBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.deleteReceivedBills.apply(null,arguments)}}},[e._v(e._s(e.$t("h.delBtn")))])],1)],1),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.printBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.goPrintBills.apply(null,arguments)}}},[e._v(e._s(e.$t("h.printDoucmentBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.openPrintSet.apply(null,arguments)}}},[e._v(e._s(e.$t("h.tempSetBtn")))])],1)],1),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.billsExportDialogVisible=!0}}},[e._v(e._s(e.$t("h.exportBtn")))])],1),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.findAssetSearch}})],1)],1)],1),t("div",{staticClass:"received-card-content"},[t("div",{staticClass:"bills-filter"},[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}}),t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.filterDrawerVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"bills-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.tableLoading,tableData:e.receivedBills,columns:e.receivedBillsColumns,tableConfig:e.receivedTableConfig,rowKey:e=>e._id},on:{handleSelectionChange:e.handleSelectionChange,checkTableRowDetail:e.checkBillDetail},scopedSlots:e._u([{key:"operation",fn:function({scope:i}){return[t("el-popover",{ref:`uploadPopoverRef-${i.row._id}`,attrs:{placement:"left",width:"100"},on:{"after-leave":e.billPopAsterLeave}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.uploadImgLoading,expression:"uploadImgLoading"}],staticClass:"popover-cotent"},[t("upload-photo",{attrs:{value:e.billPhotoFile},on:{"update:value":function(t){e.billPhotoFile=t}}}),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.uploadBillPhoto(i.row)}}},[e._v(e._s(e.$t("h.confirmUpload")))])],1),t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v(e._s(e.$t("h.uploadVouchers")))])],1)]}}])})],1),t("div",{staticClass:"bills-pagination",attrs:{loading:e.tableLoading}},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getReceivedBills}})],1)])]),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{contentWidth:"95%",title:e.newBillTitle,newBillsDialogVisible:e.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},opened:e.newBillsDialogOpened,close:e.newBillsDialogClose,sbumitForm:e.sbumitReceivedForm}},[t("template",{slot:"form"},[t("el-row",{attrs:{gutter:45}}),t("el-form",{ref:"receivedFormRef",attrs:{"label-width":"80px",model:e.receivedForm,rules:e.receivedFormRules}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.enteringWarehouseDate"),prop:"date"}},[t("el-date-picker",{attrs:{type:"date",placeholder:e.$t("h.tips4")+e.$t("h.enteringWarehouseDate"),clearable:"","value-format":"yyyy-MM-dd"},model:{value:e.receivedForm.date,callback:function(t){e.$set(e.receivedForm,"date",t)},expression:"receivedForm.date"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.creationDate"),prop:"estaDate"}},[t("el-date-picker",{attrs:{disabled:"",type:"date"},model:{value:e.receivedForm.estaDate,callback:function(t){e.$set(e.receivedForm,"estaDate",t)},expression:"receivedForm.estaDate"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.receivedForm.staffName,callback:function(t){e.$set(e.receivedForm,"staffName",t)},expression:"receivedForm.staffName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.source"),prop:"source"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.source"),clearable:"",filterable:""},model:{value:e.receivedForm.source,callback:function(t){e.$set(e.receivedForm,"source",t)},expression:"receivedForm.source"}},e._l(e.sourceListData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.assetAttributes"),prop:"goodsId"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.assetAttributes"),clearable:"",filterable:""},model:{value:e.receivedForm.goodsId,callback:function(t){e.$set(e.receivedForm,"goodsId",t)},expression:"receivedForm.goodsId"}},e._l(e.goodsListData,(function(e){return t("el-option",{key:e.goodsqId,attrs:{label:e.name,value:e.goodsqId}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.comment"),prop:"assertBeizhu"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:e.$t("h.tips3")+e.$t("h.comment")},model:{value:e.receivedForm.assertBeizhu,callback:function(t){e.$set(e.receivedForm,"assertBeizhu",t)},expression:"receivedForm.assertBeizhu"}})],1)],1)],1)],1),t("template",{slot:"btns"},[t("div",[t("span",{staticClass:"title"},[e._v(e._s(e.$t("h.title17")))])])]),t("template",{slot:"table"},[t("div",{staticClass:"bill-table"},[t("edit-table",{attrs:{columns:e.editColumns,data:e.receivedAssets,depts:e.depts}})],1)])],2),t("new-bills-dialog",{staticClass:"bulk-bill-dialog",attrs:{newBillsDialogVisible:e.bulkBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.bulkBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.bulkBillsDialogVisible=t},opened:e.bulkBillsDialogOpened,close:e.bulkBillsDialogClose,sbumitForm:e.sbumitBulkReceivedForm}},[t("template",{slot:"form"},[t("el-row",{attrs:{gutter:45}}),t("el-form",{ref:"bulkReceivedFormRef",attrs:{"label-width":"80px",model:e.receivedForm,rules:e.receivedFormRules}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.enteringWarehouseDate"),prop:"date"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:e.$t("h.tips4")+e.$t("h.enteringWarehouseDate"),clearable:"","value-format":"yyyy-MM-dd"},model:{value:e.receivedForm.date,callback:function(t){e.$set(e.receivedForm,"date",t)},expression:"receivedForm.date"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.creationDate"),prop:"estaDate"}},[t("el-date-picker",{attrs:{disabled:"",type:"date"},model:{value:e.receivedForm.estaDate,callback:function(t){e.$set(e.receivedForm,"estaDate",t)},expression:"receivedForm.estaDate"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.receivedForm.staffName,callback:function(t){e.$set(e.receivedForm,"staffName",t)},expression:"receivedForm.staffName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.source"),prop:"source"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.source"),clearable:"",filterable:""},model:{value:e.receivedForm.source,callback:function(t){e.$set(e.receivedForm,"source",t)},expression:"receivedForm.source"}},e._l(e.sourceListData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.assetAttributes"),prop:"goodsId"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.assetAttributes"),clearable:"",filterable:""},model:{value:e.receivedForm.goodsId,callback:function(t){e.$set(e.receivedForm,"goodsId",t)},expression:"receivedForm.goodsId"}},e._l(e.goodsListData,(function(e){return t("el-option",{key:e.goodsqId,attrs:{label:e.name,value:e.goodsqId}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.comment"),prop:"assertBeizhu"}},[t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.comment")},model:{value:e.receivedForm.assertBeizhu,callback:function(t){e.$set(e.receivedForm,"assertBeizhu",t)},expression:"receivedForm.assertBeizhu"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.assetFiles")}},[t("upload-excel-base64",{attrs:{value:e.file},on:{"update:value":function(t){e.file=t}}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.downloadImportFile}},[e._v(e._s(e.$t("h.tips11")))])],1)],1)],1)],2),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.filterDrawerVisible},on:{"update:filterDrawerVisible":function(t){e.filterDrawerVisible=t},"update:filter-drawer-visible":function(t){e.filterDrawerVisible=t},submitFilterForm:e.submitFilterForm,resetFilterForm:e.resetFilterForm}},[t("el-form",{ref:"filterFormRef",attrs:{"label-width":"100px",model:e.filterForm}},[t("el-form-item",{attrs:{label:e.$t("h.enteringWarehouseDate"),prop:"date"}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.filterForm.date,callback:function(t){e.$set(e.filterForm,"date",t)},expression:"filterForm.date"}})],1),t("el-form-item",{attrs:{label:e.$t("h.assetAttributes"),prop:"goodsId"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4")+e.$t("h.assetAttributes"),clearable:"",filterable:""},model:{value:e.filterForm.goodsId,callback:function(t){e.$set(e.filterForm,"goodsId",t)},expression:"filterForm.goodsId"}},e._l(e.goodsListData,(function(e){return t("el-option",{key:e.goodsqId,attrs:{label:e.name,value:e.goodsqId}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.auditStatus"),prop:"status"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4")+e.$t("h.auditStatus"),clearable:"",filterable:""},model:{value:e.filterForm.status,callback:function(t){e.$set(e.filterForm,"status",t)},expression:"filterForm.status"}},e._l(e.statusListData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.createDepartment"),prop:"deptId"}},[t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.createDepartment"),collapseTags:"",multiple:!0,checkStrictly:!0,treeData:e.depts,defaultProps:e.deptTreeProps},model:{value:e.filterForm.deptId,callback:function(t){e.$set(e.filterForm,"deptId",t)},expression:"filterForm.deptId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffId"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.filterForm.staffId.join(","),searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: filterForm.staffId.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],ref:"highFilterStaffSelectref",attrs:{placeholder:e.$t("h.tips4")+e.$t("h.creator"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.filterForm.staffId,callback:function(t){e.$set(e.filterForm,"staffId",t)},expression:"filterForm.staffId"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1)],1)],1),t("bills-export-dialog",{attrs:{billsExportDialogVisible:e.billsExportDialogVisible,percentage:e.exportPercentage,step:e.exportStep,errorContent:e.exportErrorContent},on:{"update:billsExportDialogVisible":function(t){e.billsExportDialogVisible=t},"update:bills-export-dialog-visible":function(t){e.billsExportDialogVisible=t},submitExportForm:e.submitExportForm,close:e.billsExportDialogVisibleClose}},[t("el-form",{ref:"exportFormRef",attrs:{"label-width":"100px",model:e.exportForm}},[t("el-form-item",{attrs:{label:e.$t("h.enteringWarehouseDate"),prop:"date"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.exportForm.date,callback:function(t){e.$set(e.exportForm,"date",t)},expression:"exportForm.date"}})],1),t("el-form-item",{attrs:{label:e.$t("h.assetAttributes"),prop:"goodsId"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4")+e.$t("h.assetAttributes"),clearable:"",filterable:""},model:{value:e.exportForm.goodsId,callback:function(t){e.$set(e.exportForm,"goodsId",t)},expression:"exportForm.goodsId"}},e._l(e.goodsListData,(function(e){return t("el-option",{key:e.goodsqId,attrs:{label:e.name,value:e.goodsqId}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.auditStatus"),prop:"status"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4")+e.$t("h.auditStatus"),clearable:"",filterable:""},model:{value:e.exportForm.status,callback:function(t){e.$set(e.exportForm,"status",t)},expression:"exportForm.status"}},e._l(e.statusListData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.createDepartment"),prop:"deptId"}},[t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.createDepartment"),multiple:!0,checkStrictly:!0,treeData:e.depts,defaultProps:e.deptTreeProps,collapseTags:""},model:{value:e.exportForm.deptId,callback:function(t){e.$set(e.exportForm,"deptId",t)},expression:"exportForm.deptId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffId"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.exportForm.staffId.join(","),searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: exportForm.staffId.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],attrs:{placeholder:e.$t("h.tips4")+e.$t("h.creator"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.exportForm.staffId,callback:function(t){e.$set(e.exportForm,"staffId",t)},expression:"exportForm.staffId"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1)],1)],1),t("bill-detail-dialog",{attrs:{billDetailDialogVisible:e.billDetailDialogVisible,billFormDetail:e.billFormDetail,auditStep:e.auditStep},on:{"update:billDetailDialogVisible":function(t){e.billDetailDialogVisible=t},"update:bill-detail-dialog-visible":function(t){e.billDetailDialogVisible=t},closed:e.billDetailDialogVisibleClosed}},[t("template",{slot:"table"},[t("ds-table",{ref:"detailTableRef",attrs:{loading:e.detailLoading,tableData:e.detailAssets,columns:e.billAssetsColumns,tableConfig:e.detailConfig,rowKey:e=>e._id}})],1),t("template",{slot:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.detailTotal,page:e.detailPaginationForm.currentPage,limit:e.detailPaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.detailPaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.detailPaginationForm,"pageSize",t)},pagination:e.detailPagination}})],1)],2),t("ds-delete-detail",{attrs:{deleteDialogVisible:e.deleteDialogVisible,deleteColumns:e.deleteColumns,deleteErrorData:e.deleteErrorData},on:{"update:deleteDialogVisible":function(t){e.deleteDialogVisible=t},"update:delete-dialog-visible":function(t){e.deleteDialogVisible=t},closed:e.deleteDialogVisibleClosed}}),t("bill-print-template",{ref:"vptRef",attrs:{title:e.$t("h.title14"),selectId:e.receivedTemplateId,voucherPrintTempList:e.billPrintTemplate},on:{setVoucherTag:e.setBillPrintTemplate}}),t("bill-print-dialog",{ref:"vpdRef",attrs:{locationName:"receivedTemplateId",userInfo:e.userInfo,voucherData:e.selectReceivedBills,voucherPrintTemplate:e.billPrintTemplate}})],1)},a=[],l=(i(57658),i(76080)),r=i(20629),o=i(83151),n=i(79992),d=i(39622),c=i(55886),u=i(62887),h=i(93390),p=i(98884),m=i(60983),f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"editTableRef",attrs:{border:"","header-cell-class-name":"table-header","cell-class-name":"table-content",size:"medium",height:"100%",data:e.tableData}},[t("el-table-column",{attrs:{type:"index",align:"center",label:e.$t("h.index")}}),e._l(e.columns,(function(i){return t("el-table-column",{key:i.prop,attrs:{align:"center",width:i.width},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.isSet?t("span",["inData"==i.prop||"useDate"==i.prop||"maintainLast"==i.prop?t("el-date-picker",{attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"date",placeholder:e.$t("h.tips4")+i.label},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}}):"goalQuota"==i.prop?t("el-input",{attrs:{size:"mini"},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}},[t("span",{attrs:{slot:"append"},slot:"append"},[e._v("%")])]):"assertPosition"==i.prop?t("el-select",{attrs:{size:"mini",clearable:"",filterable:"",remote:"","remote-method":e.wareRemoteMethod},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}},e._l(e.wareData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.warehouseName,value:i.warehouseName}},[t("span",[e._v(" "+e._s(i.code)+" - "+e._s(i.warehouseName)+" ")])])})),1):"responsible"==i.prop?t("el-select",{ref:"staffSelectRef",refInFor:!0,attrs:{size:"mini",placeholder:"$t('h.tips4')",clearable:"",filterable:"",remote:"","remote-method":e.staffRemoteMethod},on:{change:function(t){return e.staffSelectChange(t,s.row)}},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i.name}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1):"operator"==i.prop?t("el-select",{attrs:{disabled:"",size:"mini",placeholder:"$t('h.tips4')",clearable:"",filterable:"",remote:"","remote-method":e.staffRemoteMethod},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i.name}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1):"type"==i.prop?t("edit-select-tree",{attrs:{value:s.row[i.prop],data:e.assetTypes,defaultProps:e.typeDefaultProps},on:{"update:value":function(t){return e.$set(s.row,i.prop,t)}}}):"useDept"==i.prop?t("edit-select-tree",{attrs:{value:s.row[i.prop],data:e.depts,defaultProps:e.deptDefaultProps},on:{"update:value":function(t){return e.$set(s.row,i.prop,t)},input:t=>{e.deptInput(t,s.row)}}}):"photo"==i.prop?t("upload-table-photo",{attrs:{value:s.row[i.prop]},on:{"update:value":function(t){return e.$set(s.row,i.prop,t)}}}):"file"==i.prop?t("upload-table-file",{attrs:{value:s.row[i.prop]},on:{"update:value":function(t){return e.$set(s.row,i.prop,t)}}}):"num"==i.prop?t("el-input",{attrs:{disabled:"",size:"mini"},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}}):t("el-input",{attrs:{size:"mini"},model:{value:s.row[i.prop],callback:function(t){e.$set(s.row,i.prop,t)},expression:"scope.row[item.prop]"}})],1):s.row.isSet||"photo"!=i.prop||""!=s.row[i.prop]?!s.row.isSet&&"photo"==i.prop&&s.row[i.prop]?t("div",{staticClass:"table-img"},[t("img",{attrs:{src:s.row[i.prop],alt:""}})]):s.row.isSet||"file"!=i.prop||""!=s.row[i.prop]?!s.row.isSet&&"file"==i.prop&&s.row[i.prop]?t("span",[t("el-popover",{attrs:{placement:"top-start"}},[e._l(s.row.file,(function(i,s){return t("div",{key:s},[t("a",{attrs:{href:i.base64,download:i.name}},[e._v(e._s(i.name))])])})),t("el-button",{attrs:{slot:"reference",size:"mini",type:"text"},slot:"reference"},[e._v(e._s(e.$t("h.viewAttachments")))])],2)],1):t("span",[e._v(e._s(s.row[i.prop]))]):t("span",[e._v(" "+e._s(e.$t("h.tableTips2"))+" ")]):t("span",[e._v(" "+e._s(e.$t("h.tableTips1"))+" ")])]}}],null,!0)},[t("template",{slot:"header"},[t("span",{class:i.class},[e._v(e._s(i.label))])])],2)})),t("el-table-column",{attrs:{align:"center",width:"250px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(i){return[i.row.isSet?t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.save(i.row,i.$index)}}},[e._v(e._s(e.$t("h.saveBtn")))]):t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.edit(i.row,i.$index)}}},[e._v(e._s(e.$t("h.editBtn")))]),i.row.isSet?e._e():t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.copy(i.row,i.$index)}}},[e._v(e._s(e.$t("h.copy")))]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleDelete(i.row,i.$index)}}},[e._v(e._s(e.$t("h.delBtn")))])]}}])},[t("template",{slot:"header"},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.add}},[e._v(e._s(e.$t("h.newBtn")))])],1)],2)],2)],1)},g=[],b=i(6214),v=i(93237),$=i(22754),F=function(){var e=this,t=e._self._c;return t("el-select",{attrs:{size:"mini",placeholder:e.$t("h.tips4"),clearable:"",filterable:"","filter-method":e.selectFilter},on:{clear:e.clearSelectValue,focus:e.focusSelect},model:{value:e.treeValue,callback:function(t){e.treeValue=t},expression:"treeValue"}},[t("el-option",{key:"x",attrs:{hidden:"",value:"x",label:"x"}}),e._l(e.options,(function(i){return t("el-option",{key:i[e.defaultProps["value"]],attrs:{hidden:"",label:i[e.defaultProps["label"]],value:i[e.defaultProps["value"]]}})})),t("el-tree",{ref:"treeRef",attrs:{"highlight-current":"",data:e.data,props:e.defaultProps,"node-key":e.nodeKey,"filter-node-method":e.treeFilterNode},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:i,data:s}){return[t("span",{staticClass:"tree-text"},[e._v(e._s(s.code+"-"+i.label))])]}}])})],2)},D=[],w={data(){return{options:[]}},props:{value:{type:String,default:""},data:{type:Array,default:()=>[]},defaultProps:{type:Object,default:()=>{}},nodeKey:{type:String,default:"_id"}},computed:{treeValue:{get(){return this.value},set(e){this.$emit("update:value",e)}}},methods:{handleNodeClick(e){this.options=[e],this.treeValue=e[this.defaultProps.value],this.$emit("input",e[this.defaultProps.value]),this.$refs.treeRef.setCurrentKey(e[this.defaultProps.value])},treeFilterNode(e,t){return!e||-1!==t[this.defaultProps.label].indexOf(e)},selectFilter(e){this.$refs.treeRef.filter(e)},clearSelectValue(){this.treeValue="",this.options=[],this.$refs.treeRef.setCurrentKey(null),this.$emit("input","")},focusSelect(){this.$refs.treeRef.filter("")}}},I=w,_=i(1001),x=(0,_.Z)(I,F,D,!1,null,"41606460",null),k=x.exports,y={components:{UploadTablePhoto:v.Z,UploadTableFile:$.Z,EditSelectTree:k},data(){return{assetTypes:[],typeDefaultProps:{children:"children",label:"classifyName",value:"classifyName"},deptDefaultProps:{children:"children",label:"deptName",value:"deptName"},wareData:[],staffData:[]}},props:{loading:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},depts:{type:Array,default:()=>[]}},computed:{...(0,r.rn)(["userInfo","assetFormHeader"]),tableData:{get(){return this.data},set(e){this.$emit("update:data",e)}},tableRules(){let e=[];return this.columns.forEach((t=>{t.class&&e.push(t.prop)})),e}},methods:{getAssetTypes(){(0,l.Ys)({func:"S0006",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{this.assetTypes=(0,c.M)(e.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},wareRemoteMethod(e){e?(0,l.Ys)({func:"S0003",userId:this.userInfo._id,token:this.userInfo.token,requstData:{andLike:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.wareData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))})):this.wareData=[]},staffRemoteMethod(e){e?(0,l.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{andLike:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.staffData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))})):this.staffData=[]},deptInput(e,t){if(!e)return!1;let i=this.staffData.filter((t=>t.deptName==e));if(i.length){let e=i.find((e=>e.name==t.responsible));e||(t.responsible="")}else t.responsible=""},staffSelectChange(e,t){if(!e)return!1;t.useDept=this.staffData[this.$refs.staffSelectRef[0]._data.hoverIndex].deptName},add(){let e={isSet:!0};this.columns.forEach((t=>{"num"==t.prop?e[t.prop]=1:"file"==t.prop?e[t.prop]=[]:"operator"==t.prop?e[t.prop]=this.userInfo.staffName:e[t.prop]=""})),this.tableData.push(e)},edit(e){console.log(e),e.isSet=!0,this.$refs.editTableRef.doLayout()},handleDelete(e,t){this.tableData.splice(t,1)},save(e){for(let t=0;t<this.tableRules.length;t++)if(!e[this.tableRules[t]])return this.$message.error(this.$t("h.tips23"));if(e.goalQuota&&!b.M.goalQuota.test(e.goalQuota))return this.$message.error(this.$t("h.tips24"));if(e.money&&!b.M.money.test(e.money))return this.$message.error(this.$t("h.tips25"));if(e.assetCode){let t=this.tableData.filter((t=>t.assetCode==e.assetCode)).length;if(t>1)return this.$message.error(this.$t("h.tips26"))}e.isSet=!1,this.$refs.editTableRef.doLayout()},copy(e){let t=JSON.parse(JSON.stringify(e));t.isSet=!0,this.tableData.push(t)}},created(){this.getAssetTypes()}},S=y,B=(0,_.Z)(S,f,g,!1,null,"78bcf9c4",null),C=B.exports,R=i(66403),V=i(17817),P=i(19698),T=i(52086),N=i(93082),L=i(5791),z=i(42041),A=i(78067),E=i(22931),Z=i(92003),j=i(89782),M=i(66126),q=i(88048),O={components:{BillPrintDialog:u.Z,BillPrintTemplate:h.Z,DsDeleteDetail:p.Z,DsTable:m.Z,EditTable:C,DsFilterTag:V.Z,DsSearchBtn:R.Z,DsQueryForm:P.Z,DsSelectTree:T.Z,DsPagination:N.Z,NewBillsDialog:z.Z,DsFilterDrawer:L.Z,BillDetailDialog:A.Z,BillsExportDialog:E.Z,DsQueryFormLeftPanel:Z.Z,DsQueryFormRightPanel:j.Z,UploadExcelBase64:M.Z,UploadPhoto:q.Z},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},tableLoading:!1,receivedBillsColumns:o.Dp,receivedTableConfig:{selection:!0,reserveSelection:!0},receivedBills:[],selectReceivedBills:[],filterDrawerVisible:!1,deptTreeProps:{value:"_id",label:"deptName",children:"children"},depts:[],deptListData:[],highFilterTags:[],filterForm:{staffId:[],deptId:[],status:[],date:[],goodsId:[]},andLike:"",newBillsDialogVisible:!1,newBillTitle:this.$t("h.title12"),dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},sourceListData:o.vr,statusListData:o.k0,goodsListData:[],staffData:[],receivedForm:{_id:null,date:"",estaDate:(0,n.X$)(),staffName:"",deptId:"",assertBeizhu:"",source:"",goodsId:""},receivedFormRules:{date:[{required:!0,message:this.$t("h.tips4")+" "+this.$t("h.enteringWarehouseDate"),trigger:"change"}],source:[{required:!0,message:this.$t("h.tips4")+" "+this.$t("h.source"),trigger:"change"}],goodsId:[{required:!0,message:this.$t("h.tips4")+" "+this.$t("h.assetAttributes"),trigger:"change"}]},receivedAssets:[],billsExportDialogVisible:!1,exportPercentage:0,exportStep:"",exportErrorContent:"",exportForm:{date:[],goodsId:[],status:[],deptId:[],staffId:[]},billDetailDialogVisible:!1,billFormDetail:[],auditStep:[],detailLoading:!1,detailMatchAssets:[],detailAssets:[],detailConfig:{},detailTotal:0,detailPaginationForm:{currentPage:1,pageSize:20},file:{value:"",name:""},uploadImgLoading:!1,billPhotoFile:"",deleteDialogVisible:!1,deleteColumns:o.JR,deleteErrorData:[],billPrintTemplate:[],receivedTemplateId:"",bulkBillsDialogVisible:!1,bulkLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}}},computed:{...(0,r.rn)(["userInfo","assetTableHeader","assetFormHeader"]),editColumns(){let e=[],t=[];return this.assetFormHeader.forEach((i=>{"state"!=i.dbDataName&&"remainLift"!=i.dbDataName&&"workLife"!=i.dbDataName&&"netValue"!=i.dbDataName&&"depreciationMoney"!=i.dbDataName&&"accuDepreciation"!=i.dbDataName&&"goodsName"!=i.dbDataName&&"source"!=i.dbDataName&&"num"!=i.dbDataName&&"useDate"!=i.dbDataName&&"useState"!=i.dbDataName&&"useType"!=i.dbDataName&&"deptCode"!=i.dbDataName&&"useDept"!=i.dbDataName&&"responsible"!=i.dbDataName&&(i.notNull&&"assetCode"!=i.dbDataName?"inData"==i.dbDataName||"useDate"==i.dbDataName||"maintainLast"==i.dbDataName?e.push({label:"*"+i.nameShow,prop:i.dbDataName,minWidth:(0,n.Uh)(i.nameShow),width:"245px",class:"notNull"}):e.push({label:"*"+i.nameShow,prop:i.dbDataName,width:(0,n.Uh)(i.nameShow),class:"notNull"}):"inData"==i.dbDataName||"useDate"==i.dbDataName||"inData"==i.dbDataName?t.push({label:i.nameShow,prop:i.dbDataName,minWidth:(0,n.Uh)(i.nameShow),width:"245px"}):"file"==i.dbDataName?t.push({label:i.nameShow,prop:i.dbDataName,minWidth:(0,n.Uh)(i.nameShow),width:"240px"}):t.push({label:i.nameShow,prop:i.dbDataName,width:(0,n.Uh)(i.nameShow)}))})),[...e,...t]},billAssetsColumns(){let e=[];return this.assetTableHeader.forEach((t=>{"assetCode"==t.attr||"type"==t.attr||"name"==t.attr||"model"==t.attr||"assertPosition"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,minWidth:(0,n.Uh)(t.label),showOverflowTooltip:!0}):"photo"==t.attr&&e.push({type:"image",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,n.Uh)(t.label)})})),e}},methods:{getReceivedBills(){this.tableLoading=!0,null==this.filterForm.deptId&&(this.filterForm.deptId=[]),null==this.filterForm.date&&(this.filterForm.date=[]),(0,l.Ys)({func:"S0013",token:this.userInfo.token,userId:this.userInfo._id,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,staffId:this.filterForm.staffId.join(","),deptId:this.filterForm.deptId.join(","),status:this.filterForm.status.join(","),date:this.filterForm.date.join(","),goodsId:this.filterForm.goodsId.join(","),andLike:this.andLike}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.receivedBills=e.data[1]||[],this.receivedBills.forEach((e=>{e.company=sessionStorage.getItem("loginCompanyName"),e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image)}))})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getGoodsAttributeListData(){(0,l.Ys)({func:"S0022",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.goodsListData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getDeptData(){(0,l.Ys)({func:"S0004",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.deptListData=e.data,this.depts=(0,c.M)(e.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},handleSelectionChange(e){this.selectReceivedBills=e},getBillsAuditMessage(e){(0,l.Ys)({func:"S0053",token:this.userInfo.token,userId:this.userInfo._id,requstData:{_id:e._id,type:"RK"}}).then((({data:t})=>{if(0!=t.code)return this.$message.error(t.data);this.auditStep=this.createBillAuditMessage(e,t.data)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},createBillAuditMessage(e,t){let i=[];return e.examineOne&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName1"),auditState:"more"}),e.examineTwo&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName2"),auditState:"more"}),e.examineThree&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName3"),auditState:"more"}),e.examineFour&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName4"),auditState:"more"}),e.examineFive&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName5"),auditState:"more"}),i.forEach(((e,i)=>{if(t[i])if(void 0!=t[i].rejection){for(let s in t[i])"rejection"!=s&&(e.auditStaffName=t[i][s]);e.auditState="error",e.message=t[i].rejection}else{for(let s in t[i])"rejection"!=s&&(e.auditStaffName=t[i][s]);e.auditState="success"}})),i.push({state:"end"}),i},detailPagination(){this.detailLoading=!0,this.detailAssets=this.detailMatchAssets.slice((this.detailPaginationForm.currentPage-1)*this.detailPaginationForm.pageSize,this.detailPaginationForm.currentPage*this.detailPaginationForm.pageSize),this.detailLoading=!1},checkBillDetail(e){this.billFormDetail=(0,o.c5)(e),this.detailTotal=e.asset.length,this.detailMatchAssets=e.asset,this.detailPagination(),this.getBillsAuditMessage(e),this.billDetailDialogVisible=!0},billDetailDialogVisibleClosed(){this.detailAssets=[],this.detailTotal=0,this.detailPaginationForm.currentPage=1,this.detailPaginationForm.pageSize=20,this.detailMatchAssets=[]},newReceivedBill(){(0,l.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.userInfo.staffId}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.receivedForm.staffName=this.userInfo.staffName,this.receivedForm.deptId=e.data.deptId,this.receivedForm.estaDate=(0,n.X$)(),this.newBillsDialogVisible=!0})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},bulkReceivedBill(){(0,l.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.userInfo.staffId}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.receivedForm.staffName=this.userInfo.staffName,this.receivedForm.deptId=e.data.deptId,this.receivedForm.estaDate=(0,n.X$)(),this.bulkBillsDialogVisible=!0})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},editReceivedBill(){return!this.selectReceivedBills.length||this.selectReceivedBills.length>1?this.$message.error(this.$t("h.tips110")):-1!=this.selectReceivedBills[0].status?this.$message.error(this.$t("h.tips111")):void(0,l.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.userInfo._id}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.receivedForm.staffName=this.userInfo.staffName,this.receivedForm.deptId=e.data.deptId,this.receivedForm.estaDate=(0,n.X$)(),this.receivedForm._id=this.selectReceivedBills[0]._id,this.receivedForm.assertBeizhu=this.selectReceivedBills[0].assertBeizhu,this.receivedForm.date=this.selectReceivedBills[0].date,this.receivedForm.estaDate=this.selectReceivedBills[0].estaDate,this.receivedForm.goodsId=this.selectReceivedBills[0].goodsId,this.receivedForm.source=this.selectReceivedBills[0].source,this.selectReceivedBills[0].asset.forEach((e=>{if(e["jsons"]){for(let t in e["jsons"])e[t]=e["jsons"][t];delete e["jsons"]}e.isSet=!1,e["goalQuota"]&&(e["goalQuota"]=100*e["goalQuota"])})),this.receivedAssets=(0,d.Z)(this.selectReceivedBills[0].asset),this.newBillTitle=this.$t("h.title13"),this.newBillsDialogVisible=!0})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},newBillsDialogOpened(){this.$refs.receivedFormRef.clearValidate()},newBillsDialogClose(){this.receivedAssets=[],this.receivedForm._id=null,this.receivedForm.assertBeizhu="",this.receivedForm.date="",this.receivedForm.deptId="",this.receivedForm.estaDate="",this.receivedForm.goodsId="",this.receivedForm.source="",this.receivedForm.staffName="",this.newBillTitle=this.$t("h.title12"),this.$refs.billsTableRef.$refs.dsTableRef.clearSelection()},sbumitReceivedForm(){this.$refs.receivedFormRef.validate((e=>{if(!e)return!1;if(!this.receivedAssets.length)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips112")});for(let s=0;s<this.receivedAssets.length;s++)if(this.receivedAssets[s].isSet)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips113")});const t=this.$loading(this.dialogLoading);let i=79;this.receivedForm._id&&(i=81),this.receivedAssets.forEach((e=>{let t={};for(let i in e)32==i.length&&""!=e[i]&&(t[i]=e[i],delete e[i]);e["jsons"]=t,e.goalQuota&&(e.goalQuota=e.goalQuota/100)})),(0,l.Vx)({func:"U0058",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.receivedForm._id,date:this.receivedForm.date,estaDate:this.receivedForm.estaDate,goodsId:this.receivedForm.goodsId,deptId:this.receivedForm.deptId,staffId:this.userInfo._id,source:this.receivedForm.source,assertBeizhu:this.receivedForm.assertBeizhu,asset:this.receivedAssets,num:1,permissonId:i}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.newBillsDialogVisible=!1,this.getReceivedBills(),this.$message.success(e.data)})).catch((()=>{this.receivedAssets.forEach((e=>{if(e["json"]){for(let t in e["json"])e[t]=e["json"][t];delete e["json"]}e["goalQuota"]&&(e["goalQuota"]=100*e["goalQuota"])})),t.close(),this.$message.error(this.$t("h.tips18"))}))}))},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getReceivedBills()},resetFilterForm(){this.$refs["filterFormRef"].resetFields(),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getReceivedBills()},mapHighFilterTags(){this.highFilterTags=[];for(let e in this.filterForm)if(this.filterForm[e]&&this.filterForm[e].length)if("staffId"==e){let t={},i=[];this.$refs.highFilterStaffSelectref.selected.forEach((e=>{i.push(e.label)})),t.name=this.$t("h.creator"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("deptId"==e){let t={},i=[];this.filterForm[e].forEach((e=>{let t=this.deptListData.find((t=>t._id==e)).deptName;i.push(t)})),t.name=this.$t("h.createDepartment"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("status"==e){let t={},i=[];this.filterForm[e].forEach((e=>{let t=this.statusListData.find((t=>t.value==e)).label;i.push(t)})),t.name=this.$t("h.auditStatus"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("date"==e){let t={};t.name=this.$t("h.enteringWarehouseDate"),t.keyStr=e,t.value=this.filterForm[e].join("至"),this.highFilterTags.push(t)}else if("goodsId"==e){let t={},i=[];this.filterForm[e].forEach((e=>{let t=this.goodsListData.find((t=>t.goodsqId==e)).name;i.push(t)})),t.name=this.$t("h.assetAttributes"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}},handleCloseFilterTag(e){this.highFilterTags.splice(this.highFilterTags.indexOf(e),1),this.filterForm[e.keyStr]=[],this.paginationForm.currentPage=1,this.getReceivedBills()},findAssetSearch(){this.paginationForm.currentPage=1,this.getReceivedBills()},billsExportDialogVisibleClose(){this.$refs.exportFormRef.resetFields(),this.exportPercentage=0,this.exportStep="",this.exportErrorContent=""},submitExportForm(){this.exportStep="loading",this.exportPercentage=50,null==this.exportForm.date&&(this.exportForm.date=[]),null==this.exportForm.deptId&&(this.exportForm.deptId=[]),(0,l.Vx)({func:"U0050",userId:this.userInfo._id,token:this.userInfo.token,requstData:{deptId:this.exportForm.deptId.join(","),staffId:this.exportForm.staffId.join(","),status:this.exportForm.status.join(","),date:this.exportForm.date.join(","),goodsId:this.exportForm.goodsId.join(","),permissonId:79}}).then((({data:e})=>{if(this.exportPercentage=100,0!=e.code)return this.exportStep="error",void(this.exportErrorContent=e.data);this.exportStep="success",(0,n.M)(window.$EXCEL_URL+e.data)})).catch((()=>{this.exportPercentage=100,this.exportStep="error",this.exportErrorContent=this.$t("h.tips18")}))},uploadBillPhoto(e){return this.uploadImgLoading=!0,this.billPhotoFile?0!=e.status?(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips115"))):void(0,l.Vx)({func:"U0062",token:this.userInfo.token,userId:this.userInfo._id,requstData:{id:e._id,type:e.roleRule.slice(0,2),image:this.billPhotoFile,permissonId:81}}).then((({data:t})=>{if(this.uploadImgLoading=!1,0!=t.code)return this.$message.error(t.data);this.$message.success(t.data),this.$refs[`uploadPopoverRef-${e._id}`].doClose(),this.getReceivedBills()})).catch((()=>(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips18"))))):(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips114")))},billPopAsterLeave(){this.billPhotoFile=""},deleteDialogVisibleClosed(){this.deleteErrorData=[]},deleteReceivedBills(){if(0==this.selectReceivedBills.length)return this.$message.error(this.$t("h.tips22"));for(let e=0;e<this.selectReceivedBills.length;e++)if(-1!=this.selectReceivedBills[e].status)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips116")});this.$confirm(this.$t("h.tips117"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{this.tableLoading=!0,this.deleteErrorData=[],this.multiDeleteBill(0)})).catch((()=>{this.$message.info(this.$t("h.tips98"))}))},multiDeleteBill(e){if(e>this.selectReceivedBills.length-1)return this.paginationForm.currentPage=1,this.getReceivedBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.deleteErrorData.length?this.deleteDialogVisible=!0:this.$message.success(this.$t("h.tips118")));(0,l.SR)({func:"D0013",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.selectReceivedBills[e]._id,permissonId:80}}).then((({data:t})=>{if(0!=t.code){let i=[];this.selectReceivedBills[e].asset.forEach((e=>i.push(e.name))),this.deleteErrorData.push({roleRule:this.selectReceivedBills[e].roleRule,assetNames:i.join(","),reason:t.data})}this.multiDeleteBill(++e)})).catch((()=>{let t=[];this.selectReceivedBills[e].asset.forEach((e=>t.push(e.name))),this.deleteErrorData.push({roleRule:this.selectReceivedBills[e].roleRule,assetNames:t.join(","),reason:this.$t("h.tips18")}),this.multiDeleteBill(++e)}))},openPrintSet(){this.$refs["vptRef"].printTempDialogVisible=!0},getBillPrintTemplate(){(0,l.Ys)({func:"S0034",userId:this.userInfo._id,token:this.userInfo.token,requstData:{type:"RK"}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.billPrintTemplate=e.data,this.receivedTemplateId=localStorage.getItem("receivedTemplateId"),this.billPrintTemplate.some((e=>e._id==this.receivedTemplateId))||(this.receivedTemplateId=this.billPrintTemplate[0]._id,localStorage.setItem("receivedTemplateId",this.receivedTemplateId))})).catch((()=>{this.$message.error(this.$t("h.tips119"))}))},setBillPrintTemplate(e){this.receivedTemplateId=e,window.localStorage.setItem("receivedTemplateId",e)},goPrintBills(){return 0==this.selectReceivedBills.length?this.$message.error(this.$t("h.tips22")):this.selectReceivedBills.length>10?this.$message.error(this.$t("h.tips44")+"10"+this.$t("h.tips45")):void(this.$refs["vpdRef"].voucherPrintDialogVisible=!0)},bulkBillsDialogOpened(){this.$refs.bulkReceivedFormRef.clearValidate()},bulkBillsDialogClose(){this.receivedAssets=[],this.receivedForm._id=null,this.receivedForm.assertBeizhu="",this.receivedForm.date="",this.receivedForm.deptId="",this.receivedForm.estaDate="",this.receivedForm.goodsId="",this.receivedForm.source="",this.receivedForm.staffName="",this.file.name="",this.file.value="",this.$refs.billsTableRef.$refs.dsTableRef.clearSelection()},sbumitBulkReceivedForm(){this.$refs.bulkReceivedFormRef.validate((e=>{if(!e)return!1;if(!this.file.value)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips120")});const t=this.$loading(this.bulkLoading);(0,l.Vx)({func:"U0058",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.receivedForm._id,date:this.receivedForm.date,estaDate:this.receivedForm.estaDate,goodsId:this.receivedForm.goodsId,deptId:this.receivedForm.deptId,staffId:this.userInfo._id,source:this.receivedForm.source,assertBeizhu:this.receivedForm.assertBeizhu,Base64:this.file.value,num:1,permissonId:79}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.bulkBillsDialogVisible=!1,this.getReceivedBills(),this.$message.success(e.data)})).catch((()=>{t.close(),this.$message.error(this.$t("h.tips18"))}))}))},downloadImportFile(){const e=this.$loading(this.bulkLoading);(0,l.Ys)({func:"S0068",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:t})=>{if(e.close(),0!=t.code)return this.$message.error(t.data);(0,n.M)(window.$EXCEL_URL+t.data)})).catch((()=>{e.close()}))}},created(){this.getReceivedBills(),this.getGoodsAttributeListData(),this.getDeptData(),this.getBillPrintTemplate()}},U=O,Q=(0,_.Z)(U,s,a,!1,null,"28258c38",null),W=Q.exports},39622:function(e,t){function i(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function s(e,t=new WeakMap){if("symbol"===typeof e)return Symbol(e.description);if(!i(e))return e;if(e instanceof Set){const t=new Set;for(const i of e)t.add(s(i));return t}if(e instanceof Map){const t=new Map;for(const i of e)t.set(i[0],i[1]);return t}if("function"===typeof e)return e;if(t.get(e))return t.get(e);const a=Array.isArray(e)?[]:{};t.set(e,a);for(const i in e)a[i]=s(e[i],t);const l=Object.getOwnPropertySymbols(e);for(const i of l)a[Symbol(i.description)]=s(e[i],t);return a}t["Z"]=s},6214:function(e,t,i){i.d(t,{M:function(){return s}});const s={specialPlaneL:/0\d{2,3}-\d{7,8}/,mobile:/^((0\d{2,3}-\d{7,8})|(1[3456789]\d{9}))$/,qq:/^[1-9][0-9]{4,14}$/,email:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,password:/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%^&*?]{8,18}$/,goalQuota:/^(?:0|[1-9][0-9]?|100)(\.[0-9]{0,2})?$/,money:/^(\d{1,12}(\.\d{0,6})?)?$/}}}]);