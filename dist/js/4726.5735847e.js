"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[4726],{42041:function(e,t,s){s.d(t,{Z:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"dialog",fullscreen:"",visible:e.dialogVisible,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.dialogVisibleOpened,close:e.dialogVisibleClose,closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left",circle:""},on:{click:function(t){e.dialogVisible=!1}}}),t("span",{staticClass:"title"},[e._v(e._s(e.title))])],1),t("div",{staticClass:"right"},[t("el-button",{attrs:{size:"small"},on:{click:e.cancalFrom}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.sbumitForm}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)]),t("div",{ref:"dialogbodyRef",staticClass:"dialog-body"},[t("div",{staticClass:"content",style:"width:"+e.contentWidth},[t("div",{staticClass:"form-label"},[e._t("form")],2),t("div",{staticClass:"table-label"},[t("div",{staticClass:"table-label-head"},[e._t("btns")],2),t("div",{staticClass:"table-label-content"},[e._t("table")],2)])])])])},i=[],l=s(63042),r={data(){return{}},props:{title:{type:String,default:l.a.t("h.title12")},newBillsDialogVisible:{type:Boolean,default:!1},contentWidth:{type:String,default:"950px"}},computed:{dialogVisible:{get(){return this.newBillsDialogVisible},set(e){this.$emit("update:newBillsDialogVisible",e)}}},methods:{cancalFrom(){this.dialogVisible=!1},sbumitForm(){this.$emit("sbumitForm")},dialogVisibleClose(){this.$emit("close"),this.$refs.dialogbodyRef.scrollTop=0},dialogVisibleClosed(){this.$emit("closed")},dialogVisibleOpened(){this.$emit("opened")}}},o=r,n=s(1001),c=(0,n.Z)(o,a,i,!1,null,"130c4832",null),u=c.exports},93082:function(e,t,s){s.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-pagination"},[t("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[],l={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e})},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize})}}},r=l,o=s(1001),n=(0,o.Z)(r,a,i,!1,null,"2377c114",null),c=n.exports},52086:function(e,t,s){s.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("el-select",{ref:"selectRef",staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"","filter-method":e.selectFilter,placeholder:e.placeholder,disabled:e.disabled,"value-key":e.defaultProps["value"],multiple:e.multiple,"collapse-tags":e.collapseTags},on:{clear:e.clearSelectValue,"remove-tag":e.removeSelectTag,focus:e.FocusSelect},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},[t("el-option",{key:"x",attrs:{hidden:"",value:"x",label:"x"}}),e._l(e.valueData,(function(s,a){return t("el-option",{key:a,attrs:{hidden:"",value:s[e.defaultProps["value"]],label:s[e.defaultProps["label"]]}})})),e.multiple?t("el-checkbox",{staticStyle:{margin:"0 0 0 26px"},attrs:{"text-color":"#409EFF"},on:{change:e.checkboxChange},model:{value:e.checkedValue,callback:function(t){e.checkedValue=t},expression:"checkedValue"}},[e._v(e._s(e.$t("h.title52")))]):e._e(),e.multiple?t("div",{staticClass:"line"}):e._e(),t("el-tree",{ref:"treeRef",attrs:{"highlight-current":"","node-key":e.defaultProps["value"],data:e.treeData,props:e.defaultProps,"show-checkbox":e.multiple,"check-strictly":e.checkStrictly,"expand-on-click-node":e.isLastNode,"filter-node-method":e.treeFilterNode},on:{check:e.clickCheckBox,"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function({node:s,data:a}){return t("span",{staticClass:"tree-text"},[e._v(" "+e._s(a.code+"-"+s.label)+" ")])}}])})],2)},i=[],l=(s(57658),{data(){return{selectValue:null,valueData:[],checkedValue:!1}},props:{placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},treeData:{type:Array,default:()=>[]},defaultProps:{type:Object,default:()=>({value:"_id",label:"name",children:"children"})},multiple:{type:Boolean,default:!1},collapseTags:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},isLastNode:{type:Boolean,default:!1},initData:{type:[Array,Number,String]},value:{type:[Array,Number,String]}},watch:{value:{handler(e){this.multiple?(this.selectValue=e,this.valueData=[],this.$nextTick((()=>{e instanceof Array==0?this.$refs.treeRef.setCheckedKeys([]):this.$refs.treeRef.setCheckedKeys(e);let t=this.$refs.treeRef.getCheckedNodes();this.valueData=t}))):(this.selectValue=e,this.valueData=[],this.$nextTick((()=>{this.$refs.treeRef.setCurrentKey(e);let t=this.$refs.treeRef.getCurrentNode();t&&this.valueData.push(t)})))},immediate:!0,deep:!0}},methods:{clearSelectValue(){this.multiple?this.selectValue=[]:this.selectValue=null,this.valueData=[],this.multiple?this.$refs.treeRef.setCheckedKeys([]):this.$refs.treeRef.setCurrentKey(null),this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},removeSelectTag(e){if(!this.multiple)return!1;if(this.checkStrictly)this.valueData.splice(this.valueData.findIndex((t=>t[this.defaultProps.value]==e)),1),this.$nextTick((()=>{this.$refs.treeRef.setCheckedKeys(this.selectValue)}));else{this.valueData.splice(this.valueData.findIndex((t=>t[this.defaultProps.value]==e)),1);let t=this.$refs.treeRef.getCheckedNodes(!0,!1);for(let s=0;s<t.length;s++)if(t[s][this.defaultProps.value]==e){t.splice(s,1);break}this.$nextTick((()=>{this.$refs.treeRef.setCheckedNodes(t)}))}this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},FocusSelect(){this.$refs.treeRef.filter("")},clickCheckBox(e,t){if(this.checkStrictly)if(e.children&&0!=e.children.length){const s=e[this.defaultProps.value];if(-1!=this.selectValue.indexOf(s))this.selectValue.splice(this.selectValue.findIndex((e=>e==s)),1),this.valueData.splice(this.valueData.findIndex((e=>e[this.defaultProps.value]==s)),1),this.$refs.treeRef.setCheckedKeys(this.selectValue);else{let s=this.lookForAllId(e.children),a=this.lookForAll(e.children);this.valueData=this.dsNewSet([...t.checkedNodes,...a],!0),this.selectValue=this.dsNewSet([...t.checkedKeys,...s],!1),this.$refs.treeRef.setCheckedKeys(this.selectValue)}}else this.valueData=t.checkedNodes,this.selectValue=t.checkedKeys,this.$refs.treeRef.setCheckedKeys(this.selectValue);else 0==t.halfCheckedKeys.length?(this.valueData=t.checkedNodes,this.selectValue=t.checkedKeys):(this.valueData=[...t.checkedNodes,...t.halfCheckedNodes],this.selectValue=[...t.checkedKeys,...t.halfCheckedKeys]);this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},clickNode(e,t,s){if(this.multiple)return!1;if(this.isLastNode){if(null!=e.children)return!1;this.selectValue=e[this.defaultProps.value],this.valueData=[e],this.$refs.treeRef.setCurrentKey(e[this.defaultProps.value])}else this.selectValue=e[this.defaultProps.value],this.valueData=[e],this.$refs.treeRef.setCurrentKey(e[this.defaultProps.value]);this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue,e),this.$refs.selectRef.blur()},removeNode(e){this.$refs.treeRef.remove(e)},lookForAllId(e=[],t=[]){for(let s of e)t.push(s[this.defaultProps.value]),s.children&&s.children.length&&this.lookForAllId(s.children,t);return t},lookForAll(e=[],t=[]){for(let s of e)t.push(s),s.children&&s.children.length&&this.lookForAll(s.children,t);return t},dsNewSet(e,t){if(t){const t=new Map;return e.filter((e=>!t.has(e[this.defaultProps.value])&&t.set(e[this.defaultProps.value],1)))}for(var s=0;s<e.length;s++)for(var a=s+1;a<e.length;a++)e[s]==e[a]&&e.splice(a,1);return e},selectFilter(e){this.$refs.treeRef.filter(e)},treeFilterNode(e,t){return!e||-1!==t[this.defaultProps.label].indexOf(e)},checkboxChange(e){e?(this.valueData=this.lookForAll(this.treeData),this.selectValue=this.lookForAllId(this.treeData),this.$refs.treeRef.setCheckedKeys(this.lookForAllId(this.treeData))):(this.$refs.treeRef.setCheckedKeys([]),this.selectValue=null,this.valueData=[]),this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)}}}),r=l,o=s(1001),n=(0,o.Z)(r,a,i,!1,null,"1a3a05b9",null),c=n.exports},47334:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sku"},[t("el-card",{staticClass:"sku-card"},[t("div",{staticClass:"sku-card-content"},[t("div",{staticClass:"sku-tree"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(e.$t("h.assetCategory")))])]),t("div",{staticClass:"content"},[t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"typeTree",attrs:{"node-key":"_id","highlight-current":"","expand-on-click-node":!1,data:e.assetTypes,props:e.typeProps},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:s,data:a}){return t("span",{},[t("span",{staticClass:"icon"},[null==a.children?["G"==(a.hierarchy||"").split("|")[0]?t("svg-icon",{staticClass:"childIcon",attrs:{"icon-file-name":"childGb"}}):t("svg-icon",{staticClass:"childIcon",attrs:{"icon-file-name":"childQb"}})]:["G"==a.hierarchy.split("|")[0]?t("svg-icon",{staticClass:"parentIcon",attrs:{"icon-file-name":"gb"}}):t("svg-icon",{staticClass:"parentIcon",attrs:{"icon-file-name":"qb"}})]],2),t("span",{staticClass:"text",staticStyle:{"font-size":"14px"}},[e._v(" "+e._s(a.code+"-"+s.label)+" ")])])}}])})],1)]),t("div",{staticClass:"sku-table"},[t("div",{staticClass:"btns"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.newSku}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showALlSku}},[e._v(e._s(e.$t("h.showAllItems")))])],1),t("div",{staticClass:"filter"},[t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"table"},[t("ds-table",{attrs:{loading:e.tableLoading,tableData:e.assets,columns:e.assetsColumns,tableConfig:e.assetsConfig,rowKey:e=>e.id,onlyKey:"id"},scopedSlots:e._u([{key:"operation",fn:function({scope:s}){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.editSkuForm(s.row)}}},[e._v(e._s(e.$t("h.changeBtn")))]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteSku(s.row.id)}}},[e._v(e._s(e.$t("h.delBtn")))])]}}])})],1),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getAssets}})],1)])])]),t("new-bills-dialog",{staticClass:"new-dialog",attrs:{newBillsDialogVisible:e.newDialogVisible,title:e.dialogTitle},on:{"update:newBillsDialogVisible":function(t){e.newDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newDialogVisible=t},sbumitForm:e.sbumitSkuForm,close:e.newDialogVisibleClosed,opened:e.newDialogVisibleOpened}},[t("template",{slot:"form"},[t("el-form",{ref:"skuFormRef",attrs:{"label-width":"120px",model:e.skuForm,rules:e.skuFormRules}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.assetCategory"),prop:"assetClassifyId"}},[t("ds-select-tree",{attrs:{disabled:e.dialogTitle==e.$t("h.title156"),placeholder:e.$t("h.tips4")+e.$t("h.assetCategory"),defaultProps:e.typeProps,treeData:e.assetTypes},model:{value:e.skuForm.assetClassifyId,callback:function(t){e.$set(e.skuForm,"assetClassifyId",t)},expression:"skuForm.assetClassifyId"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.assetName"),prop:"assetTemplateName"}},[t("el-input",{model:{value:e.skuForm.assetTemplateName,callback:function(t){e.$set(e.skuForm,"assetTemplateName",t)},expression:"skuForm.assetTemplateName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.columns27"),prop:"specification"}},[t("el-input",{model:{value:e.skuForm.specification,callback:function(t){e.$set(e.skuForm,"specification",t)},expression:"skuForm.specification"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.columns28"),prop:"measureUnit"}},[t("el-input",{model:{value:e.skuForm.measureUnit,callback:function(t){e.$set(e.skuForm,"measureUnit",t)},expression:"skuForm.measureUnit"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.creationDate"),prop:"createdDate"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:e.$t("h.tips4")+e.$t("h.creationDate")},model:{value:e.skuForm.createdDate,callback:function(t){e.$set(e.skuForm,"createdDate",t)},expression:"skuForm.createdDate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.originalValue"),prop:"amount"}},[t("el-input-number",{attrs:{precision:2,step:1},model:{value:e.skuForm.amount,callback:function(t){e.$set(e.skuForm,"amount",t)},expression:"skuForm.amount"}})],1)],1)],1)],1)],1)],2)],1)},i=[],l=s(76080),r=s(20629),o=s(55886),n=s(83151),c=s(60983),u=s(93082),d=s(42041),h=s(52086),p={components:{DsTable:c.Z,DsPagination:u.Z,DsSelectTree:h.Z,NewBillsDialog:d.Z},data(){return{treeLoading:!1,assetTypes:[],typeProps:{value:"_id",label:"classifyName",children:"children"},filtetClassId:"",tableLoading:!1,total:0,paginationForm:{currentPage:1,pageSize:20},assets:[],assetsColumns:n.rp,assetsConfig:{selection:!1,reserveSelection:!1},newDialogVisible:!1,dialogTitle:this.$t("h.title157"),dialogLoading:{target:".new-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},skuForm:{id:null,amount:0,assetTemplateName:"",assetClassifyId:"",createdDate:"",measureUnit:"",specification:""},skuFormRules:{assetTemplateName:[{required:!0,message:this.$t("h.tips3")+this.$t("h.assetName"),trigger:"blur"}],assetClassifyId:[{required:!0,message:this.$t("h.tips4")+this.$t("h.assetCategory"),trigger:"change"}],createdDate:[{required:!0,message:this.$t("h.tips4")+this.$t("h.creationDate"),trigger:"change"}],specification:[{required:!0,message:this.$t("h.tips3")+this.$t("h.columns27"),trigger:"blur"}]}}},computed:{...(0,r.rn)(["userInfo"])},methods:{getAssetType(){this.treeLoading=!0,(0,l.Ys)({func:"S0006",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(this.treeLoading=!1,0!=e.code)return this.$message.error(e.data);this.assetTypes=(0,o.M)(e.data,null)})).catch((()=>{this.treeLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getAssets(){this.tableLoading=!0,(0,l.Ys)({func:"S0060",userId:this.userInfo._id,token:this.userInfo.token,requstData:{index:this.paginationForm.currentPage,page:this.paginationForm.pageSize,assetClassifyId:this.filtetClassId}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.assets=e.data[1],console.log(e)})).catch((()=>{this.tableLoading=!1}))},handleNodeClick(e){this.skuForm.assetClassifyId=e._id,this.filtetClassId=e._id,this.paginationForm.currentPage=1,this.getAssets()},sbumitSkuForm(){this.$refs.skuFormRef.validate((e=>{if(!e)return!1;const t=this.$loading(this.dialogLoading);(0,l.Vx)({func:"U0065",userId:this.userInfo._id,token:this.userInfo.token,requstData:{id:this.skuForm.id,amount:this.skuForm.amount,assetTemplateName:this.skuForm.assetTemplateName,assetClassifyId:this.skuForm.assetClassifyId,createdDate:this.skuForm.createdDate,measureUnit:this.skuForm.measureUnit,specification:this.skuForm.specification,permissonId:26}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.newDialogVisible=!1,this.paginationForm.currentPage=1,this.getAssets()})).catch((()=>{t.close(),this.$message.error(this.$t("h.tips18"))}))}))},newSku(){this.dialogTitle=this.$t("h.title157"),this.newDialogVisible=!0},showALlSku(){this.filtetClassId="",this.$refs.typeTree.setCurrentKey(null),this.paginationForm.currentPage=1,this.getAssets()},editSkuForm(e){this.skuForm.id=e.id,this.skuForm.amount=e.amount,this.skuForm.assetTemplateName=e.assetTemplateName,this.skuForm.assetClassifyId=e.assetClassifyId,this.skuForm.createdDate=e.createdDate,this.skuForm.measureUnit=e.measureUnit,this.skuForm.specification=e.specification,this.dialogTitle=this.$t("h.title156"),this.newDialogVisible=!0},deleteSku(e){},newDialogVisibleOpened(){this.$refs.skuFormRef.clearValidate()},newDialogVisibleClosed(){this.skuForm.id=null,this.skuForm.amount=0,this.skuForm.assetTemplateName="",this.skuForm.assetClassifyId="",this.skuForm.createdDate="",this.skuForm.measureUnit="",this.skuForm.specification=""}},created(){this.getAssetType(),this.getAssets()}},f=p,m=s(1001),g=(0,m.Z)(f,a,i,!1,null,"41e596c8",null),k=g.exports},55886:function(e,t,s){s.d(t,{M:function(){return a}});s(57658);const a=(e,t)=>{const s=[];return e.forEach(((i,l)=>{if(i.subId==t){const t=a(e,i._id);t.length>0&&(i.children=t),s.push(i)}})),s}}}]);