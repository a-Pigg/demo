"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[6659],{86659:function(e,t,i){i.r(t),i.d(t,{default:function(){return P}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"repair"},[t("el-card",{staticClass:"repair-card"},[t("div",{staticClass:"repair-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.newBillsDialogVisible=!0}}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.editBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.editRepairForm.apply(null,arguments)}}},[e._v(e._s(e.$t("h.changeBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.deleteRepairBills.apply(null,arguments)}}},[e._v(e._s(e.$t("h.delBtn")))])],1)],1),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.printBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.goPrintBills.apply(null,arguments)}}},[e._v(e._s(e.$t("h.printDoucmentBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.openPrintSet.apply(null,arguments)}}},[e._v(e._s(e.$t("h.tempSetBtn")))])],1)],1),t("el-button",{attrs:{size:"small",type:"success",disabled:e.isDisabled},on:{click:e.completedRepair}},[e._v(e._s(e.$t("h.repairCompleteBtn")))]),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.billsExportDialogVisible=!0}}},[e._v(e._s(e.$t("h.exportBtn")))])],1),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.findAssetSearch}})],1)],1)],1),t("div",{staticClass:"repair-card-content"},[t("div",{staticClass:"bills-filter"},[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}}),t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.filterDrawerVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"bills-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.tableLoading,tableConfig:e.billsTableConfig,columns:e.billsColums,tableData:e.repairBills,rowKey:e=>e._id},on:{handleSelectionChange:e.handleSelectionChange,checkTableRowDetail:e.checkBillDetail},scopedSlots:e._u([{key:"operation",fn:function({scope:i}){return[t("el-popover",{ref:`uploadPopoverRef-${i.row._id}`,attrs:{placement:"left",width:"100"},on:{"after-leave":e.billPopAsterLeave}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.uploadImgLoading,expression:"uploadImgLoading"}],staticClass:"popover-cotent"},[t("upload-photo",{attrs:{value:e.billPhotoFile},on:{"update:value":function(t){e.billPhotoFile=t}}}),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.uploadBillPhoto(i.row)}}},[e._v(e._s(e.$t("h.confirmUpload")))])],1),t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v(e._s(e.$t("h.uploadVouchers")))])],1)]}}])})],1),t("div",{staticClass:"bills-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getRepairBills}})],1)])]),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.filterDrawerVisible},on:{"update:filterDrawerVisible":function(t){e.filterDrawerVisible=t},"update:filter-drawer-visible":function(t){e.filterDrawerVisible=t},submitFilterForm:e.submitFilterForm,resetFilterForm:e.resetFilterForm}},[t("el-form",{ref:"filterFormRef",attrs:{"label-width":"110px",model:e.filterForm}},[t("el-form-item",{attrs:{label:e.$t("h.repairApplicant"),prop:"repairCode"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.filterForm.repairCode.join(","),searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: filterForm.repairCode.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],ref:"highFilterStaffSelectref",attrs:{placeholder:e.$t("h.tips4"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.filterForm.repairCode,callback:function(t){e.$set(e.filterForm,"repairCode",t)},expression:"filterForm.repairCode"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.reportDepartment"),prop:"deptId"}},[t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.department"),multiple:!0,checkStrictly:!0,treeData:e.treeDepts,defaultProps:e.deptTreeProps,collapseTags:""},model:{value:e.filterForm.deptId,callback:function(t){e.$set(e.filterForm,"deptId",t)},expression:"filterForm.deptId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.auditStatus"),prop:"status"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:""},model:{value:e.filterForm.status,callback:function(t){e.$set(e.filterForm,"status",t)},expression:"filterForm.status"}},e._l(e.statusListData,(function(e,i){return t("el-option",{key:i,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.reportDate"),prop:"receiveData"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.filterForm.receiveData,callback:function(t){e.$set(e.filterForm,"receiveData",t)},expression:"filterForm.receiveData"}})],1),t("el-form-item",{attrs:{label:e.$t("h.completionDateOfRepairs"),prop:"repairBackData"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.filterForm.repairBackData,callback:function(t){e.$set(e.filterForm,"repairBackData",t)},expression:"filterForm.repairBackData"}})],1)],1)],1),t("bill-detail-dialog",{attrs:{print:"",billDetailDialogVisible:e.billDetailDialogVisible,billFormDetail:e.billFormDetail,auditStep:e.auditStep},on:{"update:billDetailDialogVisible":function(t){e.billDetailDialogVisible=t},"update:bill-detail-dialog-visible":function(t){e.billDetailDialogVisible=t},closed:e.billDetailDialogVisibleClosed,print:e.printBillAssets}},[t("template",{slot:"table"},[t("ds-table",{ref:"detailTableRef",attrs:{loading:e.detailLoading,tableData:e.detailAssets,columns:e.billAssetsColumns,tableConfig:e.detailConfig,rowKey:e=>e._id},on:{handleSelectionChange:e.selectPrintAssets}})],1),t("template",{slot:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.detailTotal,page:e.detailPaginationForm.currentPage,limit:e.detailPaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.detailPaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.detailPaginationForm,"pageSize",t)},pagination:e.getMatchAssets}})],1)],2),t("bills-export-dialog",{attrs:{billsExportDialogVisible:e.billsExportDialogVisible,percentage:e.exportPercentage,step:e.exportStep,errorContent:e.exportErrorContent},on:{"update:billsExportDialogVisible":function(t){e.billsExportDialogVisible=t},"update:bills-export-dialog-visible":function(t){e.billsExportDialogVisible=t},submitExportForm:e.submitExportForm,close:e.billsExportDialogVisibleClose}},[t("el-form",{ref:"exportFormRef",attrs:{"label-width":"110px",model:e.exportForm}},[t("el-form-item",{attrs:{label:e.$t("h.repairApplicant"),prop:"repairCode"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.exportForm.repairCode.join(","),searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: exportForm.repairCode.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],attrs:{placeholder:e.$t("h.tips4"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.exportForm.repairCode,callback:function(t){e.$set(e.exportForm,"repairCode",t)},expression:"exportForm.repairCode"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.reportDepartment"),prop:"deptId"}},[t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.department"),multiple:!0,checkStrictly:!0,treeData:e.treeDepts,defaultProps:e.deptTreeProps,collapseTags:""},model:{value:e.exportForm.deptId,callback:function(t){e.$set(e.exportForm,"deptId",t)},expression:"exportForm.deptId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.auditStatus"),prop:"status"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:""},model:{value:e.exportForm.status,callback:function(t){e.$set(e.exportForm,"status",t)},expression:"exportForm.status"}},e._l(e.statusListData,(function(e,i){return t("el-option",{key:i,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.reportDate"),prop:"receiveData"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.exportForm.receiveData,callback:function(t){e.$set(e.exportForm,"receiveData",t)},expression:"exportForm.receiveData"}})],1),t("el-form-item",{attrs:{label:e.$t("h.completionDateOfRepairs"),prop:"repairBackData"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.exportForm.repairBackData,callback:function(t){e.$set(e.exportForm,"repairBackData",t)},expression:"exportForm.repairBackData"}})],1)],1)],1),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{title:e.newBillTitle,newBillsDialogVisible:e.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},opened:e.newBillsDialogOpened,close:e.newBillsDialogClose,sbumitForm:e.sbumitRepairForm}},[t("template",{slot:"form"},[t("el-form",{ref:"repairFormRef",attrs:{"label-width":"130px",model:e.repairForm,rules:e.repairFormRules}},[e.newBillsDialogVisible?t("el-form-item",{attrs:{label:e.$t("h.repairApplicant"),prop:"repairCode"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.repairForm.repairCode,searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n              options: staffData,\n              modelField: '_id',\n              model: repairForm.repairCode,\n              searchField: 'andLike',\n              func: 'S0005',\n              userInfo: userInfo,\n            }"}],attrs:{placeholder:e.$t("h.tips4")+e.$t("h.repairApplicant"),clearable:"",filterable:"","filter-method":()=>{}},on:{change:e.staffSelectChange},model:{value:e.repairForm.repairCode,callback:function(t){e.$set(e.repairForm,"repairCode",t)},expression:"repairForm.repairCode"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1):e._e(),t("el-form-item",{attrs:{label:e.$t("h.reportDepartment"),prop:"deptId"}},[t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.reportDepartment"),defaultProps:e.deptTreeProps,treeData:e.treeDepts},on:{input:e.deptInput},model:{value:e.repairForm.deptId,callback:function(t){e.$set(e.repairForm,"deptId",t)},expression:"repairForm.deptId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.reportDate"),prop:"receiveData"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.reportDate")},model:{value:e.repairForm.receiveData,callback:function(t){e.$set(e.repairForm,"receiveData",t)},expression:"repairForm.receiveData"}})],1),t("el-form-item",{attrs:{label:e.$t("h.repairServiceCompany"),prop:"repairCompany"}},[t("el-input",{model:{value:e.repairForm.repairCompany,callback:function(t){e.$set(e.repairForm,"repairCompany",t)},expression:"repairForm.repairCompany"}})],1),t("el-form-item",{attrs:{label:e.$t("h.repairRecipient"),prop:"repairName"}},[t("el-input",{model:{value:e.repairForm.repairName,callback:function(t){e.$set(e.repairForm,"repairName",t)},expression:"repairForm.repairName"}})],1),t("el-form-item",{attrs:{label:e.$t("h.repairRecipientPhoneNumber"),prop:"repairTel"}},[t("el-input",{model:{value:e.repairForm.repairTel,callback:function(t){e.$set(e.repairForm,"repairTel",t)},expression:"repairForm.repairTel"}})],1),t("el-form-item",{attrs:{label:e.$t("h.maintenanceStaff"),prop:"maintainPerson"}},[t("el-input",{model:{value:e.repairForm.maintainPerson,callback:function(t){e.$set(e.repairForm,"maintainPerson",t)},expression:"repairForm.maintainPerson"}})],1),t("el-form-item",{attrs:{label:e.$t("h.estimatedAmount"),prop:"maintainMoney"}},[t("el-input",{model:{value:e.repairForm.maintainMoney,callback:function(t){e.$set(e.repairForm,"maintainMoney",t)},expression:"repairForm.maintainMoney"}})],1),t("el-form-item",{attrs:{label:e.$t("h.completionDateOfRepairs"),prop:"repairBackData"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:"","value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.completionDateOfRepairs")},model:{value:e.repairForm.repairBackData,callback:function(t){e.$set(e.repairForm,"repairBackData",t)},expression:"repairForm.repairBackData"}})],1),t("el-form-item",{attrs:{label:e.$t("h.repairNote"),prop:"repairBeizhu"}},[t("el-input",{attrs:{rows:4,type:"textarea"},model:{value:e.repairForm.repairBeizhu,callback:function(t){e.$set(e.repairForm,"repairBeizhu",t)},expression:"repairForm.repairBeizhu"}})],1),t("el-form-item",{attrs:{label:e.$t("h.reasonForRepair"),prop:"maintainReason"}},[t("el-input",{attrs:{rows:4,type:"textarea"},model:{value:e.repairForm.maintainReason,callback:function(t){e.$set(e.repairForm,"maintainReason",t)},expression:"repairForm.maintainReason"}})],1)],1)],1),t("template",{slot:"btns"},[t("div",[t("span",{staticClass:"title"},[e._v(e._s(e.$t("h.selectAsset")))])]),t("div",{staticClass:"btns"},[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.matchAssetsDialogVisible=!0}}},[e._v(e._s(e.$t("h.addAssets")))]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.deleteBillSelectAssets}},[e._v(e._s(e.$t("h.delBtn")))])],1)]),t("template",{slot:"table"},[t("div",{staticClass:"bill-table"},[t("ds-table",{ref:"billAssetsRef",attrs:{loading:e.billAssetsLoading,tableData:e.billAssets,columns:e.assetsColumns,tableConfig:e.billsTableConfig,rowKey:e=>e._id},on:{handleSelectionChange:e.billAssetsSelectionChange}})],1)])],2),t("match-assets-dialog",{attrs:{matchAssetsDialogVisible:e.matchAssetsDialogVisible,state:e.matchState,updateSelectBillAssets:e.billAssets,deptData:e.depts,deptTreeData:e.treeDepts},on:{"update:matchAssetsDialogVisible":function(t){e.matchAssetsDialogVisible=t},"update:match-assets-dialog-visible":function(t){e.matchAssetsDialogVisible=t},save:e.savaSelectAssets}}),t("ds-delete-detail",{attrs:{deleteDialogVisible:e.deleteDialogVisible,deleteColumns:e.deleteColumns,deleteErrorData:e.deleteErrorData},on:{"update:deleteDialogVisible":function(t){e.deleteDialogVisible=t},"update:delete-dialog-visible":function(t){e.deleteDialogVisible=t},closed:e.deleteDialogVisibleClosed}}),t("new-bills-dialog",{staticClass:"completed-bill-dialog",attrs:{newBillsDialogVisible:e.completedDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.completedDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.completedDialogVisible=t},opened:e.completedDialogOpened,close:e.completedDialogClose,sbumitForm:e.sbumitCompletedForm}},[t("template",{slot:"form"},[t("el-form",{ref:"completedFormRef",attrs:{"label-width":"120px",model:e.completedForm,rules:e.completedFormRules}},[t("el-form-item",{attrs:{label:e.$t("h.completionDateOfRepairs"),prop:"repairBackData"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.date")},model:{value:e.completedForm.repairBackData,callback:function(t){e.$set(e.completedForm,"repairBackData",t)},expression:"completedForm.repairBackData"}})],1)],1)],1)],2),t("ds-delete-detail",{attrs:{deleteDialogVisible:e.completedErrorDialogVisible,deleteColumns:e.completedColumns,deleteErrorData:e.completedErrorData},on:{"update:deleteDialogVisible":function(t){e.completedErrorDialogVisible=t},"update:delete-dialog-visible":function(t){e.completedErrorDialogVisible=t},closed:e.completedErrorDialogVisibleClosed}}),t("bill-print-template",{ref:"vptRef",attrs:{title:`${e.$t("h.title65")}`,selectId:e.repairTemplateId,voucherPrintTempList:e.billPrintTemplate},on:{setVoucherTag:e.setBillPrintTemplate}}),t("bill-print-dialog",{ref:"vpdRef",attrs:{locationName:"repairTemplateId",voucherData:e.selectRepairBills,userInfo:e.userInfo,voucherPrintTemplate:e.billPrintTemplate}}),t("asset-print-dialog",{ref:"apdRef",attrs:{userInfo:e.userInfo,selectAssetsData:e.printAssets}})],1)},r=[],s=(i(57658),i(3701)),l=i(62887),o=i(93390),n=i(98884),p=i(60983),d=i(93082),h=i(66403),m=i(17817),c=i(5791),u=i(52086),f=i(88048),g=i(22931),b=i(78067),D=i(42041),F=i(53595),$=i(19698),B=i(92003),v=i(89782),k=i(20629),R=i(83151),I=i(55886),x=i(79992),C=i(76080),S=i(6214),y={components:{AssetPrintDialog:s.Z,BillPrintDialog:l.Z,BillPrintTemplate:o.Z,DsDeleteDetail:n.Z,DsTable:p.Z,DsPagination:d.Z,DsSearchBtn:h.Z,DsFilterTag:m.Z,DsFilterDrawer:c.Z,DsSelectTree:u.Z,UploadPhoto:f.Z,BillDetailDialog:b.Z,BillsExportDialog:g.Z,NewBillsDialog:D.Z,MatchAssetsDialog:F.Z,DsQueryForm:$.Z,DsQueryFormLeftPanel:B.Z,DsQueryFormRightPanel:v.Z},data(){const e=(e,t,i)=>{t&&!S.M.money.test(t)?i(this.$t("h.tips125")):i()};return{tableLoading:!1,billsTableConfig:{selection:!0,reserveSelection:!0},billsColums:R.Am,total:0,paginationForm:{currentPage:1,pageSize:20},repairBills:[],selectRepairBills:[],filterDrawerVisible:!1,filterForm:{repairCode:[],deptId:[],status:[],receiveData:[],repairBackData:[]},andLike:"",deptTreeProps:{value:"_id",label:"deptName",children:"children"},treeDepts:[],depts:[],staffData:[],statusListData:R.k0,highFilterTags:[],uploadImgLoading:!1,billPhotoFile:"",billsExportDialogVisible:!1,exportPercentage:0,exportStep:"",exportErrorContent:"",exportForm:{repairCode:[],deptId:[],status:[],receiveData:[],repairBackData:[]},billDetailDialogVisible:!1,billFormDetail:[],auditStep:[],detailLoading:!1,detailAssets:[],detailMatchAssetIds:[],detailConfig:{selection:!0,reserveSelection:!0},detailTotal:0,detailPaginationForm:{currentPage:1,pageSize:20},newBillsDialogVisible:!1,newBillTitle:this.$t("h.title68"),dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},repairForm:{_id:"",deptId:"",repairCode:"",repairName:"",repairCompany:"",repairTel:"",receiveData:(0,x.X$)(),maintainPerson:"",repairBeizhu:"",repairBackData:"",maintainMoney:"",maintainReason:""},repairFormRules:{deptId:[{required:!0,message:this.$t("h.tips4")+this.$t("h.reportDepartment"),trigger:"change"}],repairCode:[{required:!0,message:this.$t("h.tips4")+this.$t("h.repairApplicant"),trigger:"change"}],receiveData:[{type:"string",required:!0,message:this.$t("h.tips4")+this.$t("h.reportDate"),trigger:"change"}],maintainMoney:[{validator:e,trigger:"blur"}]},selectBillAssets:[],matchAssetsDialogVisible:!1,billAssetsLoading:!1,matchState:"0,1",billAssets:[],assetIdsState:[],deleteDialogVisible:!1,deleteColumns:R.JR,deleteErrorData:[],completedDialogVisible:!1,completedLoading:{target:".completed-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},completedForm:{repairBackData:(0,x.X$)()},completedFormRules:{repairBackData:[{type:"string",required:!0,message:this.$t("h.tips4")+this.$t("h.completionDateOfRepairs"),trigger:"change"}]},completedErrorDialogVisible:!1,completedColumns:R.eU,completedErrorData:[],billPrintTemplate:[],repairTemplateId:"",billDetaulVal:null,printAssets:[]}},computed:{...(0,k.rn)(["userInfo","assetTableHeader","stateListData"]),billAssetsColumns(){let e=[];return this.assetTableHeader.forEach((t=>{"assetCode"==t.attr||"type"==t.attr||"name"==t.attr||"model"==t.attr||"assertPosition"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,minWidth:(0,x.Uh)(t.label),showOverflowTooltip:!0}):"photo"==t.attr&&e.push({type:"image",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,x.Uh)(t.label)})})),e},assetsColumns(){let e=[];return this.assetTableHeader.forEach((t=>{"state"==t.attr?e.push({type:"assetState",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,x.Uh)(t.label),formatter:e=>this.stateListData.find((i=>i._id==e[t.attr])).label}):"assetCode"==t.attr||"type"==t.attr||"name"==t.attr||"model"==t.attr||"assertPosition"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,minWidth:(0,x.Uh)(t.label),showOverflowTooltip:!0}):"photo"==t.attr&&e.push({type:"image",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,x.Uh)(t.label)})})),e},isDisabled(){if(0==this.selectRepairBills.length)return!0;if(1==this.selectRepairBills.length){if(""!=this.selectRepairBills[0].repairBackData&&null!=this.selectRepairBills[0].repairBackData||0!=this.selectRepairBills[0].status)return!0}else for(let e=0;e<this.selectRepairBills.length;e++)if(""!=this.selectRepairBills[e].repairBackData&&null!=this.selectRepairBills[e].repairBackData||0!=this.selectRepairBills[e].status)return!0;return!1}},methods:{getRepairBills(){this.tableLoading=!0,null==this.filterForm.deptId&&(this.filterForm.deptId=[]),null==this.filterForm.receiveData&&(this.filterForm.receiveData=[]),null==this.filterForm.repairBackData&&(this.filterForm.repairBackData=[]),(0,C.Ys)({func:"S0009",token:this.userInfo.token,userId:this.userInfo._id,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,repairCode:this.filterForm.repairCode.join(","),deptId:this.filterForm.deptId.join(","),status:this.filterForm.status.join(","),receiveData:this.filterForm.receiveData.join(","),repairBackData:this.filterForm.repairBackData.join(","),andLike:this.andLike}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.repairBills=e.data[1],this.repairBills.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image),e.company=window.sessionStorage.getItem("loginCompanyName")}))})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},handleSelectionChange(e){this.selectRepairBills=e},checkBillDetail(e){this.billFormDetail=(0,R.EL)(e),this.billDetaulVal=e,this.detailMatchAssetIds=e.assetIds.split(","),this.detailMatchAssetIds.length&&this.getMatchAssets(),this.getBillsAuditMessage(e),this.billDetailDialogVisible=!0},getDepts(){(0,C.Ys)({func:"S0004",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.depts=e.data,this.treeDepts=(0,I.M)(e.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},staffRemoteMethod(e){if(!e)return this.staffData=[],!1;(0,C.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{andLike:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.staffData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},mapHighFilterTags(){this.highFilterTags=[];for(let e in this.filterForm)if(this.filterForm[e]&&this.filterForm[e].length)if("repairCode"==e){let t={},i=[];this.$refs.highFilterStaffSelectref.selected.forEach((e=>{i.push(e.label)})),t.name=this.$t("h.repairApplicant"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("deptId"==e){let t={},i=[];this.filterForm[e].forEach((e=>{let t=this.depts.find((t=>t._id==e)).deptName;i.push(t)})),t.name=this.$t("h.reportDepartment"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("status"==e){let t={},i=[];this.filterForm[e].forEach((e=>{let t=this.statusListData.find((t=>t.value==e)).label;i.push(t)})),t.name=this.$t("h.auditStatus"),t.keyStr=e,t.value=i.join(","),this.highFilterTags.push(t)}else if("receiveData"==e){let t={};t.name=this.$t("h.reportDate"),t.keyStr=e,t.value=this.filterForm[e].join(this.$t("h.to")),this.highFilterTags.push(t)}else if("repairBackData"==e){let t={};t.name=this.$t("h.completionDateOfRepairs"),t.keyStr=e,t.value=this.filterForm[e].join(this.$t("h.to")),this.highFilterTags.push(t)}},handleCloseFilterTag(e){this.highFilterTags.splice(this.highFilterTags.indexOf(e),1),this.filterForm[e.keyStr]=[],this.paginationForm.currentPage=1,this.getRepairBills()},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getRepairBills()},resetFilterForm(){this.$refs["filterFormRef"].resetFields(),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getRepairBills()},findAssetSearch(){this.paginationForm.currentPage=1,this.getRepairBills()},billPopAsterLeave(){this.billPhotoFile=""},uploadBillPhoto(e){return this.uploadImgLoading=!0,this.billPhotoFile?0!=e.status?(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips115"))):void(0,C.Vx)({func:"U0062",token:this.userInfo.token,userId:this.userInfo._id,requstData:{id:e._id,type:e.roleRule.slice(0,2),image:this.billPhotoFile,permissonId:28}}).then((({data:t})=>{if(this.uploadImgLoading=!1,0!=t.code)return this.$message.error(t.data);this.$message.success(t.data),this.$refs[`uploadPopoverRef-${e._id}`].doClose(),this.getRepairBills()})).catch((()=>(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips18"))))):(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips114")))},billsExportDialogVisibleClose(){this.$refs.exportFormRef.resetFields(),this.exportPercentage=0,this.exportStep="",this.exportErrorContent=""},submitExportForm(){this.exportStep="loading",this.exportPercentage=50,null==this.exportForm.deptId&&(this.exportForm.deptId=[]),null==this.exportForm.receiveData&&(this.exportForm.receiveData=[]),null==this.exportForm.repairBackData&&(this.exportForm.repairBackData=[]),(0,C.Vx)({func:"U0033",userId:this.userInfo._id,token:this.userInfo.token,requstData:{repairCode:this.exportForm.repairCode.join(","),deptId:this.exportForm.deptId.join(","),status:this.exportForm.status.join(","),receiveData:this.exportForm.receiveData.join(","),repairBackData:this.exportForm.repairBackData.join(","),permissonId:56}}).then((({data:e})=>{if(this.exportPercentage=100,0!=e.code)return this.exportStep="error",void(this.exportErrorContent=e.data);this.exportStep="success",(0,x.M)(window.$EXCEL_URL+e.data)})).catch((()=>{this.exportPercentage=100,this.exportStep="error",this.exportErrorContent=this.$t("h.tips18")}))},billDetailDialogVisibleClosed(){this.billDetaulVal=null,this.detailAssets=[],this.detailTotal=0,this.detailPaginationForm.currentPage=1,this.detailPaginationForm.pageSize=20,this.detailMatchAssetIds=[],this.printAssets=[],this.$refs["detailTableRef"].$refs["dsTableRef"].clearSelection()},getMatchAssets(){this.detailLoading=!0,this.$nextTick((()=>{this.$refs.detailTableRef.$refs.dsTableRef.bodyWrapper.scrollTop=0})),(0,C.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:[{key:"_id",handle:"OIS",value:this.detailMatchAssetIds.join(",")}],page:this.detailPaginationForm.pageSize,index:this.detailPaginationForm.currentPage}}).then((({data:e})=>{if(this.detailLoading=!1,0!=e.code)return this.$message.error(e.data);this.detailTotal=e.data[0],this.detailAssets=e.data[1]})).catch((()=>{this.detailLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getBillsAuditMessage(e){(0,C.Ys)({func:"S0053",token:this.userInfo.token,userId:this.userInfo._id,requstData:{_id:e._id,type:"WX"}}).then((({data:t})=>{if(0!=t.code)return this.$message.error(t.data);this.auditStep=this.createBillAuditMessage(e,t.data)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},createBillAuditMessage(e,t){let i=[];return e.examineOne&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName1"),auditState:"more"}),e.examineTwo&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName2"),auditState:"more"}),e.examineThree&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName3"),auditState:"more"}),e.examineFour&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName4"),auditState:"more"}),e.examineFive&&i.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName5"),auditState:"more"}),i.forEach(((e,i)=>{if(t[i])if(void 0!=t[i].rejection){for(let a in t[i])"rejection"!=a&&(e.auditStaffName=t[i][a]);e.auditState="error",e.message=t[i].rejection}else{for(let a in t[i])"rejection"!=a&&(e.auditStaffName=t[i][a]);e.auditState="success"}})),i.push({state:"end"}),i},newBillsDialogOpened(){this.$refs.repairFormRef.clearValidate(),this.$refs.billAssetsRef.$refs.dsTableRef.clearSelection()},newBillsDialogClose(){this.selectBillAssets=[],this.billAssets=[],this.assetIdsState=[],this.repairForm._id="",this.repairForm.deptId="",this.repairForm.repairName="",this.repairForm.repairTel="",this.repairForm.maintainMoney="",this.repairForm.maintainPerson="",this.repairForm.maintainReason="",this.repairForm.receiveData="",this.repairForm.repairBackData="",this.repairForm.repairBeizhu="",this.repairForm.repairCode="",this.repairForm.repairCompany="",this.newBillTitle=this.$t("h.title68"),this.$refs.billsTableRef.$refs.dsTableRef.clearSelection()},deleteBillSelectAssets(){this.selectBillAssets.forEach((e=>{this.billAssets.splice(this.billAssets.findIndex((t=>t._id===e._id)),1)})),this.$refs.billAssetsRef.$refs.dsTableRef.clearSelection()},deptInput(e){if(!e)return!1;let t=this.staffData.filter((t=>t.deptId==e));if(t.length){let e=t.find((e=>e._id==this.repairForm.repairCode));e||(this.repairForm.repairCode="")}else this.repairForm.repairCode=""},staffSelectChange(e){if(!e)return!1;this.repairForm.deptId=this.staffData.find((t=>t._id==e)).deptId},billAssetsSelectionChange(e){this.selectBillAssets=e},sbumitRepairForm(){this.$refs.repairFormRef.validate((e=>{if(!e)return!1;if(!this.billAssets.length)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips112")});const t=this.$loading(this.dialogLoading);let i=""==this.repairForm._id?36:38,a=[],r=[],s=[],l=[];this.billAssets.forEach((e=>{let t=this.assetIdsState.find((t=>t._id==e._id));t?l.push(t.state):l.push(e.state),a.push(e._id),r.push(e.name),s.push(e.assetCode)})),(0,C.Vx)({func:"U0010",token:this.userInfo.token,userId:this.userInfo._id,requstData:{_id:this.repairForm._id,assetIds:a.join(","),assetNames:r.join(","),assertCodes:s.join(","),deptId:this.repairForm.deptId,repairCode:this.repairForm.repairCode,repairName:this.repairForm.repairName,repairCompany:this.repairForm.repairCompany,repairTel:this.repairForm.repairTel,receiveData:this.repairForm.receiveData,maintainPerson:this.repairForm.maintainPerson,repairBeizhu:this.repairForm.repairBeizhu,repairBackData:this.repairForm.repairBackData,maintainMoney:this.repairForm.maintainMoney,maintainReason:this.repairForm.maintainReason,repairOpera:this.userInfo.staffName,repairState:"3",fromState:l.join(","),permissonId:i}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.newBillsDialogVisible=!1,this.paginationForm.currentPage=1,this.getRepairBills()})).catch((()=>{t.close(),this.$message.error(this.$t("h.tips18"))}))}))},savaSelectAssets(e){this.billAssets=e,this.matchAssetsDialogVisible=!1},editRepairForm(){if(!this.selectRepairBills.length||this.selectRepairBills.length>1)return this.$message.error(this.$t("h.tips110"));if(-1!=this.selectRepairBills[0].status)return this.$message.error(this.$t("h.tips111"));this.getMatchEditAssets(this.selectRepairBills[0].assetIds),this.repairForm._id=this.selectRepairBills[0]._id,this.repairForm.deptId=this.selectRepairBills[0].deptId,this.repairForm.repairName=this.selectRepairBills[0].repairName,this.repairForm.repairTel=this.selectRepairBills[0].repairTel,this.repairForm.maintainMoney=this.selectRepairBills[0].maintainMoney,this.repairForm.maintainPerson=this.selectRepairBills[0].maintainPerson,this.repairForm.maintainReason=this.selectRepairBills[0].maintainReason,this.repairForm.receiveData=this.selectRepairBills[0].receiveData,this.repairForm.repairBackData=this.selectRepairBills[0].repairBackData,this.repairForm.repairBeizhu=this.selectRepairBills[0].repairBeizhu,this.repairForm.repairCode=this.selectRepairBills[0].repairCode,this.repairForm.repairCompany=this.selectRepairBills[0].repairCompany;let e=this.selectRepairBills[0].assetIds.split(","),t=this.selectRepairBills[0].fromState.split(",");e.forEach(((i,a)=>{this.assetIdsState.push({_id:e[a],state:t[a]})})),this.newBillTitle=this.$t("h.title69"),this.newBillsDialogVisible=!0},getMatchEditAssets(e){this.billAssetsLoading=!0,(0,C.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:[{key:"_id",handle:"OIS",value:e}]}}).then((({data:e})=>{if(this.billAssetsLoading=!1,0!=e.code)return this.$message.error(e.data);this.billAssets=e.data})).catch((()=>{this.billAssetsLoading=!1,this.$message.error(this.$t("h.tips18"))}))},deleteDialogVisibleClosed(){this.deleteErrorData=[]},deleteRepairBills(){if(0==this.selectRepairBills.length)return this.$message.error(this.$t("h.tips22"));for(let e=0;e<this.selectRepairBills.length;e++)if(-1!=this.selectRepairBills[e].status)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips116")});this.$confirm(this.$t("h.tips117"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{this.tableLoading=!0,this.deleteErrorData=[],this.multiDeleteBill(0)})).catch((()=>{this.$message.info(this.$t("h.tips98"))}))},multiDeleteBill(e){if(e>this.selectRepairBills.length-1)return this.paginationForm.currentPage=1,this.getRepairBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.deleteErrorData.length?this.deleteDialogVisible=!0:this.$message.success(this.$t("h.tips118")));(0,C.SR)({func:"D0009",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.selectRepairBills[e]._id,permissonId:37}}).then((({data:t})=>{0!=t.code&&this.deleteErrorData.push({roleRule:this.selectRepairBills[e].roleRule,assetNames:this.selectRepairBills[e].assetNames,reason:t.data}),this.multiDeleteBill(++e)})).catch((()=>{this.deleteErrorData.push({roleRule:this.selectRepairBills[e].roleRule,assetNames:this.selectRepairBills[e].assetNames,reason:this.$t("h.tips18")}),this.multiDeleteBill(++e)}))},completedRepair(){this.completedDialogVisible=!0},completedDialogOpened(){},completedDialogClose(){this.$refs.completedFormRef.resetFields()},sbumitCompletedForm(){this.$refs.completedFormRef.validate((e=>{if(!e)return!1;const t=this.$loading(this.completedLoading);this.completedErrorData=[],this.multiCompleted(0,t)}))},multiCompleted(e,t){if(e>this.selectRepairBills.length-1)return t.close(),this.completedDialogVisible=!1,this.paginationForm.currentPage=1,this.getRepairBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.completedErrorData.length?this.completedErrorDialogVisible=!0:this.$message.success(this.$t("h.repairCompleteBtn")));this.selectRepairBills[e].permissonId=38,this.selectRepairBills[e].repairBackData=this.completedForm.repairBackData,(0,C.Vx)({func:"U0010",userId:this.userInfo._id,token:this.userInfo.token,requstData:this.selectRepairBills[e]}).then((({data:i})=>{0!=i.code&&this.completedErrorData.push({roleRule:this.selectRepairBills[e].roleRule,assetNames:this.selectRepairBills[e].assetNames,reason:i.data}),this.multiCompleted(++e,t)})).catch((()=>{this.completedErrorData.push({roleRule:this.selectRepairBills[e].roleRule,assetNames:this.selectRepairBills[e].assetNames,reason:this.$t("h.tips18")}),this.multiCompleted(++e,t)}))},completedErrorDialogVisibleClosed(){this.completedErrorData=[]},openPrintSet(){this.$refs["vptRef"].printTempDialogVisible=!0},getBillPrintTemplate(){(0,C.Ys)({func:"S0034",userId:this.userInfo._id,token:this.userInfo.token,requstData:{type:"WX"}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.billPrintTemplate=e.data,this.repairTemplateId=localStorage.getItem("repairTemplateId"),this.billPrintTemplate.some((e=>e._id==this.repairTemplateId))||(this.repairTemplateId=this.billPrintTemplate[0]._id,localStorage.setItem("repairTemplateId",this.repairTemplateId))})).catch((()=>{this.$message.error(this.$t("h.tips119"))}))},setBillPrintTemplate(e){this.repairTemplateId=e,window.localStorage.setItem("repairTemplateId",e)},goPrintBills(){return 0==this.selectRepairBills.length?this.$message.error(this.$t("h.tips121")):this.selectRepairBills.length>10?this.$message.error(this.$t("h.tips122")+10+this.$t("h.tips123")):void(this.$refs["vpdRef"].voucherPrintDialogVisible=!0)},selectPrintAssets(e){this.printAssets=e},printBillAssets(){return console.log(this.billDetaulVal),0!=this.billDetaulVal.status?this.$message.error(this.$t("h.tips115")):this.printAssets.length?void(this.$refs.apdRef.dialogVisible=!0):this.$message.error(this.$t("h.tips124"))}},created(){this.getRepairBills(),this.getDepts(),this.getBillPrintTemplate()}},_=y,T=i(1001),w=(0,T.Z)(_,a,r,!1,null,"16a22d7c",null),P=w.exports},6214:function(e,t,i){i.d(t,{M:function(){return a}});const a={specialPlaneL:/0\d{2,3}-\d{7,8}/,mobile:/^((0\d{2,3}-\d{7,8})|(1[3456789]\d{9}))$/,qq:/^[1-9][0-9]{4,14}$/,email:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,password:/(?!^(\d+|[a-zA-Z]+|[~!@#$%^&*?]+)$)^[\w~!@#$%^&*?]{8,18}$/,goalQuota:/^(?:0|[1-9][0-9]?|100)(\.[0-9]{0,2})?$/,money:/^(\d{1,12}(\.\d{0,6})?)?$/}}}]);