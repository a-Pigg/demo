"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[5923],{5791:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"filter-drawer"},[t("el-drawer",{attrs:{title:e.$t("h.advancedBtn"),size:550,direction:"rtl",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"filter-form"},[e._t("default")],2),t("div",{staticClass:"filter-btn"},[e._t("set"),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitFilterForm}},[e._v(e._s(e.$t("h.saveBtn")))]),t("el-button",{attrs:{size:"small"},on:{click:e.resetFilterForm}},[e._v(e._s(e.$t("h.resetBtn")))])],2)])],1)},a=[],i={name:"DsFilterDrawer",data(){return{}},props:{filterDrawerVisible:{type:Boolean}},computed:{drawer:{get(){return this.filterDrawerVisible},set(e){this.$emit("update:filterDrawerVisible",e)}}},methods:{submitFilterForm(){this.$emit("submitFilterForm")},resetFilterForm(){this.$emit("resetFilterForm")}}},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"05535b94",null),u=h.exports},17817:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-filter-tag"},e._l(e.tagsData,(function(s){return t("el-tag",{key:s.keyStr,attrs:{size:e.tagSize,effect:"dark",closable:""},on:{close:function(t){return e.handleClose(s)}}},[e._v(" "+e._s(s.name)+":"+e._s(s.value.length>8?s.value.substring(0,7)+"...":s.value)+" ")])})),1)},a=[],i={name:"DsFilterTag",data(){return{tags:[{name:this.$t("h.label1"),type:""},{name:this.$t("h.label2"),type:"success"},{name:this.$t("h.label3"),type:"info"},{name:this.$t("h.label4"),type:"warning"},{name:this.$t("h.label5"),type:"danger"}]}},props:{filterTagsData:{type:Array,default:()=>[]},tagSize:{type:String,default:"medium"}},computed:{tagsData:{get(){return this.filterTagsData},set(e){this.$emit("update:filterTagsData",e)}}},methods:{handleClose(e){this.$emit("handleCloseTag",e)}}},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"628dc1ca",null),u=h.exports},92003:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"left-panel"},[e._t("default")],2)},a=[],i={name:"DsQueryFormLeftPanel"},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"71d76034",null),u=h.exports},89782:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"right-panel"},[e._t("default")],2)},a=[],i={name:"DsQueryFormRightPanel"},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"c6443ba6",null),u=h.exports},19698:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-query-form"},[e._t("default")],2)},a=[],i={name:"DsQueryForm"},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"6c8bfb78",null),u=h.exports},66403:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-search"},[t("el-input",{attrs:{size:"small",placeholder:e.$t("h.keyword"),"prefix-icon":"el-icon-search"},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value="string"===typeof t?t.trim():t},expression:"value"}},[t("el-button",{attrs:{slot:"suffix",type:"text",size:"small"},on:{click:e.search},slot:"suffix"},[e._v(e._s(e.$t("h.Search")))])],1)],1)},a=[],i={name:"DsSearchBtn",data(){return{}},props:{searchValue:{type:String}},computed:{value:{get(){return this.searchValue},set(e){this.$emit("update:searchValue",e)}}},methods:{search(){this.$emit("search")},onInput(e){""==e&&this.search()}}},r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"5bd7b965",null),u=h.exports},52086:function(e,t,s){s.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("el-select",{ref:"selectRef",staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"","filter-method":e.selectFilter,placeholder:e.placeholder,disabled:e.disabled,"value-key":e.defaultProps["value"],multiple:e.multiple,"collapse-tags":e.collapseTags},on:{clear:e.clearSelectValue,"remove-tag":e.removeSelectTag,focus:e.FocusSelect},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},[t("el-option",{key:"x",attrs:{hidden:"",value:"x",label:"x"}}),e._l(e.valueData,(function(s,l){return t("el-option",{key:l,attrs:{hidden:"",value:s[e.defaultProps["value"]],label:s[e.defaultProps["label"]]}})})),e.multiple?t("el-checkbox",{staticStyle:{margin:"0 0 0 26px"},attrs:{"text-color":"#409EFF"},on:{change:e.checkboxChange},model:{value:e.checkedValue,callback:function(t){e.checkedValue=t},expression:"checkedValue"}},[e._v(e._s(e.$t("h.title52")))]):e._e(),e.multiple?t("div",{staticClass:"line"}):e._e(),t("el-tree",{ref:"treeRef",attrs:{"highlight-current":"","node-key":e.defaultProps["value"],data:e.treeData,props:e.defaultProps,"show-checkbox":e.multiple,"check-strictly":e.checkStrictly,"expand-on-click-node":e.isLastNode,"filter-node-method":e.treeFilterNode},on:{check:e.clickCheckBox,"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function({node:s,data:l}){return t("span",{staticClass:"tree-text"},[e._v(" "+e._s(l.code+"-"+s.label)+" ")])}}])})],2)},a=[],i=(s(57658),{data(){return{selectValue:null,valueData:[],checkedValue:!1}},props:{placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},treeData:{type:Array,default:()=>[]},defaultProps:{type:Object,default:()=>({value:"_id",label:"name",children:"children"})},multiple:{type:Boolean,default:!1},collapseTags:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},isLastNode:{type:Boolean,default:!1},initData:{type:[Array,Number,String]},value:{type:[Array,Number,String]}},watch:{value:{handler(e){this.multiple?(this.selectValue=e,this.valueData=[],this.$nextTick((()=>{e instanceof Array==0?this.$refs.treeRef.setCheckedKeys([]):this.$refs.treeRef.setCheckedKeys(e);let t=this.$refs.treeRef.getCheckedNodes();this.valueData=t}))):(this.selectValue=e,this.valueData=[],this.$nextTick((()=>{this.$refs.treeRef.setCurrentKey(e);let t=this.$refs.treeRef.getCurrentNode();t&&this.valueData.push(t)})))},immediate:!0,deep:!0}},methods:{clearSelectValue(){this.multiple?this.selectValue=[]:this.selectValue=null,this.valueData=[],this.multiple?this.$refs.treeRef.setCheckedKeys([]):this.$refs.treeRef.setCurrentKey(null),this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},removeSelectTag(e){if(!this.multiple)return!1;if(this.checkStrictly)this.valueData.splice(this.valueData.findIndex((t=>t[this.defaultProps.value]==e)),1),this.$nextTick((()=>{this.$refs.treeRef.setCheckedKeys(this.selectValue)}));else{this.valueData.splice(this.valueData.findIndex((t=>t[this.defaultProps.value]==e)),1);let t=this.$refs.treeRef.getCheckedNodes(!0,!1);for(let s=0;s<t.length;s++)if(t[s][this.defaultProps.value]==e){t.splice(s,1);break}this.$nextTick((()=>{this.$refs.treeRef.setCheckedNodes(t)}))}this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},FocusSelect(){this.$refs.treeRef.filter("")},clickCheckBox(e,t){if(this.checkStrictly)if(e.children&&0!=e.children.length){const s=e[this.defaultProps.value];if(-1!=this.selectValue.indexOf(s))this.selectValue.splice(this.selectValue.findIndex((e=>e==s)),1),this.valueData.splice(this.valueData.findIndex((e=>e[this.defaultProps.value]==s)),1),this.$refs.treeRef.setCheckedKeys(this.selectValue);else{let s=this.lookForAllId(e.children),l=this.lookForAll(e.children);this.valueData=this.dsNewSet([...t.checkedNodes,...l],!0),this.selectValue=this.dsNewSet([...t.checkedKeys,...s],!1),this.$refs.treeRef.setCheckedKeys(this.selectValue)}}else this.valueData=t.checkedNodes,this.selectValue=t.checkedKeys,this.$refs.treeRef.setCheckedKeys(this.selectValue);else 0==t.halfCheckedKeys.length?(this.valueData=t.checkedNodes,this.selectValue=t.checkedKeys):(this.valueData=[...t.checkedNodes,...t.halfCheckedNodes],this.selectValue=[...t.checkedKeys,...t.halfCheckedKeys]);this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)},clickNode(e,t,s){if(this.multiple)return!1;if(this.isLastNode){if(null!=e.children)return!1;this.selectValue=e[this.defaultProps.value],this.valueData=[e],this.$refs.treeRef.setCurrentKey(e[this.defaultProps.value])}else this.selectValue=e[this.defaultProps.value],this.valueData=[e],this.$refs.treeRef.setCurrentKey(e[this.defaultProps.value]);this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue,e),this.$refs.selectRef.blur()},removeNode(e){this.$refs.treeRef.remove(e)},lookForAllId(e=[],t=[]){for(let s of e)t.push(s[this.defaultProps.value]),s.children&&s.children.length&&this.lookForAllId(s.children,t);return t},lookForAll(e=[],t=[]){for(let s of e)t.push(s),s.children&&s.children.length&&this.lookForAll(s.children,t);return t},dsNewSet(e,t){if(t){const t=new Map;return e.filter((e=>!t.has(e[this.defaultProps.value])&&t.set(e[this.defaultProps.value],1)))}for(var s=0;s<e.length;s++)for(var l=s+1;l<e.length;l++)e[s]==e[l]&&e.splice(l,1);return e},selectFilter(e){this.$refs.treeRef.filter(e)},treeFilterNode(e,t){return!e||-1!==t[this.defaultProps.label].indexOf(e)},checkboxChange(e){e?(this.valueData=this.lookForAll(this.treeData),this.selectValue=this.lookForAllId(this.treeData),this.$refs.treeRef.setCheckedKeys(this.lookForAllId(this.treeData))):(this.$refs.treeRef.setCheckedKeys([]),this.selectValue=null,this.valueData=[]),this.$emit("input",this.selectValue),this.$emit("selectTree",this.selectValue)}}}),r=i,n=s(1001),h=(0,n.Z)(r,l,a,!1,null,"1a3a05b9",null),u=h.exports},4668:function(e,t,s){s.r(t),s.d(t,{default:function(){return D}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"category-used"},[t("el-card",{staticClass:"used-card"},[t("div",{staticClass:"used-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel"),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.getUsedBills}})],1)],1)],1),t("div",{staticClass:"used-card-content"},[t("div",{staticClass:"bills-filter"},[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}}),t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.filterDrawerVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"bills-table"},[t("ds-table",{attrs:{loading:e.tableLoading,tableConfig:{},columns:e.billsColums,tableData:e.usedBills,rowKey:e=>e._id,treeProps:{children:"children"}}})],1),t("ul",{staticClass:"bills-num"},e._l(e.usedNum,(function(s,l){return t("li",{key:l,staticClass:"item"},[t("span",[e._v(e._s(s.name)+":"+e._s(s.num))])])})),0)])]),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.filterDrawerVisible},on:{"update:filterDrawerVisible":function(t){e.filterDrawerVisible=t},"update:filter-drawer-visible":function(t){e.filterDrawerVisible=t},submitFilterForm:e.submitFilterForm,resetFilterForm:e.resetFilterForm}},[t("el-form",{ref:"filterFormRef",attrs:{"label-width":"140px","label-position":"center",model:e.filterForm}},e._l(e.filterFormHead,(function(s){return t("el-form-item",{key:s.prop,attrs:{label:s.label,prop:s.prop}},["state"==s.prop?t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:"","collapse-tags":""},model:{value:e.filterForm.state,callback:function(t){e.$set(e.filterForm,"state",t)},expression:"filterForm.state"}},e._l(e.stateListData,(function(e){return t("el-option",{key:e._id,attrs:{label:e.label,value:e._id}})})),1):e._e(),"deptId"==s.prop?t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.department"),treeData:e.treeDepts,defaultProps:{children:"children",label:"deptName",value:"_id"},checkStrictly:!0,multiple:!0,collapseTags:""},model:{value:e.filterForm.deptId,callback:function(t){e.$set(e.filterForm,"deptId",t)},expression:"filterForm.deptId"}}):e._e(),"classifyId"==s.prop?t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.classification"),treeData:e.treeAssetTypes,defaultProps:{children:"children",label:"classifyName",value:"_id"},collapseTags:!0,checkStrictly:!0,multiple:!0},model:{value:e.filterForm.classifyId,callback:function(t){e.$set(e.filterForm,"classifyId",t)},expression:"filterForm.classifyId"}}):e._e(),"warehouseId"==s.prop?t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.assetAreaData,modelField:"_id",model:e.filterForm.warehouseId.join(","),searchField:"andLike",func:"S0003",userInfo:e.userInfo},expression:"{\n            options: assetAreaData,\n            modelField: '_id',\n            model: filterForm.warehouseId.join(','),\n            searchField: 'andLike',\n            func: 'S0003',\n            userInfo: userInfo,\n          }"}],ref:"filterWareSelectRef",refInFor:!0,attrs:{placeholder:e.$t("h.tips4"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.filterForm.warehouseId,callback:function(t){e.$set(e.filterForm,"warehouseId",t)},expression:"filterForm.warehouseId"}},e._l(e.assetAreaData,(function(s){return t("el-option",{key:s._id,attrs:{label:s.warehouseName,value:s._id}},[t("span",[e._v(" "+e._s(s.code)+" - "+e._s(s.warehouseName)+" ")])])})),1):e._e()],1)})),1)],1)],1)},a=[],i=(s(57658),s(52086)),r=s(60983),n=s(5791),h=s(17817),u=s(66403),o=s(19698),d=s(92003),c=s(89782),f=s(20629),p=s(79992),m=s(83151),v=s(55886),b=s(76080),g={components:{DsSelectTree:i.Z,DsTable:r.Z,DsFilterDrawer:n.Z,DsFilterTag:h.Z,DsSearchBtn:u.Z,DsQueryForm:o.Z,DsQueryFormLeftPanel:d.Z,DsQueryFormRightPanel:c.Z},data(){return{tableLoading:!1,usedBills:[],usedNum:[],filterDrawerVisible:!1,highFilterTags:[],depts:[],treeDepts:[],assetTypes:[],treeAssetTypes:[],assetAreaData:[],filterForm:{state:[],classifyId:[],warehouseId:[],deptId:[]},andLike:""}},computed:{...(0,f.rn)(["userInfo","assetTableHeader","assetFormHeader","stateListData"]),filterFormHead(){let e=[];return this.assetFormHeader.forEach((t=>{let s={};"useDept"==t.dbDataName?(s.prop="deptId",s.label=t.nameShow,e.push(s)):"type"==t.dbDataName?(s.prop="classifyId",s.label=t.nameShow,e.push(s)):"assertPosition"==t.dbDataName?(s.prop="warehouseId",s.label=t.nameShow,e.push(s)):"state"==t.dbDataName&&(s.prop="state",s.label=t.nameShow,e.push(s))})),e},billsColums(){let e=[];return this.assetTableHeader.forEach((t=>{"type"==t.attr&&e.push({type:"expand",prop:"classifyName",label:t.label,fixed:t.fixed,minWidth:(0,p.Uh)(t.label),showOverflowTooltip:!0})})),e.push({prop:"count",label:this.$t("h.totalAssets"),fixed:!1,minWidth:(0,p.Uh)(this.$t("h.totalAssets")),showOverflowTooltip:!0}),[...e,...m.DX]}},methods:{getDepts(){(0,b.Ys)({func:"S0004",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.depts=e.data,this.treeDepts=(0,v.M)(e.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getAssetType(){(0,b.Ys)({func:"S0006",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.treeAssetTypes=(0,v.M)(e.data,null),this.assetTypes=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getUsedBills(){this.tableLoading=!0,(0,b.Ys)({func:"S0044",userId:this.userInfo._id,token:this.userInfo.token,requstData:{state:this.filterForm.state.join(","),classifyId:this.filterForm.classifyId.join(","),warehouseId:this.filterForm.warehouseId.join(","),deptId:this.filterForm.deptId.join(","),andLike:this.andLike}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.usedBills=[],this.$message.error(e.data);this.usedNum=e.data[3].map(((e,t)=>0==t?{name:this.$t("h.idleAsset"),num:e}:1==t?{name:this.$t("h.occupiedAsset"),num:e}:2==t?{name:this.$t("h.lendingAsset"),num:e}:3==t?{name:this.$t("h.servicingAsset"),num:e}:4==t?{name:this.$t("h.scrappedAsset"),num:e}:5==t?{name:this.$t("h.inTransferAsset"),num:e}:void 0)),this.usedNum[this.usedNum.length]={name:"合计",num:this.usedNum[0].num+this.usedNum[1].num+this.usedNum[2].num+this.usedNum[3].num+this.usedNum[4].num+this.usedNum[5].num};let t=e.data[2].map((e=>(e.state||(e.state=[0,0,0,0,0,0]),{_id:e._id,subId:e.subId,classifyName:e.classifyName,idle:e.state[0],use:e.state[1],loan:e.state[2],maintain:e.state[3],scrap:e.state[4],shift:e.state[5],sum:e.state[0]+e.state[1]+e.state[2]+e.state[3]+e.state[4]+e.state[5]})));this.usedBills=(0,v.M)(t,null)})).catch((()=>{this.tableLoading=!1,this.usedBills=[],this.$message.error(this.$t("h.tips18"))}))},mapHighFilterTags(){this.highFilterTags=[];for(let e in this.filterForm)if(this.filterForm[e]&&this.filterForm[e].length)if("warehouseId"==e){let t={},s=[];this.$refs.filterWareSelectRef[0].selected.forEach((e=>{s.push(e.label)})),t.name=this.assetFormHeader.find((e=>"assertPosition"==e.dbDataName)).nameShow,t.keyStr=e,t.value=s.join(","),this.highFilterTags.push(t)}else if("deptId"==e){let t={},s=[];this.filterForm[e].forEach((e=>{let t=this.depts.find((t=>t._id==e)).deptName;s.push(t)})),t.name=this.assetFormHeader.find((e=>"useDept"==e.dbDataName)).nameShow,t.keyStr=e,t.value=s.join(","),this.highFilterTags.push(t)}else if("classifyId"==e){let t={},s=[];this.filterForm[e].forEach((e=>{let t=this.assetTypes.find((t=>t._id==e)).classifyName;s.push(t)})),t.name=this.assetFormHeader.find((e=>"type"==e.dbDataName)).nameShow,t.keyStr=e,t.value=s.join(","),this.highFilterTags.push(t)}else if("state"==e){let t={},s=[];this.filterForm[e].forEach((e=>{let t=this.stateListData.find((t=>t._id==e)).label;s.push(t)})),t.name=this.assetFormHeader.find((e=>"state"==e.dbDataName)).nameShow,t.keyStr=e,t.value=s.join(","),this.highFilterTags.push(t)}},handleCloseFilterTag(e){this.highFilterTags.splice(this.highFilterTags.indexOf(e),1),this.filterForm[e.keyStr]=[],this.getUsedBills()},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.getUsedBills()},resetFilterForm(){this.$refs["filterFormRef"].resetFields(),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.getUsedBills()}},created(){this.getUsedBills(),this.getAssetType(),this.getDepts()}},y=g,k=s(1001),F=(0,k.Z)(y,l,a,!1,null,"4de9a2d8",null),D=F.exports},55886:function(e,t,s){s.d(t,{M:function(){return l}});s(57658);const l=(e,t)=>{const s=[];return e.forEach(((a,i)=>{if(a.subId==t){const t=l(e,a._id);t.length>0&&(a.children=t),s.push(a)}})),s}}}]);