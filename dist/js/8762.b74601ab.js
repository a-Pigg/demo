"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[8762],{98884:function(t,e,s){s.d(e,{Z:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{top:"0","custom-class":"dialog","show-close":!1,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.dialogVisibleClosed}},[e("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"left"},[e("span",[t._v(t._s(t.title))])]),e("div",{staticClass:"right"},[e("i",{staticClass:"el-icon-close",on:{click:function(e){t.dialogVisible=!1}}})])]),e("div",{staticClass:"dialog-body"},[e("ds-table",{attrs:{tableData:t.deleteErrorData,columns:t.deleteColumns,tableConfig:t.errorTableConfig}})],1)])},r=[],a=s(60983),l={components:{DsTable:a.Z},data(){return{errorTableConfig:{index:!0}}},props:{deleteDialogVisible:{type:Boolean,default:!1},deleteErrorData:{type:Array,default:()=>[]},deleteColumns:{type:Array},title:{type:String,default:"删除失败详情"}},computed:{dialogVisible:{get(){return this.deleteDialogVisible},set(t){this.$emit("update:deleteDialogVisible",t)}}},methods:{dialogVisibleClosed(){this.$emit("closed")}}},o=l,n=s(1001),h=(0,n.Z)(o,i,r,!1,null,"3e3e8f93",null),c=h.exports},3701:function(t,e,s){s.d(e,{Z:function(){return v}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"print"},[e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:t.$t("h.title04"),"custom-class":"settingPrintDialog",visible:t.dialogVisible,fullscreen:""},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.lookClose,opened:t.openPrint}},[e("div",{staticClass:"box"},[e("div",{staticClass:"box-1"},[e("div",{staticClass:"tags"},[e("el-row",{attrs:{gutter:10}},t._l(t.pagMultipleSelection,(function(s,i){return e("el-col",{key:i,attrs:{xs:t.colSize,sm:t.colSize,lg:t.colSize}},[e("el-image",{attrs:{src:s.base,lazy:"","preview-src-list":t.assetTagsSrcList}})],1)})),1)],1),e("div",{staticClass:"pag"},[e("el-pagination",{attrs:{"current-page":t.cruuentSize,"page-sizes":[10,20,50],"page-size":t.pageSize,background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.multipleSelection.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.refreshLoading,expression:"refreshLoading"}],staticClass:"box-2"},[e("el-form",{ref:"ruleFormRef",attrs:{model:t.ruleForm,rules:t.ruleFormRules,"label-width":"141px"}},[e("el-form-item",{attrs:{label:t.$t("h.formTips1"),prop:"printName"}},[e("el-select",{ref:"printerSelectRef",attrs:{disabled:t.isTrueImg,placeholder:t.$t("h.tips4")+t.$t("h.formTips1"),clearable:""},on:{change:t.selectChange,clear:t.printSelectClear},model:{value:t.ruleForm.printName,callback:function(e){t.$set(t.ruleForm,"printName",e)},expression:"ruleForm.printName"}},t._l(t.symbol,(function(s,i){return e("el-option",{key:i,attrs:{label:s.name,value:s.value}},[t._v(" "+t._s("RFID"==s.deType?s.name+" - RFID"+t.$t("h.formTips1"):s.name+" - "+t.$t("h.tips47")+"RFID"+t.$t("h.formTips1"))+" ")])})),1),e("el-popover",{attrs:{placement:"top-start",title:t.$t("h.formTips1")+t.$t("h.tips46"),width:"200",trigger:"hover"}},[e("div",[t._v(" "+t._s(t.$t("h.formTips1")+t.$t("h.tips48"))+":"+t._s(t.printerName)),e("br"),t._v(t._s(t.$t("h.formTips1")+t.$t("h.tips49"))+":"+t._s("RFID"==t.printerType?"RFID"+t.$t("h.formTips1"):t.$t("h.tips47")+"RFID"+t.$t("h.formTips1"))+" ")]),e("img",{staticClass:"printerInfoIcon",attrs:{slot:"reference",src:s(78509),alt:t.$t("h.tips46")},slot:"reference"})]),e("i",{staticClass:"el-icon-refresh refresh_icon",on:{click:t.refreshPrinter}})],1),e("el-form-item",{attrs:{label:t.$t("h.formTips2"),prop:"printNum"}},[e("el-input-number",{attrs:{min:1,precision:0,size:"small"},model:{value:t.ruleForm.printNum,callback:function(e){t.$set(t.ruleForm,"printNum",e)},expression:"ruleForm.printNum"}})],1),e("el-form-item",{attrs:{label:t.$t("h.formTips3"),prop:"moban"}},[e("el-select",{ref:"printTempSelectRef",attrs:{placeholder:t.$t("h.tips4")+t.$t("h.formTips3")},on:{change:t.templateSelectChange},model:{value:t.ruleForm.moban,callback:function(e){t.$set(t.ruleForm,"moban",e)},expression:"ruleForm.moban"}},t._l(t.assetTagsTemplate,(function(t,s){return e("el-option",{key:s,attrs:{label:t.title||t.name,value:t._id}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.formTips4"),prop:"mobanSize"}},[e("el-radio-group",{attrs:{size:"medium"},on:{change:t.mobanSizeChange},model:{value:t.ruleForm.mobanSize,callback:function(e){t.$set(t.ruleForm,"mobanSize",e)},expression:"ruleForm.mobanSize"}},[e("el-radio-button",{attrs:{label:"100%"}}),e("el-radio-button",{attrs:{label:"75%"}}),e("el-radio-button",{attrs:{label:"50%"}}),e("el-radio-button",{attrs:{label:"25%"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{disabled:0==t.exportPrintResultData.length},on:{click:t.catchLastPrintResult}},[t._v(t._s(t.$t("h.viewRecentPrintResults")))])],1),e("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[e("el-collapse-item",{attrs:{title:t.$t("h.formTips5"),name:"1"}},[e("el-form-item",{attrs:{label:t.$t("h.formTips6"),prop:"transverse"}},[e("el-input-number",{attrs:{size:"small",precision:0},model:{value:t.ruleForm.transverse,callback:function(e){t.$set(t.ruleForm,"transverse",e)},expression:"ruleForm.transverse"}}),e("span",{staticStyle:{"margin-left":"10px","font-size":"12px",position:"absolute",width:"165px","line-height":"20px"}},[t._v(t._s(t.$t("h.formTips7")))])],1),e("el-form-item",{attrs:{label:t.$t("h.formTips10"),prop:"longitudinal"}},[e("el-input-number",{attrs:{size:"small",precision:0},model:{value:t.ruleForm.longitudinal,callback:function(e){t.$set(t.ruleForm,"longitudinal",e)},expression:"ruleForm.longitudinal"}}),e("span",{staticStyle:{"margin-left":"10px","font-size":"12px",position:"absolute",width:"165px","line-height":"20px"}},[t._v(t._s(t.$t("h.formTips8")))])],1),e("el-form-item",{attrs:{label:t.$t("h.formTips11"),prop:"concentration"}},[e("el-input-number",{attrs:{max:16,precision:0,min:0,size:"small"},model:{value:t.ruleForm.concentration,callback:function(e){t.$set(t.ruleForm,"concentration",e)},expression:"ruleForm.concentration"}}),e("span",{staticStyle:{"margin-left":"10px","font-size":"12px",position:"absolute",width:"165px","line-height":"20px"}},[t._v(t._s(t.$t("h.formTips9")))])],1),e("el-button",{staticStyle:{"margin-left":"40px"},attrs:{disabled:t.isSave,type:"text"},on:{click:t.saveMarginParam}},[t._v(t._s(t.$t("h.saveCurrentPrintSettings")))])],1),e("el-collapse-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{title:"RFID"+t.$t("h.Set"),name:"2"}},[e("el-form-item",{attrs:{label:"RFID"}},[e("el-checkbox",{model:{value:t.ruleForm.Rfid,callback:function(e){t.$set(t.ruleForm,"Rfid",e)},expression:"ruleForm.Rfid"}})],1),e("el-form-item",{attrs:{label:t.$t("h.userArea")+t.$t("h.printBtn"),prop:"userData"}},[e("el-checkbox",{model:{value:t.ruleForm.desc,callback:function(e){t.$set(t.ruleForm,"desc",e)},expression:"ruleForm.desc"}}),t.ruleForm.desc?e("el-input",{attrs:{placeholder:t.$t("h.tips3")+t.$t("h.tips50"),type:"textarea"},model:{value:t.ruleForm.userData,callback:function(e){t.$set(t.ruleForm,"userData",e)},expression:"ruleForm.userData"}}):t._e()],1),e("el-form-item",{attrs:{label:t.$t("h.acessPassword"),prop:"oldResvSect"}},[e("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:t.$t("h.tips3")+t.$t("h.password")},model:{value:t.ruleForm.oldResvSect,callback:function(e){t.$set(t.ruleForm,"oldResvSect",e)},expression:"ruleForm.oldResvSect"}})],1)],1),e("el-collapse-item",{attrs:{title:t.$t("h.formTips12"),name:"3"}},[e("el-form-item",{attrs:{label:t.$t("h.formTips13")}},[e("el-button",{attrs:{disabled:""==t.facilityKey},on:{click:t.checkRFIDTag}},[t._v(t._s("RFID"==t.printerType?t.$t("h.formTips13")+"RFID"+t.$t("h.formTips14"):t.$t("h.formTips13")+t.$t("h.formTips14")))])],1),e("el-form-item",[e("el-button",{on:{click:t.restartPrinter}},[t._v(t._s(t.$t("h.restartThePrinter")))])],1)],1)],1)],1),e("div",{staticClass:"box2_foot"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v(t._s(t.$t("h.cancelBtn")))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.printingSetout("资产打印")}}},[t._v(t._s(t.$t("h.confirmBtn")))])],1)],1)]),e("div",{staticClass:"version"},[e("div",[t._v(" "+t._s(t.$t("h.title34"))+":"),e("span",[t._v(t._s(t.rfidVersio.rfid_version))])]),e("div",[t._v(" "+t._s(t.$t("h.title35"))+":"),e("span",[t._v(t._s(t.rfidVersio.service_version))])])])]),e("el-dialog",{attrs:{"custom-class":"progressDialog",visible:t.printProgressDialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,top:"0"},on:{"update:visible":function(e){t.printProgressDialogVisible=e},close:function(e){t.printText=""}}},[e("div",{staticClass:"icon"},[e("img",{attrs:{src:s(33642),alt:""}})]),e("div",{staticClass:"planInfo",domProps:{innerHTML:t._s(t.printText)},on:{click:t.closePrintPlan}}),e("div",{staticClass:"ptintTable"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.resultList,height:"100%","row-class-name":t.tableRowClassName}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),e("el-table-column",{attrs:{prop:"ackCode",label:t.$t("h.state"),width:"160"},scopedSlots:t._u([{key:"default",fn:function(s){return["0000"==s.row.ackCode?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title36")))])]:"01"==s.row.ackCode.substring(0,2)?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title37")))])]:"02"==s.row.ackCode.substring(0,2)?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title38")))])]:"04"==s.row.ackCode.substring(0,2)?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title39")))])]:"08"==s.row.ackCode.substring(0,2)?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title40")))])]:"10"==s.row.ackCode.substring(0,2)?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title41")))])]:"ffff"==s.row.ackCode&&"End"==t.printStat?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title42")))])]:"ffff"==s.row.ackCode&&"End"!=t.printStat?[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title43")))])]:[e("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("h.title44")))])]]}}])}),e("el-table-column",{attrs:{label:t.$t("h.formTips15"),width:"65px"},scopedSlots:t._u([{key:"default",fn:function(s){return["ffff"!=s.row.ackCode&&"00"!=s.row.ackCode.substring(0,2)&&"00"!=s.row.ackCode.substring(2)?e("el-tag",{attrs:{size:"mini",type:"danger",effect:"dark"}},[t._v(" "+t._s(s.row.ackCode.substring(2))+" ")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"name",label:t.$t("h.assetName"),"min-width":"100"}}),e("el-table-column",{attrs:{prop:"epc",label:"EPC","min-width":"230"}})],1)],1),e("div",{staticClass:"printBtn"},[e("el-button",{attrs:{disabled:t.exportFlag,type:"success"},on:{click:function(e){t.exportResultDialogVisible=!0}}},[t._v(t._s(t.$t("h.export")))]),e("el-button",{staticStyle:{background:"#473bb4",color:"#fff"},on:{click:function(e){t.printProgressDialogVisible=!1}}},[t._v(t._s(t.$t("h.confirmBtn")))])],1)]),e("el-dialog",{attrs:{top:"0",title:t.$t("h.exportPrintingResults"),"custom-class":"exportResultDialog",visible:t.exportResultDialogVisible},on:{"update:visible":function(e){t.exportResultDialogVisible=e},close:function(e){t.exportForm.fileName=""}}},[e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-form",{ref:"exportFormRef",attrs:{model:t.exportForm,rules:t.exportFormRules}},[e("el-form-item",{attrs:{label:t.$t("h.formTips16"),"label-width":"110px",prop:"fileName"}},[e("el-input",{attrs:{placeholder:t.$t("h.tips3")+t.$t("h.formTips16")},model:{value:t.exportForm.fileName,callback:function(e){t.$set(t.exportForm,"fileName",e)},expression:"exportForm.fileName"}})],1)],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary",disabled:0==t.exportForm.fileName.length},on:{click:t.exportPrintResult}},[t._v(" "+t._s(t.$t("h.confirmBtn"))+" ")])],1)],1)]),e("true-progress-dialog",{ref:"tpdRef",attrs:{loadingTitle:t.$t("h.title45"),successTitle:t.$t("h.title46"),errorTitle:t.$t("h.title47"),percentage:t.percentageNum}})],1)},r=[],a=(s(57658),s(82801),s(76080)),l=s(40926),o=s(92243),n=s(79992),h=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.trueProgressDialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"ture_ProgressDialog",top:"35vh"},on:{"update:visible":function(e){t.trueProgressDialogVisible=e},closed:function(e){t.resultIcon="loading"}}},["loading"==t.resultIcon?e("div",{staticClass:"loading"},[e("span",[t._v(t._s(t.loadingTitle)),e("i",{staticClass:"el-icon-loading"})]),e("el-progress",{attrs:{"text-inside":!0,"stroke-width":26,percentage:t.percentage}})],1):t._e(),"success"==t.resultIcon?e("div",[e("i",{staticClass:"el-icon-success"}),e("span",[t._v(t._s(t.successTitle)+"}")])]):t._e(),"error"==t.resultIcon?e("div",[e("i",{staticClass:"el-icon-error"}),e("span",[t._v(t._s(t.errorTitle))])]):t._e()])},c=[],p={data(){return{trueProgressDialogVisible:!1,resultIcon:"loading"}},props:{percentage:{type:Number,default:0},loadingTitle:{type:String,default:"正在加载中"},successTitle:{type:String,default:"成功"},errorTitle:{type:String,default:"失败"}},methods:{}},m=p,u=s(1001),d=(0,u.Z)(m,h,c,!1,null,"45a38530",null),f=d.exports,g={data(){var t=(t,e,s)=>{const i=localStorage.getItem("lang"),r=/^[A-Za-z0-9]+$/;!r.test(e)&&e||s(),s("EN"==i?new Error("Please enter a combination of letters and numbers"):new Error("请输入字母与数字组合"))},e=(t,e,s)=>{const i=localStorage.getItem("lang"),r=/^[A-Za-z0-9]{4,4}$/;!r.test(e)&&e||s(),s("EN"==i?new Error("Please enter letters or numbers with four digits"):new Error("请输入字母或数字且为四位"))};return{tableData:[],exportResultDialogVisible:!1,exportForm:{fileName:""},exportFormRules:{fileName:[{required:!0,message:"请输入导入文件名称",trigger:"blur"}]},printResultFields:{"资产编码":"assetCode","资产EPC":"EPC","标签写入EPC":"epc"},exportPrintResultData:[],loading:!1,refreshLoading:!1,pageSize:10,cruuentSize:1,exportFlag:!0,resultList:[],printProgressDialogVisible:!1,printText:"",dialogVisible:!1,multipleSelection:[],ruleForm:{printName:"",printNum:"",moban:"",mobanSize:"50%",transverse:"0",longitudinal:"0",concentration:"8",Rfid:!0,desc:!1,password:"",userData:"",oldResvSect:""},ruleFormRules:{printName:[{required:!0,message:"请选择打印机",trigger:"change"}],moban:[{required:!0,message:"请选择标签模板",trigger:"change"}],userData:[{required:!1,message:"请输入用户区信息",trigger:"blur"},{validator:t,trigger:"blur"}],oldResvSect:[{validator:e,trigger:"blur"}]},colSize:8,timer:"",activeNames:["1"],body:{printLab:[]},symbol:[],printer:"",facilityKey:"",ListIndex:"",printerDpi:"",NUMList:[],printerType:"",printerName:"",assetTagsTemplate:[],assetTagsSrcList:[],printSelectList:[],printAssetNames:[],tagsloading:null,percentageNum:0,printStat:null,rfidVersio:{rfid_version:"",service_version:""}}},components:{TrueProgressDialog:f},computed:{pagMultipleSelection(){return this.multipleSelection.slice((this.cruuentSize-1)*this.pageSize,this.cruuentSize*this.pageSize)},isTrueImg(){for(let t=0;t<this.multipleSelection.length;t++)if(this.multipleSelection[t].err)return!0;return!1},isSave(){return!this.printerName}},props:{userInfo:{type:Object,default(){return{}}},selectAssetsData:{type:Array,default(){return[]}}},watch:{"ruleForm.printName"(t){""!=t&&(this.loading=!0,this.printSelectList=[],this.facilityKey?(0,a._u)({code:3,key:this.facilityKey}).then((e=>{this.facilityKey="",(0,a._u)({code:2,devType:this.symbol[this.ListIndex].deType,param:t}).then((async t=>{if(this.$message.success(this.$t("h.tips51")),this.facilityKey=t.data,this.printerName=this.symbol[this.ListIndex].name,this.printerType=this.symbol[this.ListIndex].deType,this.printerName){let t=this.assetTagsTemplate.find((t=>t._id==this.ruleForm.moban)).deviceRelate,e=t.find((t=>-1!=this.printerName.indexOf(t.printModel)));e&&(this.ruleForm.transverse=e.leftMargin,this.ruleForm.longitudinal=e.topMargin,this.ruleForm.concentration=e.printDarkness)}window.localStorage.setItem("facilityKey",t.data),await this.lookPrint(2)})).catch((t=>(this.loading=!1,this.$alert(this.$t("h.tips52"),"Tips",{showClose:!1,confirmButtonText:this.$t("h.confirmBtn"),callback:t=>{this.dialogVisible=!1}}),this.$message(this.$t("h.tips53")))))})).catch((e=>{this.$message.error(this.$t("h.tips54")),(0,a._u)({code:2,devType:this.symbol[this.ListIndex].deType,param:t}).then((async t=>{if(this.$message.success(this.$t("h.tips51")),this.facilityKey=t.data,this.printerName=this.symbol[this.ListIndex].name,this.printerType=this.symbol[this.ListIndex].deType,this.printerName){let t=this.assetTagsTemplate.find((t=>t._id==this.ruleForm.moban)).deviceRelate,e=t.find((t=>-1!=this.printerName.indexOf(t.printModel)));e&&(this.ruleForm.transverse=e.leftMargin,this.ruleForm.longitudinal=e.topMargin,this.ruleForm.concentration=e.printDarkness)}window.localStorage.setItem("facilityKey",t.data),await this.lookPrint(2)})).catch((t=>(this.loading=!1,this.$alert(this.$t("h.tips52"),"Tips",{showClose:!1,confirmButtonText:this.$t("h.confirmBtn"),callback:t=>{this.dialogVisible=!1}}),this.$message(this.$t("h.tips53")))))})):(0,a._u)({code:2,devType:this.symbol[this.ListIndex].deType,param:t}).then((async t=>{if(this.$message.success(this.$t("h.tips51")),this.facilityKey=t.data,this.printerName=this.symbol[this.ListIndex].name,this.printerType=this.symbol[this.ListIndex].deType,this.printerName){let t=this.assetTagsTemplate.find((t=>t._id==this.ruleForm.moban)).deviceRelate,e=t.find((t=>-1!=this.printerName.indexOf(t.printModel)));e&&(this.ruleForm.transverse=e.leftMargin,this.ruleForm.longitudinal=e.topMargin,this.ruleForm.concentration=e.printDarkness)}window.localStorage.setItem("facilityKey",t.data),await this.lookPrint(2)})).catch((t=>(console.log(t),this.loading=!1,this.$alert(this.$t("h.tips52"),"Tips",{showClose:!1,confirmButtonText:this.$t("h.confirmBtn"),callback:t=>{this.dialogVisible=!1}}),this.$message(this.$t("h.tips53"))))))},printSelectList(t,e){let s=this.selectAssetsData.length,i=t.length;this.percentageNum=Math.trunc(i/s*100),s==i&&(this.$refs["tpdRef"].trueProgressDialogVisible=!1,this.print())},exportResultDialogVisible(t){this.exportFormRules.fileName[0].message=this.$t("h.tips3")+this.$t("h.formTips16")}},methods:{async getAssetTagsTemplate(){const{data:t}=await(0,a.Ys)({func:"S0019",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).catch((t=>this.$message.error(this.$t("h.tips18"))));if(0!=t.code)return this.$message.error(t.data);this.assetTagsTemplate=t.data},lookClose(){this.exportPrintResultData=[],this.multipleSelection=[],this.printSelectList=[],this.printerDpi="",this.printerName="",this.assetTagsSrcList=[],this.printAssetNames=[],this.symbol=[],this.facilityKey&&this.closePrint(),this.ruleForm.password="",this.$refs["ruleFormRef"].resetFields(),this.$emit("refreshAssets"),clearInterval(this.timer)},printingSetout(){this.$refs["ruleFormRef"].validate((t=>{if(!t)return!1;this.selectAssetsData.length==this.printSelectList.length?(this.printStat=null,this.print()):(this.$refs["tpdRef"].trueProgressDialogVisible=!0,this.createPrintTags(this.printerDpi))}))},print(){this.printText=this.$t("h.title48"),this.printProgressDialogVisible=!0;let t="";if(this.ruleForm.oldResvSect?(t=this.strToHexCharCode(this.ruleForm.oldResvSect)+"00000000",this.ruleForm.password="00F300A2"+this.strToHexCharCode(this.ruleForm.oldResvSect)):this.ruleForm.password="","RFID"==this.printerType)for(let s=0;s<this.printSelectList.length;s++)this.body.printLab[s]={tag:8,printDpi:parseInt(this.printerDpi),xOffset:parseInt(this.ruleForm.transverse),yOffset:parseInt(this.ruleForm.longitudinal),density:parseInt(this.ruleForm.concentration),epcSect:this.printSelectList[s].EPC,userSect:this.strToHexCharCode(this.ruleForm.userData),lockLab:0,encodeLab:0,startIndex:0,labAmount:1,datEncode:"Base64",datFmt:"Img",prnDats:this.printSelectList[s].base.split(",")[1]},0==this.ruleForm.Rfid?this.body.printLab[s].epcSect="":0==this.ruleForm.desc&&(this.body.printLab[s].userSect="");else for(let s=0;s<this.printSelectList.length;s++)this.body.printLab[s]={tag:8,printDpi:parseInt(this.printerDpi),xOffset:parseInt(this.ruleForm.transverse),yOffset:parseInt(this.ruleForm.longitudinal),density:parseInt(this.ruleForm.concentration),datEncode:"Base64",datFmt:"Img",prnDats:this.printSelectList[s].base.split(",")[1]},0==this.ruleForm.Rfid?this.body.printLab[s].epcSect="":0==this.ruleForm.desc&&(this.body.printLab[s].userSect="");if(this.NUMList=this.body.printLab,this.ruleForm.printNum>1)for(var e=1;e<this.ruleForm.printNum;e++)this.body.printLab=this.body.printLab.concat(this.NUMList),this.printAssetNames=this.printAssetNames.concat(this.printAssetNames);(0,a.aJ)("post",{key:this.facilityKey,sendCode:"1"},this.base64Encode(JSON.stringify(this.body))).then((t=>{this.resultList=[],this.exportFlag=!0,this.timer=setInterval((async()=>{await this.lookPrint(0),await this.lookPrint(1)}),2400),this.body.printLab=[]})).catch((t=>{this.body.printLab=[],this.printText=`${this.$t("h.tips55")}，<span class='colseSpan'>${this.$t("h.tips56")}<span>`}))},selectChange(t){this.ListIndex=this.symbol.findIndex((e=>e.value==t))},printSelectClear(){this.closePrint()},closePrint(){(0,a._u)({code:3,key:this.facilityKey}).then((t=>{this.ruleForm.printName="",this.facilityKey="",this.printerName="",this.printerType="",this.$message.success(this.$t("h.tips57"))})).catch((t=>this.$message.error(this.$t("h.tips58"))))},strToHexCharCode(t){if(""===t)return"";for(var e=[],s=0;s<t.length;s++)e.push(t.charCodeAt(s).toString(16));return e.join("")},openPrint(){this.getRfidVersion(),this.ruleFormRules.printName[0].message=this.$t("h.tips4")+this.$t("h.formTips1"),this.ruleFormRules.moban[0].message=this.$t("h.tips4")+this.$t("h.formTips17"),this.ruleFormRules.userData[0].message=this.$t("h.tips3")+this.$t("h.formTips18"),this.ruleForm.moban=parseInt(window.localStorage.getItem("assetTemaplateId")),this.assetTagsTemplate.some((t=>t._id==this.ruleForm.moban))||(this.ruleForm.moban=this.assetTagsTemplate[0]._id||1),this.openApplyAssetTags();const t=window.localStorage.getItem("facilityKey");t&&(0,a._u)({code:3,key:t}),(0,a._u)({code:1}).then((t=>{t.data.symbol.forEach((t=>{t.split(";")[0].toLowerCase()!="MFG:DASCOM".toLowerCase()&&t.split(";")[0].toLowerCase()!="MFG:Tally Dascom".toLowerCase()||-1==t.split(";")[1].indexOf("RFID")||this.symbol.push({name:t.split(";")[2].split(":")[1],value:t,deType:t.split(";")[1].split(":")[1]})})),this.$message.success(this.$t("h.tips59"))})).catch((t=>{if(void 0!=t.response)return 400==t.response.status?this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips63")}):this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips60")+","+this.$t("h.restartThePrinter")});this.$confirm(this.$t("h.tips61"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{const t=document.createElement("a"),e=`https://asset.dascomyun.com/websocket/upload/${this.$t("h.assetTemplate6")}.msi`;t.style.display="none",t.href=e,t.setAttribute(`${this.$t("h.assetTemplate6")}.msi`,name),document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(t.href),document.body.removeChild(t)})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips62")})}))}))},refreshPrinter(){this.refreshLoading=!0,this.facilityKey&&this.closePrint(),this.ruleForm.printName="",this.printerDpi="",this.printerName="",this.symbol=[],(0,a._u)({code:1}).then((t=>{t.data.symbol.forEach((t=>{t.split(";")[0].toLowerCase()!="MFG:DASCOM".toLowerCase()&&t.split(";")[0].toLowerCase()!="MFG:Tally Dascom".toLowerCase()||-1==t.split(";")[1].indexOf("RFID")||this.symbol.push({name:t.split(";")[2].split(":")[1],value:t,deType:t.split(";")[1].split(":")[1]})})),this.refreshLoading=!1,this.$message.success(this.$t("h.tips64"))})).catch((t=>{if(this.refreshLoading=!1,void 0!=t.response)return 400==t.response.status?this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips63")}):this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips60")+","+this.$t("h.restartThePrinter")});this.$confirm(this.$t("h.tips61"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{const t=document.createElement("a"),e=`https://asset.dascomyun.com/websocket/upload/${this.$t("h.assetTemplate6")}.msi`;t.style.display="none",t.href=e,t.setAttribute(`${this.$t("h.assetTemplate6")}.msi`,name),document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(t.href),document.body.removeChild(t)})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips62")})}))}))},lookPrint(t,e){(0,a._u)({code:4,key:this.facilityKey,param:parseInt(t)}).then((async s=>{if(2==t)null==s.data.DeviceDPI||void 0==s.data.DeviceDPI||""==s.data.DeviceDPI?this.printerDpi=203:this.printerDpi=s.data.DeviceDPI,this.loading=!1;else if(0==t){const t=s.data.statInfo.stat;this.printStat=s.data.statInfo.stat;const e=s.data.statInfo.errCode,i=s.data.statInfo.labs,r=s.data.statInfo.totals;this.printText=`${this.$t("h.tips65")}<span>${i}</span>/<span>${r}</span>${this.$t("h.tips66")} ... `,"End"==t&&0==e?(clearInterval(this.timer),this.lookPrint(1,!0),this.printText=`${this.$t("h.tips67")}`):"Ready"==t?(clearInterval(this.timer),this.printText=`${this.$t("h.tips68")}`,this.lookPrint(1,!0)):"End"==t&&0!=e&&0==i&&0==r?(clearInterval(this.timer),this.lookPrint(1,!0),1==e?this.printText=`${this.$t("h.tips70")} + ${this.$t("h.tips69")}`:2==e?this.printText=`${this.$t("h.tips71")} + ${this.$t("h.tips69")}`:3==e&&(this.printText=`${this.$t("h.tips72")} + ${this.$t("h.tips69")}`)):"End"==t&&0!=e&&(clearInterval(this.timer),this.lookPrint(1,!0),this.printText=`${this.$t("h.tips67")}`)}else if(1==t){this.resultList=s.data.labInfo;for(let t=0;t<this.resultList.length;t++)this.resultList[t].name=this.printAssetNames[t].name;if(e){this.exportFlag=!1,this.exportPrintResultData=this.printAssetNames,this.resultList.forEach(((t,e)=>{for(let s=0;s<this.resultList.length;s++)s!=e&&(this.resultList[s].tid==this.resultList[e].tid?t.tips=this.$t("h.tips73"):t.tips=this.$t("h.tips74"))}));for(let t=0;t<this.resultList.length;t++)for(let e in this.resultList[t])this.exportPrintResultData[t][e]=this.resultList[t][e];this.recordPrintHistory(s.data.labInfo)}}})).catch((e=>{2==t&&(this.$message.error(this.$t("h.tips75")),this.loading=!1),clearInterval(this.timer),this.printText=`${this.$t("h.tips76")},<span class='colseSpan'>${this.$t("h.tips56")}<span>`}))},closePrintPlan(t){const e=t.target.className;"colseSpan"==e&&(this.printProgressDialogVisible=!1)},async recordPrintHistory(t){"RFID"!=this.printerType&&t.forEach(((t,e)=>{t.epc=this.printSelectList[e].EPC}));const e=this.$refs["printerSelectRef"].selected.label,s=this.$refs["printTempSelectRef"].selected.label,{data:i}=await(0,a.Vx)({func:"U0028",userId:this.userInfo._id,token:this.userInfo.token,requstData:{label:t,_id:this.userInfo.staffId,printer:e,templateName:s,horizontalPosition:this.ruleForm.transverse,verticalPosition:this.ruleForm.longitudinal,printDensity:this.ruleForm.concentration,userArea:this.ruleForm.userData,accessPassword:this.ruleForm.oldResvSect}}).catch((t=>(clearInterval(this.timer),!1)));if(0!=i.code)return clearInterval(this.timer),this.$notify.error({title:this.$t("h.title27"),message:i.data+this.$t("h.tips77")});clearInterval(this.timer)},SplitDemo(t){let e=t.split(";");return e},base64Encode(t){var e;return e=encodeURIComponent(t),e=unescape(e),e=window.btoa(e),e},reBytesStrArr1(t,e){if(!e||void 0==e)return"";let s=0,i=0;for(let a=0;a<e.length;a++){var r=e.charCodeAt(a);if(48<=r&&r<=58)s+=r-48;else if(97<=r&&r<=102)s+=r-97+10;else{if(!(65<=r&&r<=70))return;s+=r-65+10}a%2!=0?(t[i++]=s,s=0):s*=16}return 0!=e.length&&e.length%2!=0&&(t[i]=s),t},templateSelectChange(t){if(this.multipleSelection=[],this.printSelectList=[],this.printAssetNames=[],this.printerName){let e=this.assetTagsTemplate.find((e=>e._id==t)).deviceRelate,s=e.find((t=>-1!=this.printerName.indexOf(t.printModel)));s&&(this.ruleForm.transverse=s.leftMargin,this.ruleForm.longitudinal=s.topMargin,this.ruleForm.concentration=s.printDarkness)}this.openApplyAssetTags(),this.$confirm(this.$t("h.tips78"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),cancelButtonClass:"changeCancelButton",type:"warning"}).then((()=>{this.checkRFIDTag()})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips79")})}))},async openApplyAssetTags(){let t=document.createElement("CANVAS");await this.recApplyData(this.selectAssetsData,t,0,!1)},async createPrintTags(t){const e=document.createElement("canvas");await this.recApplyData(this.selectAssetsData,e,0,!0,t)},async recApplyData(t,e,s,i,r){if(s>t.length-1||!this.dialogVisible)return this.dialogVisible||(this.exportPrintResultData=[],this.multipleSelection=[],this.printSelectList=[],this.printerDpi="",this.assetTagsSrcList=[],this.printAssetNames=[]),!1;let a=this.assetTagsTemplate.find((t=>t._id==this.ruleForm.moban)),n={};if(a.html){let e=document.createElement("div");e.style.position="fixed",e.style.top="-1000px",document.body.appendChild(e),n=await(0,o.X)(a,e,t[s],r),document.body.removeChild(e)}else n=await(0,l.h)(a,e,t[s],i,r);0==i?(this.multipleSelection.push(n),this.assetTagsSrcList.push(n.base)):(this.printSelectList.push(n),this.printAssetNames.push(n)),s++,this.recApplyData(t,e,s,i,r)},mobanSizeChange(t){switch(t){case"100%":this.colSize=24;break;case"75%":this.colSize=12;break;case"50%":this.colSize=8;break;case"25%":this.colSize=6;break}},handleSizeChange(t){this.pageSize=t},handleCurrentChange(t){this.cruuentSize=t},checkRFIDTag(){if(!this.facilityKey)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips80")});let t=0;"RFID"==this.printerType&&(t=1),this.loading=!0,(0,a._u)({code:5,key:this.facilityKey,param:5,type:t}).then((t=>{this.loading=!1,this.$message.success(this.$t("h.tips81"))})).catch((t=>{this.loading=!1,this.$message.error(this.$t("h.tips82"))}))},exportPrintResult(){this.$refs["exportFormRef"].validate((t=>{if(!t)return!1;const e=this.exportPrintResultData.map(((t,e)=>({index:e+1,assetCode:t.assetCode,name:t.name,EPC:t.EPC,tid:t.tid,ackCode:t.ackCode}))),s="序号,资产编码,资产名称,资产EPC,标签TID,校验码\n";(0,n.zb)(s,e,this.exportForm.fileName),this.exportResultDialogVisible=!1}))},restartPrinter(){this.$refs["ruleFormRef"].validate((t=>{if(!t)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips80")});this.$confirm(this.$t("h.tips83"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{(0,a._u)({code:5,param:1,key:this.facilityKey}).then((t=>{this.$message.success(this.$t("h.tips84")),this.dialogVisible=!1})).catch((t=>{this.$message.error(this.$t("h.tips85"))}))})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips86")})}))}))},tableRowClassName({row:t,rowIndex:e}){if("是"==t.tips)return"repetition-row"},catchLastPrintResult(){this.printProgressDialogVisible=!0},async saveMarginParam(){let t=this.assetTagsTemplate.find((t=>t._id==this.ruleForm.moban)).deviceRelate;t.forEach((t=>{-1!=this.printerName.indexOf(t.printModel)&&(t.leftMargin=this.ruleForm.transverse,t.topMargin=this.ruleForm.longitudinal,t.printDarkness=this.ruleForm.concentration)}));const{data:e}=await(0,a.Vx)({func:"U0018",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.ruleForm.moban,deviceRelate:t,permissonId:23}});if(0!=e.code)return this.$message.error(e.data);this.$message.success(e.data)},getRfidVersion(){(0,a._u)({code:4,param:4}).then((t=>{console.log("=====>",t),this.rfidVersio.rfid_version=t.data.rfid_version,this.rfidVersio.service_version=t.data.service_version})).catch((t=>{this.rfidVersio="未知版本"}))}},created(){this.getAssetTagsTemplate()},mounted(){},beforeDestroy(){clearInterval(this.timer)}},b=g,$=(0,u.Z)(b,i,r,!1,null,"571aa2ba",null),v=$.exports},88048:function(t,e,s){s.d(e,{Z:function(){return p}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"upload"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.fileValue,expression:"!fileValue"}],staticClass:"upload-btn"},[e("input",{ref:"uploadInputRef",attrs:{type:"file",id:"upload-btn-input",accept:"image/*"},on:{change:t.handlePhotoChange}}),e("i",{staticClass:"el-icon-plus"})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.fileValue,expression:"fileValue"}],staticClass:"upload-img"},[e("button",{staticClass:"close-btn",on:{click:t.deletePhotpFile}},[e("i",{staticClass:"el-icon-close"})]),e("img",{attrs:{src:t.fileValue,alt:""}})])])},r=[],a=s(20629),l=s(79992),o={data(){return{}},computed:{...(0,a.rn)(["maxLimit"]),fileValue:{get(){return this.value},set(t){this.$emit("update:value",t)}}},props:{value:{type:String,default:""}},methods:{handlePhotoChange(t){let e=t.target.files[0];return 0!=e.type.indexOf("image")?this.$message.error(this.$t("h.tips21")):this.maxLimit.pictureSize&&e.size>1024*this.maxLimit.pictureSize?this.$message.error(`${this.$t("h.tips19")}${this.maxLimit.pictureSize}kb`):void(0,l.sT)(e).then((t=>{this.fileValue=t})).catch((()=>{this.deletePhotpFile(),this.$message.error(this.$t("h.tips20"))}))},deletePhotpFile(t){t.preventDefault(),this.fileValue="",this.$refs.uploadInputRef.value=""}}},n=o,h=s(1001),c=(0,h.Z)(n,i,r,!1,null,"7d478ed2",null),p=c.exports},85117:function(t,e,s){var i=s(66330),r=TypeError;t.exports=function(t,e){if(!delete t[e])throw r("Cannot delete property "+i(e)+" of "+i(t))}},30541:function(t,e,s){var i=s(82109),r=s(47908),a=s(26244),l=s(83658),o=s(85117),n=s(7207),h=1!==[].unshift(0),c=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:h||c},{unshift:function(t){var e=r(this),s=a(e),i=arguments.length;if(i){n(s+i);var h=s;while(h--){var c=h+i;h in e?e[c]=e[h]:o(e,c)}for(var p=0;p<i;p++)e[p]=arguments[p]}return l(e,s+i)}})},39622:function(t,e){function s(t){const e=typeof t;return null!==t&&("object"===e||"function"===e)}function i(t,e=new WeakMap){if("symbol"===typeof t)return Symbol(t.description);if(!s(t))return t;if(t instanceof Set){const e=new Set;for(const s of t)e.add(i(s));return e}if(t instanceof Map){const e=new Map;for(const s of t)e.set(s[0],s[1]);return e}if("function"===typeof t)return t;if(e.get(t))return e.get(t);const r=Array.isArray(t)?[]:{};e.set(t,r);for(const s in t)r[s]=i(t[s],e);const a=Object.getOwnPropertySymbols(t);for(const s of a)r[Symbol(s.description)]=i(t[s],e);return r}e["Z"]=i},33642:function(t,e,s){t.exports=s.p+"img/printLoading.cb21d28f.gif"}}]);