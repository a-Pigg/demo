"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[9892],{53595:function(e,t,a){a.d(t,{Z:function(){return F}});var l=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{top:"0","custom-class":"assets-dialog","show-close":!1,visible:e.dialogVibible},on:{"update:visible":function(t){e.dialogVibible=t},opened:e.dialogVibibleOpened,close:e.dialogVibibleClose}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.$t("h.title16")))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.dialogVibible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"asset-filter"},[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}}),t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.findAssetSearch}}),t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.filterDrawerVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"asset-table"},[t("ds-table",{ref:"assetTableRef",attrs:{loading:e.loading,tableData:e.matchBillsAssets,columns:e.columns,tableConfig:e.tableConfig,rowKey:e=>e._id},on:{handleSelectionChange:e.handleSelectionChange}})],1),t("div",{staticClass:"asset-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getMatchBillsAssets}})],1),t("div",{staticClass:"btns"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVibible=!1}}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveSelectAssets}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)])]),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.filterDrawerVisible},on:{"update:filterDrawerVisible":function(t){e.filterDrawerVisible=t},"update:filter-drawer-visible":function(t){e.filterDrawerVisible=t},submitFilterForm:e.submitFilterForm,resetFilterForm:e.resetFilterForm}},[t("el-form",{ref:"filterFormRef",attrs:{"label-width":"105px","label-position":"left"}},e._l(e.highFilterArr,(function(a){return t("el-form-item",{key:a.id,attrs:{label:a.label,prop:a.attr}},["assetCode"==a.attr||"name"==a.attr||"model"==a.attr||"snNumber"==a.attr||"unit"==a.attr||"money"==a.attr||"printSize"==a.attr?t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:e.$t("h.tips4")+e.$t("h.criteria"),clearable:"",filterable:""},model:{value:e.filterForm[a.index].handle,callback:function(t){e.$set(e.filterForm[a.index],"handle",t)},expression:"filterForm[item.index].handle"}},e._l(e.filterCondtionData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),"assetCode"==a.attr||"name"==a.attr||"model"==a.attr||"snNumber"==a.attr||"unit"==a.attr||"money"==a.attr||"printSize"==a.attr?t("el-input",{staticStyle:{"margin-left":"5px",width:"214px"},attrs:{placeholder:e.$t("h.tips3")+a.label},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}}):e._e(),"state"==a.attr?t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:"","collapse-tags":""},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}},e._l(e.stateListData,(function(e){return t("el-option",{key:e._id,attrs:{label:e.label,value:e._id}})})),1):e._e(),"source"==a.attr?t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:"","collapse-tags":""},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}},e._l(e.sourceListData,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),"deptId"==a.attr?t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.department"),treeData:e.deptTreeData,defaultProps:{children:"children",label:"deptName",value:"_id"},checkStrictly:!0,multiple:!0,collapseTags:""},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}}):e._e(),"classifyId"==a.attr?t("ds-select-tree",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.classification"),treeData:e.assetTypeData,defaultProps:{children:"children",label:"classifyName",value:"_id"},collapseTags:!0,checkStrictly:!0,multiple:!0},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}}):e._e(),"inData"==a.attr||"useDate"==a.attr?t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate")},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}}):e._e(),"goodsId"==a.attr?t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:""},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}},e._l(e.assetAttrData,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.goodsqId}})})),1):e._e(),"warehouseId"==a.attr?t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.assetAreaData,modelField:"_id",searchField:"andLike",func:"S0003",userInfo:e.userInfo},expression:"{\n            options: assetAreaData,\n            modelField: '_id',\n            searchField: 'andLike',\n            func: 'S0003',\n            userInfo: userInfo,\n          }"}],ref:"filterWareSelectRef",refInFor:!0,attrs:{multiple:"",placeholder:e.$t("h.tips4"),clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}},e._l(e.assetAreaData,(function(a){return t("el-option",{key:a._id,attrs:{label:a.warehouseName,value:a._id}},[t("span",[e._v(e._s(a.code)+" - "+e._s(a.warehouseName))])])})),1):e._e(),"responsibleId"==a.attr||"staffId"==a.attr?t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],ref:"filter"+a.attr+"SelectRef",refInFor:!0,attrs:{placeholder:e.$t("h.tips4"),clearable:"",multiple:"",filterable:"","filter-method":()=>{}},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}},e._l(e.staffData,(function(a){return t("el-option",{key:a._id,attrs:{label:a.name,value:a._id}},[t("span",[e._v(e._s(a.name+"("+a.code+")")+" -"+e._s(a.deptName))])])})),1):e._e(),"responsibleId"!=a.attr&&"staffId"!=a.attr&&"deptId"!=a.attr&&"classifyId"!=a.attr&&"warehouseId"!=a.attr&&"inData"!=a.attr&&"source"!=a.attr&&"state"!=a.attr&&"useDate"!=a.attr&&"goodsId"!=a.attr&&"assetCode"!=a.attr&&"name"!=a.attr&&"model"!=a.attr&&"snNumber"!=a.attr&&"unit"!=a.attr&&"money"!=a.attr&&"printSize"!=a.attr?t("el-input",{attrs:{placeholder:e.$t("h.tips3")+a.label},model:{value:e.filterForm[a.index].value,callback:function(t){e.$set(e.filterForm[a.index],"value",t)},expression:"filterForm[item.index].value"}}):e._e()],1)})),1)],1)],1)},s=[],i=(a(57658),a(30541),a(76080)),r=a(20629),o=a(79992),n=a(83151),d=a(55886),h=a(60983),u=a(66403),f=a(93082),m=a(52086),p=a(17817),c=a(5791),b=a(39622),g={components:{DsTable:h.Z,DsSearchBtn:u.Z,DsFilterTag:p.Z,DsPagination:f.Z,DsSelectTree:m.Z,DsFilterDrawer:c.Z},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},andLike:"",loading:!1,tableConfig:{selection:!0,reserveSelection:!0},matchBillsAssets:[],selectMatchBillsAssets:[],highFilterTags:[],filterDrawerVisible:!1,filterForm:[],sourceListData:n.vr,assetTypeData:[],typeData:[],assetAttrData:[],assetAreaData:[],staffData:[],filterCondtionData:n.IM,listFilterSetData:[]}},props:{matchAssetsDialogVisible:{type:Boolean,default:!1},state:{type:String,default:""},updateSelectBillAssets:{type:Array,default:()=>[]},deptData:{type:Array,default:()=>[]},deptTreeData:{type:Array,default:()=>[]}},computed:{...(0,r.rn)(["userInfo","assetTableHeader","assetFormHeader","stateListData"]),columns(){let e=[];return this.assetTableHeader.forEach((t=>{t.show&&("photo"==t.attr?e.push({type:"image",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label)}):"goalQuota"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label),showOverflowTooltip:!0,formatter:e=>100*e[t.attr]+"%"}):"file"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label),slotName:"file"}):"assetCode"==t.attr?e.push({type:"detail",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label),showOverflowTooltip:!0}):"state"==t.attr?e.push({type:"assetState",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label),formatter:e=>this.stateListData.find((a=>a._id==e[t.attr])).label}):e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,o.Uh)(t.label),showOverflowTooltip:!0}))})),e.push({prop:"printSize",label:this.$t("h.title57"),fixed:"right",showOverflowTooltip:!0,width:(0,o.Uh)(this.$t("h.title57"))}),e},filterFormHead(){let e=[];return this.assetFormHeader.forEach((t=>{let a={};"operator"==t.dbDataName?(a.prop="staffId",a.label=t.nameShow,a.index=0,e.push(a)):"type"==t.dbDataName?(a.prop="classifyId",a.label=t.nameShow,a.index=1,e.push(a)):"assertPosition"==t.dbDataName?(a.prop="warehouseId",a.label=t.nameShow,a.index=2,e.push(a)):"inData"==t.dbDataName?(a.prop="inData",a.label=t.nameShow,a.index=3,e.push(a)):"source"==t.dbDataName?(a.prop="source",a.label=t.nameShow,a.index=4,e.push(a)):"goodsName"==t.dbDataName?(a.prop="goodsId",a.label=t.nameShow,a.index=5,e.push(a)):"assetCode"==t.dbDataName?(a.prop="assetCode",a.label=t.nameShow,a.index=6,e.push(a)):"name"==t.dbDataName?(a.prop="name",a.label=t.nameShow,a.index=7,e.push(a)):"model"==t.dbDataName?(a.prop="model",a.label=t.nameShow,a.index=8,e.push(a)):"suNumber"==t.dbDataName?(a.prop="snNumber",a.label=t.nameShow,a.index=9,e.push(a)):"unit"==t.dbDataName?(a.prop="unit",a.label=t.nameShow,a.index=10,e.push(a)):"money"==t.dbDataName&&(a.prop="money",a.label=t.nameShow,a.index=11,e.push(a))})),e},highFilterArr(){let e=this.listFilterSetData.filter((e=>e.hightFilter));return this.filterForm=[],e.forEach(((e,t)=>{e.index=t,"state"==e.attr||"classifyId"==e.attr||"source"==e.attr||"warehouseId"==e.attr||"goodsId"==e.attr||"responsibleId"==e.attr||"staffId"==e.attr||"deptId"==e.attr?this.filterForm.push({key:e.attr,handle:"OIS",value:null}):"assetCode"==e.attr||"name"==e.attr||"model"==e.attr||"snNumber"==e.attr||"unit"==e.attr||"money"==e.attr||"printSize"==e.attr?this.filterForm.push({key:e.attr,handle:"IS",value:null}):32==e.attr.length?this.filterForm.push({key:e.attr,handle:"ANDLIKE",value:null}):this.filterForm.push({key:e.attr,handle:"IS",value:null})})),e},dialogVibible:{get(){return this.matchAssetsDialogVisible},set(e){this.$emit("update:matchAssetsDialogVisible",e)}}},methods:{dialogVibibleOpened(){this.$refs.assetTableRef.$refs.dsTableRef.clearSelection(),this.updateSelectBillAssets.forEach((e=>{this.$refs.assetTableRef.$refs.dsTableRef.toggleRowSelection(e,!0)})),this.getMatchBillsAssets(),this.getAssetTypes(),this.getAssetAttr(),this.updateHighFilter()},dialogVibibleClose(){this.filterForm.forEach((e=>{e.value=null,"state"==e.key||"classifyId"==e.key||"source"==e.key||"warehouseId"==e.key||"goodsId"==e.key||"responsibleId"==e.key||"staffId"==e.key||"deptId"==e.key?e.handle="OIS":"assetCode"==e.key||"name"==e.key||"model"==e.key||"snNumber"==e.key||"unit"==e.key||"money"==e.key||"printSize"==e.key?e.handle="IS":32==e.key.length?e.handle="ANDLIKE":e.handle="IS"})),this.andLike="",this.highFilterTags=[],this.paginationForm.currentPage=1,this.matchBillsAssets=[],this.selectMatchBillsAssets=[]},handleSelectionChange(e){this.selectMatchBillsAssets=e},saveSelectAssets(){this.$emit("save",this.selectMatchBillsAssets)},getMatchBillsAssets(){this.loading=!0;let e=(0,b.Z)(this.filterForm),t=e.filter((e=>{let t=typeof e.value;return"string"==t&&e.value||null!=e.value&&"object"==t&&e.value.length?e:void 0})),a=[],l=[];t.forEach((e=>{32==e.key.length&&(e.key="jsons."+e.key),"object"==typeof e.value&&"inData"!=e.key&&"maintainLast"!=e.key&&"useDate"!=e.key&&(e.value=e.value.join(",")),"inData"!=e.key&&"maintainLast"!=e.key&&"useDate"!=e.key||(l.push({handle:"ANDGTE",key:e.key,value:e.value[0]}),l.push({handle:"ANDLTE",key:e.key,value:e.value[1]}),a.unshift(index))})),a.length&&(a.forEach((e=>{t.splice(e,1)})),t=[...t,...l]),t.push({key:"state",handle:"OIS",value:this.state},{key:"stauss",handle:"OIS",value:0}),(0,i.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,andLike:this.andLike,item:t}}).then((({data:e})=>{if(this.loading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.matchBillsAssets=this.setTableCostomKey(e.data[1])})).catch((()=>{this.loading=!1,this.$message.error(this.$t("h.tips18"))}))},setTableCostomKey(e){return e.forEach((e=>{for(let t in e["jsons"])e[t]=e["jsons"][t];e.company=window.sessionStorage.getItem("loginCompanyName")})),e},getAssetTypes(){this.typeLoading=!0,(0,i.Ys)({func:"S0006",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.typeData=e.data,this.assetTypeData=(0,d.M)(e.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getAssetAttr(){(0,i.Ys)({func:"S0022",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.assetAttrData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},findAssetSearch(){this.paginationForm.currentPage=1,this.getMatchBillsAssets()},mapHighFilterTags(){this.highFilterTags=[];let e=(0,b.Z)(this.filterForm),t=e.filter((e=>{let t=typeof e.value;return"string"==t&&e.value||null!=e.value&&"object"==t&&e.value.length?e:void 0}));t.forEach((e=>{if("warehouseId"==e.key){let t={},a=[];this.$refs.filterWareSelectRef[0].selected.forEach((e=>{a.push(e.label)})),t.name=this.assetFormHeader.find((e=>"assertPosition"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("responsibleId"==e.key){let t={},a=[];this.$refs.filterresponsibleIdSelectRef[0].selected.forEach((e=>{a.push(e.label)})),t.name=this.assetFormHeader.find((e=>"responsible"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("staffId"==e.key){let t={},a=[];this.$refs.filterstaffIdSelectRef[0].selected.forEach((e=>{a.push(e.label)})),t.name=this.assetFormHeader.find((e=>"operator"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("deptId"==e.key){let t={},a=[];e.value.forEach((e=>{let t=this.deptData.find((t=>t._id==e)).deptName;a.push(t)})),t.name=this.assetFormHeader.find((e=>"useDept"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("source"==e.key){let t={};t.name=this.assetFormHeader.find((e=>"source"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=e.value.join(","),this.highFilterTags.push(t)}else if("goodsId"==e.key){let t={},a=[];e.value.forEach((e=>{let t=this.assetAttrData.find((t=>t.goodsqId==e)).name;a.push(t)})),t.name=this.assetFormHeader.find((e=>"goodsName"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("classifyId"==e.key){let t={},a=[];e.value.forEach((e=>{let t=this.typeData.find((t=>t._id==e)).classifyName;a.push(t)})),t.name=this.assetFormHeader.find((e=>"type"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("inData"==e.key){let t={};t.name=this.assetFormHeader.find((e=>"inData"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=e.value.join(this.$t("h.to")),this.highFilterTags.push(t)}else if("useDate"==e.key){let t={};t.name=this.assetFormHeader.find((e=>"useDate"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=e.value.join(this.$t("h.to")),this.highFilterTags.push(t)}else if("state"==e.key){let t={},a=[];e.value.forEach((e=>{let t=this.stateListData.find((t=>t._id==e)).label;a.push(t)})),t.name=this.assetFormHeader.find((e=>"state"==e.dbDataName)).nameShow,t.keyStr=e.key,t.value=a.join(","),this.highFilterTags.push(t)}else if("printSize"==e.key){let t={};t.name=this.$t("h.title57"),t.keyStr=e.key;let a=this.filterCondtionData.find((t=>t.value==e.handle)).label;t.value=a+e.value,this.highFilterTags.push(t)}else{let t={};t.name=this.assetFormHeader.find((t=>t.dbDataName==e.key)).nameShow,t.keyStr=e.key;let a=this.filterCondtionData.find((t=>t.value==e.handle)).label;t.value=a+e.value,this.highFilterTags.push(t)}}))},handleCloseFilterTag(e){this.highFilterTags.splice(this.highFilterTags.indexOf(e),1),this.filterForm.forEach((t=>{t.key==e.keyStr&&(t.value=null)})),this.paginationForm.currentPage=1,this.getMatchBillsAssets()},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getMatchBillsAssets()},resetFilterForm(){this.filterForm.forEach((e=>{e.value=null,"state"==e.key||"classifyId"==e.key||"source"==e.key||"warehouseId"==e.key||"goodsId"==e.key||"responsibleId"==e.key||"staffId"==e.key||"deptId"==e.key?e.handle="OIS":"assetCode"==e.key||"name"==e.key||"model"==e.key||"snNumber"==e.key||"unit"==e.key||"money"==e.key||"printSize"==e.key?e.handle="IS":32==e.key.length?e.handle="ANDLIKE":e.handle="IS"})),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getMatchBillsAssets()},updateHighFilter(){let e=sessionStorage.getItem("loginCompanyName")+this.userInfo._id;this.listFilterSetData=JSON.parse(localStorage.getItem(e));let t=this.listFilterSetData.findIndex((e=>"state"==e.attr));this.listFilterSetData[t].hightFilter=!1}}},y=g,v=a(1001),k=(0,v.Z)(y,l,s,!1,null,"5b04785e",null),F=k.exports}}]);