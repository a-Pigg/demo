"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[9714],{5791:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"filter-drawer"},[t("el-drawer",{attrs:{title:e.$t("h.advancedBtn"),size:550,direction:"rtl",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"filter-form"},[e._t("default")],2),t("div",{staticClass:"filter-btn"},[e._t("set"),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitFilterForm}},[e._v(e._s(e.$t("h.saveBtn")))]),t("el-button",{attrs:{size:"small"},on:{click:e.resetFilterForm}},[e._v(e._s(e.$t("h.resetBtn")))])],2)])],1)},a=[],s={name:"DsFilterDrawer",data(){return{}},props:{filterDrawerVisible:{type:Boolean}},computed:{drawer:{get(){return this.filterDrawerVisible},set(e){this.$emit("update:filterDrawerVisible",e)}}},methods:{submitFilterForm(){this.$emit("submitFilterForm")},resetFilterForm(){this.$emit("resetFilterForm")}}},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"05535b94",null),c=o.exports},17817:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-filter-tag"},e._l(e.tagsData,(function(i){return t("el-tag",{key:i.keyStr,attrs:{size:e.tagSize,effect:"dark",closable:""},on:{close:function(t){return e.handleClose(i)}}},[e._v(" "+e._s(i.name)+":"+e._s(i.value.length>8?i.value.substring(0,7)+"...":i.value)+" ")])})),1)},a=[],s={name:"DsFilterTag",data(){return{tags:[{name:this.$t("h.label1"),type:""},{name:this.$t("h.label2"),type:"success"},{name:this.$t("h.label3"),type:"info"},{name:this.$t("h.label4"),type:"warning"},{name:this.$t("h.label5"),type:"danger"}]}},props:{filterTagsData:{type:Array,default:()=>[]},tagSize:{type:String,default:"medium"}},computed:{tagsData:{get(){return this.filterTagsData},set(e){this.$emit("update:filterTagsData",e)}}},methods:{handleClose(e){this.$emit("handleCloseTag",e)}}},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"628dc1ca",null),c=o.exports},93082:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-pagination"},[t("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},a=[],s={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e})},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize})}}},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"2377c114",null),c=o.exports},92003:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"left-panel"},[e._t("default")],2)},a=[],s={name:"DsQueryFormLeftPanel"},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"71d76034",null),c=o.exports},89782:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"right-panel"},[e._t("default")],2)},a=[],s={name:"DsQueryFormRightPanel"},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"c6443ba6",null),c=o.exports},19698:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-query-form"},[e._t("default")],2)},a=[],s={name:"DsQueryForm"},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"6c8bfb78",null),c=o.exports},66403:function(e,t,i){i.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-search"},[t("el-input",{attrs:{size:"small",placeholder:e.$t("h.keyword"),"prefix-icon":"el-icon-search"},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value="string"===typeof t?t.trim():t},expression:"value"}},[t("el-button",{attrs:{slot:"suffix",type:"text",size:"small"},on:{click:e.search},slot:"suffix"},[e._v(e._s(e.$t("h.Search")))])],1)],1)},a=[],s={name:"DsSearchBtn",data(){return{}},props:{searchValue:{type:String}},computed:{value:{get(){return this.searchValue},set(e){this.$emit("update:searchValue",e)}}},methods:{search(){this.$emit("search")},onInput(e){""==e&&this.search()}}},l=s,n=i(1001),o=(0,n.Z)(l,r,a,!1,null,"5bd7b965",null),c=o.exports},6171:function(e,t,i){i.r(t),i.d(t,{default:function(){return D}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"record"},[t("el-card",{staticClass:"record-card"},[t("div",{staticClass:"record-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-select",{attrs:{size:"small",placeholder:e.$t("h.tips4")+e.$t("h.title128"),filterable:"",clearable:""},on:{change:e.onChangeDevice,clear:e.onClearDevice},model:{value:e.selectDevice,callback:function(t){e.selectDevice=t},expression:"selectDevice"}},e._l(e.devices,(function(i){return t("el-option",{key:i.equipmentId,attrs:{label:i.name,value:i.equipmentId}},[t("span",[e._v(e._s(i.cloudNumber)+" - "+e._s(i.name))])])})),1),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.selectDevice,expression:"selectDevice"}],staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.disconnectDevice}},[e._v(e._s(e.$t("h.title142")))])],1),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.findAssetSearch}})],1)],1)],1),t("div",{staticClass:"record-card-content"},[t("div",{staticClass:"record-filter"},[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}}),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.filterDrawerVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"record-table"},[t("ds-table",{ref:"recordTableRef",attrs:{loading:e.historyLoading,columns:e.historyColumns,tableConfig:e.historydConfig,tableData:e.historyData}})],1),t("div",{staticClass:"record-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getMonitoringRecord}})],1)])]),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.filterDrawerVisible},on:{"update:filterDrawerVisible":function(t){e.filterDrawerVisible=t},"update:filter-drawer-visible":function(t){e.filterDrawerVisible=t},submitFilterForm:e.submitFilterForm,resetFilterForm:e.resetFilterForm}},[t("el-form",{ref:"filterFormRef",attrs:{"label-width":"90px"}},[t("el-form-item",{attrs:{label:e.$t("h.state"),prop:"status"}},[t("el-select",{attrs:{clearable:"",placeholder:e.$t("h.tips4")+e.$t("h.state")},model:{value:e.filterForm[0].value,callback:function(t){e.$set(e.filterForm[0],"value",t)},expression:"filterForm[0].value"}},e._l(e.statusOption,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.date"),prop:"date"}},[t("el-date-picker",{attrs:{type:"datetimerange","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate"),"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.filterForm[1].value,callback:function(t){e.$set(e.filterForm[1],"value",t)},expression:"filterForm[1].value"}})],1),t("el-form-item",{attrs:{label:e.$t("h.formTips38"),prop:"name"}},[t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.formTips38")},model:{value:e.filterForm[2].value,callback:function(t){e.$set(e.filterForm[2],"value",t)},expression:"filterForm[2].value"}})],1),this.selectDeviceInfo.CloudSN?e._e():t("el-form-item",{attrs:{label:e.$t("h.formTips31"),prop:"number"}},[t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.formTips31")},model:{value:e.filterForm[3].value,callback:function(t){e.$set(e.filterForm[3],"value",t)},expression:"filterForm[3].value"}})],1),t("el-form-item",{attrs:{label:e.$t("h.area"),prop:"warehouseName"}},[t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.area")},model:{value:e.filterForm[4].value,callback:function(t){e.$set(e.filterForm[4],"value",t)},expression:"filterForm[4].value"}})],1)],1)],1)],1)},a=[],s=(i(57658),i(30541),i(93082)),l=i(17817),n=i(5791),o=i(60983),c=i(66403),h=i(19698),u=i(92003),d=i(89782),f=i(79992),p=i(76080),m=i(20629),g=i(39622),v={components:{DsPagination:s.Z,DsTable:o.Z,DsSearchBtn:c.Z,DsQueryForm:h.Z,DsFilterTag:l.Z,DsFilterDrawer:n.Z,DsQueryFormLeftPanel:u.Z,DsQueryFormRightPanel:d.Z},data(){return{andLike:"",selectDevice:"",selectDeviceInfo:{CloudSN:"",ip:"",port:""},devices:[],timer:null,total:0,paginationForm:{currentPage:1,pageSize:20},historyLoading:!1,historyColumns:[{type:"assetState",prop:"status",label:this.$t("h.state"),fixed:!1,width:(0,f.Uh)(this.$t("h.state")),formatter:e=>e["status"]?this.$t("h.legitimate"):this.$t("h.illegal")},{prop:"date",label:this.$t("h.date"),fixed:!1,showOverflowTooltip:!0,width:180},{prop:"name",label:this.$t("h.formTips38"),fixed:!1,showOverflowTooltip:!0,minWidth:(0,f.Uh)(this.$t("h.formTips38"))},{prop:"number",label:this.$t("h.formTips31"),fixed:!1,showOverflowTooltip:!0,width:(0,f.Uh)(this.$t("h.formTips31"))},{prop:"warehouseName",label:this.$t("h.area"),fixed:!1,showOverflowTooltip:!0,minWidth:(0,f.Uh)(this.$t("h.area"))}],historydConfig:{},historyData:[],filterDrawerVisible:!1,filterForm:[{key:"status",handle:"OIS",value:null},{key:"date",handle:"ANDGTE",value:null},{key:"name",handle:"ANDLIKE",value:null},{key:"number",handle:"ANDLIKE",value:null},{key:"warehouseName",handle:"ANDLIKE",value:null}],statusOption:[{value:!0,label:this.$t("h.legitimate")},{value:!1,label:this.$t("h.illegal")}],highFilterTags:[]}},computed:{...(0,m.rn)(["userInfo"])},methods:{findAssetSearch(){},getMonitoringRecord(){this.historyLoading=!0;let e=(0,g.Z)(this.filterForm),t=e.filter((e=>{let t=typeof e.value;return"string"==t&&e.value||null!=e.value&&"object"==t&&e.value.length||"boolean"==t?e:void 0})),i=[],r=[];t.forEach(((e,t)=>{"date"==e.key&&(r.push({handle:"ANDGTE",key:e.key,value:e.value[0]}),r.push({handle:"ANDLTE",key:e.key,value:e.value[1]}),i.unshift(t))})),i.length&&(i.forEach((e=>{t.splice(e,1)})),t=[...t,...r]),this.selectDeviceInfo.CloudSN&&t.push({handle:"IS",key:"number",value:this.selectDeviceInfo.CloudSN}),(0,p.Ys)({func:"S0077",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,item:t}}).then((({data:e})=>{if(this.historyLoading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[1],this.historyData=e.data[0]})).catch((()=>{this.historyLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getDevices(){(0,p.Ys)({func:"S0073",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:20,index:1}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.devices=e.data.filter((e=>0==e.type))})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},onChangeDevice(e){if(!e)return;let t=this.devices.find((t=>t.equipmentId==e));this.selectDeviceInfo.ip=t.ip,this.selectDeviceInfo.port=t.port,this.selectDeviceInfo.CloudSN=t.cloudNumber,this.connectingDevice(!1,"")},onClearDevice(){this.connectingDevice(!0,window.$BAER_URL.checkCode)},connectingDevice(e,t){(0,p.eh)({rfidIp:this.selectDeviceInfo.ip,rfidPort:this.selectDeviceInfo.port,rfidDevId:this.selectDeviceInfo.CloudSN,autoSubmit:e,submitUrl:t}).then((({data:t})=>{if(0!=t.code)return this.selectDevice="",this.selectDeviceInfo.ip="",this.selectDeviceInfo.port="",this.selectDeviceInfo.CloudSN="",this.$message.error(t.message);this.$message.success(t.message),e||(this.timer=setInterval((()=>{this.getDoorEpc()}),1e3))})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},disconnectDevice(){(0,p.zF)({rfidIp:this.selectDeviceInfo.ip}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.message);this.selectDeviceInfo.ip="",this.selectDeviceInfo.port="",this.selectDeviceInfo.CloudSN="",clearInterval(this.timer),this.$message.success(e.message)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getDoorEpc(){(0,p.Hx)({rfidIp:this.selectDeviceInfo.ip}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.message);this.checkEpc(e.message)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},checkEpc(e){e.length&&(0,p.Pw)({code:e.join(","),number:this.selectDeviceInfo.CloudSN,state:!0}).then((({data:e})=>{0==e.code&&(0!=e.warning&&this.illegalEpc(),this.getMonitoringRecord())})).catch((()=>{}))},illegalEpc(){(0,p.qZ)({rfidIp:this.selectDeviceInfo.ip}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.message)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.getMonitoringRecord()},resetFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.getMonitoringRecord()},mapHighFilterTags(){this.highFilterTags=[];let e=(0,g.Z)(this.filterForm),t=e.filter((e=>{let t=typeof e.value;return console.log(t),"string"==t&&e.value||null!=e.value&&"object"==t&&e.value.length||"boolean"==t?e:void 0}));console.log(t),t.forEach((e=>{if("status"==e.key){let t={};t.name=this.$t("h.state"),t.keyStr=e.key,t.value=1==e.value?this.$t("h.legitimate"):this.$t("h.illegal"),this.highFilterTags.push(t)}else if("date"==e.key){let t={};t.name=this.$t("h.date"),t.keyStr=e.key,t.value=e.value.join(this.$t("h.to")),this.highFilterTags.push(t)}else if("name"==e.key){let t={};t.name=this.$t("h.formTips38"),t.keyStr=e.key,t.value=e.value,this.highFilterTags.push(t)}else if("number"==e.key){let t={};t.name=this.$t("h.formTips31"),t.keyStr=e.key,t.value=e.value,this.highFilterTags.push(t)}else if("warehouseName"==e.key){let t={};t.name=this.$t("h.area"),t.keyStr=e.key,t.value=e.value,this.highFilterTags.push(t)}}))},handleCloseFilterTag(e){this.highFilterTags.splice(this.highFilterTags.indexOf(e),1),this.filterForm.forEach((t=>{t.key==e.keyStr&&(t.value=null)})),this.getMonitoringRecord()},showAlert(){let e={rfidIp:this.selectDeviceInfo.ip,rfidPort:this.selectDeviceInfo.port,rfidDevId:this.selectDeviceInfo.CloudSN,autoSubmit:!0,submitUrl:window.$BAER_URL.checkCode};navigator.sendBeacon(window.$PRINT_URL2.connect,JSON.stringify(e))}},created(){this.getDevices(),this.getMonitoringRecord()},mounted(){window.addEventListener("beforeunload",this.showAlert)},beforeDestroy(){clearInterval(this.timer),window.removeEventListener("beforeunload",this.showAlert)},beforeRouteLeave(e,t,i){if(!this.selectDeviceInfo.CloudSN)return i();this.$confirm(this.$t("h.tips239"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{this.connectingDevice(!0,window.$BAER_URL.checkCode),i()})).catch((()=>{i()}))}},b=v,y=i(1001),$=(0,y.Z)(b,r,a,!1,null,"03bad220",null),D=$.exports},85117:function(e,t,i){var r=i(66330),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw a("Cannot delete property "+r(t)+" of "+r(e))}},30541:function(e,t,i){var r=i(82109),a=i(47908),s=i(26244),l=i(83658),n=i(85117),o=i(7207),c=1!==[].unshift(0),h=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();r({target:"Array",proto:!0,arity:1,forced:c||h},{unshift:function(e){var t=a(this),i=s(t),r=arguments.length;if(r){o(i+r);var c=i;while(c--){var h=c+r;c in t?t[h]=t[c]:n(t,h)}for(var u=0;u<r;u++)t[u]=arguments[u]}return l(t,i+r)}})},39622:function(e,t){function i(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function r(e,t=new WeakMap){if("symbol"===typeof e)return Symbol(e.description);if(!i(e))return e;if(e instanceof Set){const t=new Set;for(const i of e)t.add(r(i));return t}if(e instanceof Map){const t=new Map;for(const i of e)t.set(i[0],i[1]);return t}if("function"===typeof e)return e;if(t.get(e))return t.get(e);const a=Array.isArray(e)?[]:{};t.set(e,a);for(const i in e)a[i]=r(e[i],t);const s=Object.getOwnPropertySymbols(e);for(const i of s)a[Symbol(i.description)]=r(e[i],t);return a}t["Z"]=r}}]);