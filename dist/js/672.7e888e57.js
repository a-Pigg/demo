"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[672],{80672:function(t,e,r){r.r(e),r.d(e,{default:function(){return P}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"borrow-and-return"},[e("el-card",{staticClass:"b-a-r-card"},[e("div",{staticClass:"b-a-r-card-header",attrs:{slot:"header"},slot:"header"},[e("ds-query-form",[e("ds-query-form-left-panel",[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.newBillsDialogVisible=!0}}},[t._v(t._s(t.$t("h.newBtn")))]),e("el-dropdown",{attrs:{trigger:"click"}},[e("el-button",{attrs:{size:"small"}},[t._v(" "+t._s(t.$t("h.editBtn"))),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{nativeOn:{click:function(e){return t.editBorrowForm.apply(null,arguments)}}},[t._v(t._s(t.$t("h.changeBtn")))]),e("el-dropdown-item",{nativeOn:{click:function(e){return t.deleteBorrowBills.apply(null,arguments)}}},[t._v(t._s(t.$t("h.delBtn")))])],1)],1),e("el-dropdown",{staticStyle:{"margin-left":"0px"},attrs:{trigger:"click"}},[e("el-button",{attrs:{size:"small"}},[t._v(t._s(t.$t("h.printBtn"))+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{nativeOn:{click:function(e){return t.goPrintBills.apply(null,arguments)}}},[t._v(t._s(t.$t("h.printDoucmentBtn")))]),e("el-dropdown-item",{nativeOn:{click:function(e){return t.openPrintSet.apply(null,arguments)}}},[t._v(t._s(t.$t("h.tempSetBtn")))])],1)],1),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.billsExportDialogVisible=!0}}},[t._v(t._s(t.$t("h.exportBtn")))])],1),e("ds-query-form-right-panel",[e("ds-search-btn",{attrs:{searchValue:t.andLike},on:{"update:searchValue":function(e){t.andLike=e},"update:search-value":function(e){t.andLike=e},search:t.findAssetSearch}})],1)],1)],1),e("div",{staticClass:"b-a-r-card-content"},[e("div",{staticClass:"bills-filter"},[e("ds-filter-tag",{attrs:{filterTagsData:t.highFilterTags},on:{handleCloseTag:t.handleCloseFilterTag}}),e("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(e){t.filterDrawerVisible=!0}}},[t._v(t._s(t.$t("h.advancedBtn")))])],1),e("div",{staticClass:"bills-table"},[e("ds-table",{ref:"billsTableRef",attrs:{loading:t.tableLoading,tableConfig:t.billsTableConfig,columns:t.billsColums,tableData:t.borrowAndReturngBills,rowKey:t=>t._id},on:{handleSelectionChange:t.handleSelectionChange,checkTableRowDetail:t.checkBillDetail},scopedSlots:t._u([{key:"operation",fn:function({scope:r}){return[e("el-popover",{ref:`uploadPopoverRef-${r.row._id}`,attrs:{placement:"left",width:"100"},on:{"after-leave":t.billPopAsterLeave}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.uploadImgLoading,expression:"uploadImgLoading"}],staticClass:"popover-cotent"},[e("upload-photo",{attrs:{value:t.billPhotoFile},on:{"update:value":function(e){t.billPhotoFile=e}}}),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.uploadBillPhoto(r.row)}}},[t._v(t._s(t.$t("h.confirmBtn")))])],1),e("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t._v(t._s(t.$t("h.uploadVouchers")))])],1),e("span",{staticClass:"line"}),e("el-button",{attrs:{type:"text",size:"small",disabled:0!=r.row.status||0==r.row.borrowState},on:{click:function(e){return t.assertsReturn(r.row)}}},[t._v(t._s(t.$t("h.returnBtn")))])]}}])})],1),e("div",{staticClass:"bills-pagination"},[e("ds-pagination",{attrs:{small:"",total:t.total,page:t.paginationForm.currentPage,limit:t.paginationForm.pageSize},on:{"update:page":function(e){return t.$set(t.paginationForm,"currentPage",e)},"update:limit":function(e){return t.$set(t.paginationForm,"pageSize",e)},pagination:t.getBorrowAndRetureBills}})],1)])]),e("ds-filter-drawer",{attrs:{filterDrawerVisible:t.filterDrawerVisible},on:{"update:filterDrawerVisible":function(e){t.filterDrawerVisible=e},"update:filter-drawer-visible":function(e){t.filterDrawerVisible=e},submitFilterForm:t.submitFilterForm,resetFilterForm:t.resetFilterForm}},[e("el-form",{ref:"filterFormRef",attrs:{"label-width":"110px",model:t.filterForm}},[e("el-form-item",{attrs:{label:t.$t("h.borrowingDepartment"),prop:"deptId"}},[e("ds-select-tree",{attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrowingDepartment"),multiple:!0,checkStrictly:!0,collapseTags:"",treeData:t.treeDepts,defaultProps:t.deptTreeProps},model:{value:t.filterForm.deptId,callback:function(e){t.$set(t.filterForm,"deptId",e)},expression:"filterForm.deptId"}})],1),e("el-form-item",{attrs:{label:t.$t("h.borrower"),prop:"staffId"}},[e("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:t.staffData,modelField:"_id",model:t.filterForm.staffId.join(","),searchField:"andLike",func:"S0005",userInfo:t.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: filterForm.staffId.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],ref:"highFilterStaffSelectref",attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrower"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:t.filterForm.staffId,callback:function(e){t.$set(t.filterForm,"staffId",e)},expression:"filterForm.staffId"}},t._l(t.staffData,(function(r){return e("el-option",{key:r._id,attrs:{label:r.name,value:r._id}},[e("span",[t._v(t._s(r.name+"("+r.code+")")+" -"+t._s(r.deptName))])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.auditStatus"),prop:"status"}},[e("el-select",{attrs:{multiple:"",placeholder:t.$t("h.tips4")+t.$t("h.auditStatus"),clearable:"",filterable:""},model:{value:t.filterForm.status,callback:function(e){t.$set(t.filterForm,"status",e)},expression:"filterForm.status"}},t._l(t.statusListData,(function(t,r){return e("el-option",{key:r,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.borrowingDate"),prop:"borrowData"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":t.$t("h.to"),"start-placeholder":t.$t("h.startDate"),"end-placeholder":t.$t("h.endDate")},model:{value:t.filterForm.borrowData,callback:function(e){t.$set(t.filterForm,"borrowData",e)},expression:"filterForm.borrowData"}})],1),e("el-form-item",{attrs:{label:t.$t("h.estimatedReturnDate"),prop:"borrowBackData"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":t.$t("h.to"),"start-placeholder":t.$t("h.startDate"),"end-placeholder":t.$t("h.endDate")},model:{value:t.filterForm.borrowBackData,callback:function(e){t.$set(t.filterForm,"borrowBackData",e)},expression:"filterForm.borrowBackData"}})],1)],1)],1),e("bill-detail-dialog",{attrs:{print:"",billDetailDialogVisible:t.billDetailDialogVisible,billFormDetail:t.billFormDetail,auditStep:t.auditStep},on:{"update:billDetailDialogVisible":function(e){t.billDetailDialogVisible=e},"update:bill-detail-dialog-visible":function(e){t.billDetailDialogVisible=e},closed:t.billDetailDialogVisibleClosed,print:t.printBillAssets}},[e("template",{slot:"table"},[e("ds-table",{ref:"detailTableRef",attrs:{loading:t.detailLoading,tableData:t.detailAssets,columns:t.billAssetsColumns,tableConfig:t.detailConfig,rowKey:t=>t._id},on:{handleSelectionChange:t.selectPrintAssets}})],1),e("template",{slot:"pagination"},[e("ds-pagination",{attrs:{small:"",total:t.detailTotal,page:t.detailPaginationForm.currentPage,limit:t.detailPaginationForm.pageSize},on:{"update:page":function(e){return t.$set(t.detailPaginationForm,"currentPage",e)},"update:limit":function(e){return t.$set(t.detailPaginationForm,"pageSize",e)},pagination:t.getMatchAssets}})],1)],2),e("bills-export-dialog",{attrs:{billsExportDialogVisible:t.billsExportDialogVisible,percentage:t.exportPercentage,step:t.exportStep,errorContent:t.exportErrorContent},on:{"update:billsExportDialogVisible":function(e){t.billsExportDialogVisible=e},"update:bills-export-dialog-visible":function(e){t.billsExportDialogVisible=e},submitExportForm:t.submitExportForm,close:t.billsExportDialogVisibleClose}},[e("el-form",{ref:"exportFormRef",attrs:{"label-width":"110px",model:t.exportForm}},[e("el-form-item",{attrs:{label:t.$t("h.borrowingDepartment"),prop:"deptId"}},[e("ds-select-tree",{attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrowingDepartment"),multiple:!0,checkStrictly:!0,treeData:t.treeDepts,defaultProps:t.deptTreeProps,collapseTags:""},model:{value:t.exportForm.deptId,callback:function(e){t.$set(t.exportForm,"deptId",e)},expression:"exportForm.deptId"}})],1),e("el-form-item",{attrs:{label:t.$t("h.borrower"),prop:"staffId"}},[e("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:t.staffData,modelField:"_id",model:t.exportForm.staffId.join(","),searchField:"andLike",func:"S0005",userInfo:t.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: exportForm.staffId.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrower"),multiple:"",clearable:"",filterable:"","filter-method":()=>{}},model:{value:t.exportForm.staffId,callback:function(e){t.$set(t.exportForm,"staffId",e)},expression:"exportForm.staffId"}},t._l(t.staffData,(function(r){return e("el-option",{key:r._id,attrs:{label:r.name,value:r._id}},[e("span",[t._v(t._s(r.name+"("+r.code+")")+" -"+t._s(r.deptName))])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.auditStatus"),prop:"status"}},[e("el-select",{attrs:{multiple:"",placeholder:t.$t("h.tips4")+t.$t("h.auditStatus"),clearable:"",filterable:""},model:{value:t.exportForm.status,callback:function(e){t.$set(t.exportForm,"status",e)},expression:"exportForm.status"}},t._l(t.statusListData,(function(t,r){return e("el-option",{key:r,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.borrowingDate"),prop:"borrowData"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":t.$t("h.to"),"start-placeholder":t.$t("h.startDate"),"end-placeholder":t.$t("h.endDate")},model:{value:t.exportForm.borrowData,callback:function(e){t.$set(t.exportForm,"borrowData",e)},expression:"exportForm.borrowData"}})],1),e("el-form-item",{attrs:{label:t.$t("h.estimatedReturnDate"),prop:"borrowBackData"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":t.$t("h.to"),"start-placeholder":t.$t("h.startDate"),"end-placeholder":t.$t("h.endDate")},model:{value:t.exportForm.borrowBackData,callback:function(e){t.$set(t.exportForm,"borrowBackData",e)},expression:"exportForm.borrowBackData"}})],1)],1)],1),e("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{title:t.newBillTitle,newBillsDialogVisible:t.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(e){t.newBillsDialogVisible=e},"update:new-bills-dialog-visible":function(e){t.newBillsDialogVisible=e},opened:t.newBillsDialogOpened,close:t.newBillsDialogClose,sbumitForm:t.sbumitBorrowForm}},[e("template",{slot:"form"},[e("el-form",{ref:"borrowFormRef",attrs:{"label-width":"130px",model:t.borrowForm,rules:t.borrowFormRules}},[t.newBillsDialogVisible?e("el-form-item",{attrs:{label:t.$t("h.borrower"),prop:"staffId"}},[e("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:t.staffData,modelField:"_id",model:t.borrowForm.staffId,searchField:"andLike",func:"S0005",userInfo:t.userInfo},expression:"{\n              options: staffData,\n              modelField: '_id',\n              model: borrowForm.staffId,\n              searchField: 'andLike',\n              func: 'S0005',\n              userInfo: userInfo,\n            }"}],attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrower"),clearable:"",filterable:"","filter-method":()=>{}},on:{change:t.staffSelectChange},model:{value:t.borrowForm.staffId,callback:function(e){t.$set(t.borrowForm,"staffId",e)},expression:"borrowForm.staffId"}},t._l(t.staffData,(function(r){return e("el-option",{key:r._id,attrs:{label:r.name,value:r._id}},[e("span",[t._v(t._s(r.name+"("+r.code+")")+" -"+t._s(r.deptName))])])})),1)],1):t._e(),e("el-form-item",{attrs:{label:t.$t("h.borrowingDepartment"),prop:"deptId"}},[e("ds-select-tree",{attrs:{placeholder:t.$t("h.tips4")+t.$t("h.borrowingDepartment"),defaultProps:t.deptTreeProps,treeData:t.treeDepts},on:{input:t.deptInput},model:{value:t.borrowForm.deptId,callback:function(e){t.$set(t.borrowForm,"deptId",e)},expression:"borrowForm.deptId"}})],1),e("el-form-item",{attrs:{label:t.$t("h.borrowingDate"),prop:"borrowData"}},[e("el-date-picker",{attrs:{format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd",type:"date",placeholder:t.$t("h.tips4")+t.$t("h.borrowingDate")},model:{value:t.borrowForm.borrowData,callback:function(e){t.$set(t.borrowForm,"borrowData",e)},expression:"borrowForm.borrowData"}})],1),e("el-form-item",{attrs:{label:t.$t("h.estimatedReturnDate"),prop:"borrowBackData"}},[e("el-date-picker",{attrs:{format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd",type:"date",placeholder:t.$t("h.tips4")+t.$t("h.estimatedReturnDate")},model:{value:t.borrowForm.borrowBackData,callback:function(e){t.$set(t.borrowForm,"borrowBackData",e)},expression:"borrowForm.borrowBackData"}})],1),e("el-form-item",{attrs:{label:t.$t("h.comment"),prop:"borrowBeizhu"}},[e("el-input",{attrs:{placeholder:t.$t("h.tips3")+t.$t("h.comment")},model:{value:t.borrowForm.borrowBeizhu,callback:function(e){t.$set(t.borrowForm,"borrowBeizhu",e)},expression:"borrowForm.borrowBeizhu"}})],1)],1)],1),e("template",{slot:"btns"},[e("div",[e("span",{staticClass:"title"},[t._v(t._s(t.$t("h.selectAsset")))])]),e("div",{staticClass:"btns"},[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.matchAssetsDialogVisible=!0}}},[t._v(t._s(t.$t("h.addBtn")))]),e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.deleteBillSelectAssets}},[t._v(t._s(t.$t("h.delBtn")))])],1)]),e("template",{slot:"table"},[e("div",{staticClass:"bill-table"},[e("ds-table",{ref:"billAssetsRef",attrs:{loading:t.billAssetsLoading,tableData:t.billAssets,columns:t.assetsColumns,tableConfig:t.billsTableConfig,rowKey:t=>t._id},on:{handleSelectionChange:t.billAssetsSelectionChange}})],1)])],2),e("match-assets-dialog",{attrs:{matchAssetsDialogVisible:t.matchAssetsDialogVisible,state:t.matchState,updateSelectBillAssets:t.billAssets,deptData:t.depts,deptTreeData:t.treeDepts},on:{"update:matchAssetsDialogVisible":function(e){t.matchAssetsDialogVisible=e},"update:match-assets-dialog-visible":function(e){t.matchAssetsDialogVisible=e},save:t.savaSelectAssets}}),e("ds-delete-detail",{attrs:{deleteDialogVisible:t.deleteDialogVisible,deleteColumns:t.deleteColumns,deleteErrorData:t.deleteErrorData},on:{"update:deleteDialogVisible":function(e){t.deleteDialogVisible=e},"update:delete-dialog-visible":function(e){t.deleteDialogVisible=e},closed:t.deleteDialogVisibleClosed}}),e("bill-print-template",{ref:"vptRef",attrs:{title:t.$t("h.title14"),selectId:t.borrowTemplateId,voucherPrintTempList:t.billPrintTemplate},on:{setVoucherTag:t.setBillPrintTemplate}}),e("bill-print-dialog",{ref:"vpdRef",attrs:{locationName:"borrowTemplateId",voucherData:t.selectBorrowBills,userInfo:t.userInfo,voucherPrintTemplate:t.billPrintTemplate}}),e("el-drawer",{attrs:{title:t.$t("h.return1"),direction:"rtl",visible:t.returnDrawer,"before-close":t.returnDrawerHandleClose,"custom-class":"return-drawer",size:"80%"},on:{"update:visible":function(e){t.returnDrawer=e}}},[e("el-form",{ref:"returnFormRef",attrs:{"label-width":"130px",model:t.returnForm,rules:t.returnFormRules,inline:!0}},[e("el-form-item",{attrs:{label:t.$t("h.personWhoReturnAsset"),prop:"staffId"}},[e("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:t.staffData,modelField:"_id",model:t.returnForm.staffId,searchField:"andLike",func:"S0005",userInfo:t.userInfo},expression:"{\n            options: staffData,\n            modelField: '_id',\n            model: returnForm.staffId,\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],attrs:{placeholder:t.$t("h.tips4")+t.$t("h.personWhoReturnAsset"),clearable:"",filterable:"","filter-method":()=>{}},on:{change:t.returnStaffSelectChange},model:{value:t.returnForm.staffId,callback:function(e){t.$set(t.returnForm,"staffId",e)},expression:"returnForm.staffId"}},t._l(t.staffData,(function(r){return e("el-option",{key:r._id,attrs:{label:r.name,value:r._id}},[e("span",[t._v(t._s(r.name+"("+r.code+")")+" -"+t._s(r.deptName))])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.returnDepartment"),prop:"deptId"}},[e("ds-select-tree",{attrs:{placeholder:t.$t("h.tips4")+t.$t("h.returnDepartment"),defaultProps:t.deptTreeProps,treeData:t.treeDepts},on:{input:t.returnDeptInput},model:{value:t.returnForm.deptId,callback:function(e){t.$set(t.returnForm,"deptId",e)},expression:"returnForm.deptId"}})],1),e("el-form-item",{attrs:{label:t.$t("h.returnDate"),prop:"date"}},[e("el-date-picker",{attrs:{format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd",type:"date",placeholder:t.$t("h.tips4")+t.$t("h.returnDate")},model:{value:t.returnForm.date,callback:function(e){t.$set(t.returnForm,"date",e)},expression:"returnForm.date"}})],1)],1),e("div",{staticClass:"title"},[e("span",[t._v(t._s(t.$t("h.selectAsset")))])]),e("div",{staticClass:"table"},[e("div",{staticClass:"top"},[e("ds-table",{ref:"returnDetailTableRef",attrs:{loading:t.detailLoading,tableData:t.returnDetailAssets,columns:t.assetsColumns,tableConfig:t.billsTableConfig,rowKey:t=>t._id},on:{handleSelectionChange:t.handleSelectionChangeAssets}})],1),e("div",{staticClass:"bottom"},[e("ds-pagination",{attrs:{small:"",total:t.returnDetailTotal,page:t.returnDetailPaginationForm.currentPage,limit:t.returnDetailPaginationForm.pageSize},on:{"update:page":function(e){return t.$set(t.returnDetailPaginationForm,"currentPage",e)},"update:limit":function(e){return t.$set(t.returnDetailPaginationForm,"pageSize",e)},pagination:t.getReturnMatchAssets}})],1)]),e("div",{staticClass:"button"},[e("el-button",{on:{click:t.returnDrawerHandleClose}},[t._v(t._s(t.$t("h.tips29")))]),e("el-button",{attrs:{type:"primary"},on:{click:t.sbumitReturnForm}},[t._v(t._s(t.$t("h.confirmBtn")))])],1)],1),e("asset-print-dialog",{ref:"apdRef",attrs:{userInfo:t.userInfo,selectAssetsData:t.printAssets}})],1)},i=[],a=(r(57658),r(3701)),o=r(62887),l=r(93390),n=r(98884),d=r(60983),h=r(93082),u=r(17817),p=r(5791),m=r(88048),f=r(66403),c=r(52086),b=r(78067),g=r(22931),w=r(42041),D=r(53595),F=r(19698),$=r(92003),I=r(89782),B=r(20629),v=r(83151),k=r(76080),S=r(55886),_=r(79992),x={components:{AssetPrintDialog:a.Z,BillPrintDialog:o.Z,BillPrintTemplate:l.Z,DsDeleteDetail:n.Z,DsTable:d.Z,DsPagination:h.Z,DsFilterTag:u.Z,DsFilterDrawer:p.Z,UploadPhoto:m.Z,DsSelectTree:c.Z,DsSearchBtn:f.Z,NewBillsDialog:w.Z,MatchAssetsDialog:D.Z,BillDetailDialog:b.Z,BillsExportDialog:g.Z,DsQueryForm:F.Z,DsQueryFormLeftPanel:$.Z,DsQueryFormRightPanel:I.Z},data(){return{tableLoading:!1,billsTableConfig:{selection:!0,reserveSelection:!0},billsColums:v.lM,total:0,paginationForm:{currentPage:1,pageSize:20},borrowAndReturngBills:[],selectBorrowBills:[],uploadImgLoading:!1,billPhotoFile:"",filterDrawerVisible:!1,filterForm:{deptId:[],staffId:[],status:[],borrowData:[],borrowBackData:[]},andLike:"",deptTreeProps:{value:"_id",label:"deptName",children:"children"},depts:[],treeDepts:[],staffData:[],statusListData:v.k0,highFilterTags:[],billsExportDialogVisible:!1,exportPercentage:0,exportStep:"",exportErrorContent:"",exportForm:{deptId:[],staffId:[],status:[],borrowBackData:[],borrowData:[]},billDetailDialogVisible:!1,billFormDetail:[],auditStep:[],detailLoading:!1,detailAssets:[],detailMatchAssetIds:[],detailConfig:{selection:!0,reserveSelection:!0},detailTotal:0,detailPaginationForm:{currentPage:1,pageSize:20},newBillsDialogVisible:!1,newBillTitle:this.$t("h.title12"),dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},borrowForm:{_id:"",deptId:"",staffId:"",borrowData:(0,_.X$)(),borrowBackData:"",borrowBeizhu:""},borrowFormRules:{staffId:[{required:!0,message:this.$t("h.tips4")+this.$t("h.borrower"),trigger:"change"}],borrowData:[{required:!0,message:this.$t("h.tips4")+this.$t("h.date"),trigger:"change"}],borrowBackData:[{required:!0,message:this.$t("h.tips4")+this.$t("h.returnDate"),trigger:"change"}]},selectBillAssets:[],matchAssetsDialogVisible:!1,billAssetsLoading:!1,matchState:"0,1",billAssets:[],assetIdsState:[],deleteDialogVisible:!1,deleteColumns:v.JR,deleteErrorData:[],billPrintTemplate:[],borrowTemplateId:"",returnDrawer:!1,returnDetailTotal:0,returnDetailPaginationForm:{currentPage:1,pageSize:20},returnLoading:!1,returnDetailAssets:[],returnAssets:[],borrowAssetIds:null,returnForm:{revertId:"",deptId:"",staffId:"",date:(0,_.X$)()},returnFormRules:{staffId:[{required:!0,message:this.$t("h.tips4")+this.$t("h.personWhoReturnAsset"),trigger:"change"}],deptId:[{required:!0,message:this.$t("h.tips4")+this.$t("h.returnDepartment"),trigger:"change"}],date:[{required:!0,message:this.$t("h.tips4")+this.$t("h.returnDate"),trigger:"change"}]},billDetaulVal:null,printAssets:[]}},computed:{...(0,B.rn)(["userInfo","assetTableHeader","stateListData"]),billAssetsColumns(){let t=[];return this.assetTableHeader.forEach((e=>{"assetCode"==e.attr||"type"==e.attr||"name"==e.attr||"model"==e.attr||"assertPosition"==e.attr?t.push({prop:e.attr,label:e.label,fixed:e.fixed,minWidth:(0,_.Uh)(e.label),showOverflowTooltip:!0}):"photo"==e.attr&&t.push({type:"image",prop:e.attr,label:e.label,fixed:e.fixed,width:(0,_.Uh)(e.label)})})),t},assetsColumns(){let t=[];return this.assetTableHeader.forEach((e=>{"state"==e.attr?t.push({type:"assetState",prop:e.attr,label:e.label,fixed:e.fixed,width:(0,_.Uh)(e.label),formatter:t=>this.stateListData.find((r=>r._id==t[e.attr])).label}):"assetCode"==e.attr||"type"==e.attr||"name"==e.attr||"model"==e.attr||"assertPosition"==e.attr?t.push({prop:e.attr,label:e.label,fixed:e.fixed,minWidth:(0,_.Uh)(e.label),showOverflowTooltip:!0}):"photo"==e.attr&&t.push({type:"image",prop:e.attr,label:e.label,fixed:e.fixed,width:(0,_.Uh)(e.label)})})),t}},methods:{getBorrowAndRetureBills(){this.tableLoading=!0,null==this.filterForm.borrowBackData&&(this.filterForm.borrowBackData=[]),null==this.filterForm.borrowData&&(this.filterForm.borrowData=[]),null==this.filterForm.deptId&&(this.filterForm.deptId=[]),(0,k.Ys)({func:"S0008",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,staffId:this.filterForm.staffId.join(","),deptId:this.filterForm.deptId.join(","),status:this.filterForm.status.join(","),borrowData:this.filterForm.borrowData.join(","),borrowBackData:this.filterForm.borrowBackData.join(","),andLike:this.andLike}}).then((({data:t})=>{if(this.tableLoading=!1,0!=t.code)return this.$message.error(t.data);this.total=t.data[0],this.borrowAndReturngBills=t.data[1],this.borrowAndReturngBills.forEach((t=>{t.image&&(t.image=window.$EXCEL_URL+"image/"+t.image),t.company=window.sessionStorage.getItem("loginCompanyName")}))})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getDetps(){(0,k.Ys)({func:"S0004",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:t})=>{if(0!=t.code)return this.$message.error(t.data);this.depts=t.data,this.treeDepts=(0,S.M)(t.data,null)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},handleSelectionChange(t){this.selectBorrowBills=t},billPopAsterLeave(){this.billPhotoFile=""},uploadBillPhoto(t){return this.uploadImgLoading=!0,this.billPhotoFile?0!=t.status?(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips115"))):void(0,k.Vx)({func:"U0062",token:this.userInfo.token,userId:this.userInfo._id,requstData:{id:t._id,type:t.roleRule.slice(0,2),image:this.billPhotoFile,permissonId:28}}).then((({data:e})=>{if(this.uploadImgLoading=!1,0!=e.code)return this.$message.error(e.data);this.$message.success(e.data),this.$refs[`uploadPopoverRef-${t._id}`].doClose(),this.getBorrowAndRetureBills()})).catch((()=>(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips18"))))):(this.uploadImgLoading=!1,this.$message.error(this.$t("h.tips114")))},mapHighFilterTags(){this.highFilterTags=[];for(let t in this.filterForm)if(this.filterForm[t]&&this.filterForm[t].length)if("staffId"==t){let e={},r=[];this.$refs.highFilterStaffSelectref.selected.forEach((t=>{r.push(t.label)})),e.name=this.$t("h.borrower"),e.keyStr=t,e.value=r.join(","),this.highFilterTags.push(e)}else if("deptId"==t){let e={},r=[];this.filterForm[t].forEach((t=>{let e=this.depts.find((e=>e._id==t)).deptName;r.push(e)})),e.name=this.$t("h.borrowingDepartment"),e.keyStr=t,e.value=r.join(","),this.highFilterTags.push(e)}else if("status"==t){let e={},r=[];this.filterForm[t].forEach((t=>{let e=this.statusListData.find((e=>e.value==t)).label;r.push(e)})),e.name=this.$t("h.auditStatus"),e.keyStr=t,e.value=r.join(","),this.highFilterTags.push(e)}else if("borrowData"==t){let e={};e.name=this.$t("h.borrowingDate"),e.keyStr=t,e.value=this.filterForm[t].join("至"),this.highFilterTags.push(e)}else if("borrowBackData"==t){let e={};e.name=this.$t("h.estimatedReturnDate"),e.keyStr=t,e.value=this.filterForm[t].join("至"),this.highFilterTags.push(e)}},handleCloseFilterTag(t){this.highFilterTags.splice(this.highFilterTags.indexOf(t),1),this.filterForm[t.keyStr]=[],this.paginationForm.currentPage=1,this.getBorrowAndRetureBills()},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getBorrowAndRetureBills()},resetFilterForm(){this.$refs["filterFormRef"].resetFields(),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getBorrowAndRetureBills()},findAssetSearch(){this.paginationForm.currentPage=1,this.getBorrowAndRetureBills()},billsExportDialogVisibleClose(){this.$refs.exportFormRef.resetFields(),this.exportPercentage=0,this.exportStep="",this.exportErrorContent=""},submitExportForm(){this.exportStep="loading",this.exportPercentage=50,null==this.exportForm.borrowBackData&&(this.exportForm.borrowBackData=[]),null==this.exportForm.borrowData&&(this.exportForm.borrowData=[]),null==this.exportForm.deptId&&(this.exportForm.deptId=[]),(0,k.Vx)({func:"U0032",userId:this.userInfo._id,token:this.userInfo.token,requstData:{borrowData:this.exportForm.borrowData.join(","),borrowBackData:this.exportForm.borrowBackData.join(","),deptId:this.exportForm.deptId.join(","),staffId:this.exportForm.staffId.join(","),status:this.exportForm.status.join(","),permissonId:56}}).then((({data:t})=>{if(this.exportPercentage=100,0!=t.code)return this.exportStep="error",void(this.exportErrorContent=t.data);this.exportStep="success",(0,_.M)(window.$EXCEL_URL+t.data)})).catch((()=>{this.exportPercentage=100,this.exportStep="error",this.exportErrorContent=this.$t("h.tips18")}))},checkBillDetail(t){this.billFormDetail=(0,v.r7)(t),this.billDetaulVal=t,this.detailMatchAssetIds=t.assetIds.split(","),this.detailMatchAssetIds.length&&this.getMatchAssets(),this.getBillsAuditMessage(t),this.billDetailDialogVisible=!0},billDetailDialogVisibleClosed(){this.billDetaulVal=null,this.detailAssets=[],this.detailTotal=0,this.detailPaginationForm.currentPage=1,this.detailPaginationForm.pageSize=20,this.detailMatchAssetIds=[],this.printAssets=[],this.$refs["detailTableRef"].$refs["dsTableRef"].clearSelection()},getBillsAuditMessage(t){(0,k.Ys)({func:"S0053",token:this.userInfo.token,userId:this.userInfo._id,requstData:{_id:t._id,type:"JY"}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.auditStep=this.createBillAuditMessage(t,e.data)})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},createBillAuditMessage(t,e){let r=[];return t.examineOne&&r.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName1"),auditState:"more"}),t.examineTwo&&r.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName2"),auditState:"more"}),t.examineThree&&r.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName3"),auditState:"more"}),t.examineFour&&r.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName4"),auditState:"more"}),t.examineFive&&r.push({state:"pedding",auditStaffName:this.$t("h.auditStaffName5"),auditState:"more"}),r.forEach(((t,r)=>{if(e[r])if(void 0!=e[r].rejection){for(let s in e[r])"rejection"!=s&&(t.auditStaffName=e[r][s]);t.auditState="error",t.message=e[r].rejection}else{for(let s in e[r])"rejection"!=s&&(t.auditStaffName=e[r][s]);t.auditState="success"}})),r.push({state:"end"}),r},getMatchAssets(){this.detailLoading=!0,this.$nextTick((()=>{this.$refs.detailTableRef.$refs.dsTableRef.bodyWrapper.scrollTop=0})),(0,k.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:[{key:"_id",handle:"OIS",value:this.detailMatchAssetIds.join(",")}],page:this.detailPaginationForm.pageSize,index:this.detailPaginationForm.currentPage}}).then((({data:t})=>{if(this.detailLoading=!1,0!=t.code)return this.$message.error(t.data);this.detailTotal=t.data[0],this.detailAssets=t.data[1]})).catch((()=>{this.detailLoading=!1,this.$message.error(this.$t("h.tips18"))}))},newBillsDialogOpened(){this.$refs.borrowFormRef.clearValidate(),this.$refs.billAssetsRef.$refs.dsTableRef.clearSelection()},newBillsDialogClose(){this.selectBillAssets=[],this.billAssets=[],this.assetIdsState=[],this.borrowForm._id="",this.borrowForm.deptId="",this.borrowForm.staffId="",this.borrowForm.borrowData="",this.borrowForm.borrowBackData="",this.borrowForm.borrowBeizhu="",this.newBillTitle=this.$t("h.title12"),this.$refs.billsTableRef.$refs.dsTableRef.clearSelection()},sbumitBorrowForm(){this.$refs.borrowFormRef.validate((t=>{if(!t)return!1;if(!this.billAssets.length)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips112")});const e=this.$loading(this.dialogLoading);let r=""==this.borrowForm._id?31:62,s=[],i=[],a=[],o=[];this.billAssets.forEach((t=>{let e=this.assetIdsState.find((e=>e._id==t._id));e?o.push(e.state):o.push(t.state),s.push(t._id),i.push(t.name),a.push(t.assetCode)})),(0,k.Vx)({func:"U0009",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.borrowForm._id,assetIds:s.join(","),assetNames:i.join(","),assertCodes:a.join(","),deptId:this.borrowForm.deptId,staffId:this.borrowForm.staffId,borrowData:this.borrowForm.borrowData,borrowBackData:this.borrowForm.borrowBackData,borrowBeizhu:this.borrowForm.borrowBeizhu,borrowTel:this.userInfo.phone,borrowOpera:this.userInfo.staffName,borrowState:"2",fromState:o.join(","),permissonId:r}}).then((({data:t})=>{if(e.close(),0!=t.code)return this.$message.error(t.data);this.newBillsDialogVisible=!1,this.paginationForm.currentPage=1,this.getBorrowAndRetureBills()})).catch((()=>{e.close(),this.$message.error(this.$t("h.tips18"))}))}))},deleteBillSelectAssets(){this.selectBillAssets.forEach((t=>{this.billAssets.splice(this.billAssets.findIndex((e=>e._id===t._id)),1)})),this.$refs.billAssetsRef.$refs.dsTableRef.clearSelection()},savaSelectAssets(t){this.billAssets=t,this.matchAssetsDialogVisible=!1},billAssetsSelectionChange(t){this.selectBillAssets=t},deptInput(t){if(!t)return!1;let e=this.staffData.filter((e=>e.deptId==t));if(e.length){let t=e.find((t=>t._id==this.borrowForm.staffId));t||(this.borrowForm.staffId="")}else this.borrowForm.staffId=""},staffSelectChange(t){if(!t)return!1;this.borrowForm.deptId=this.staffData.find((e=>e._id==t)).deptId},editBorrowForm(){if(!this.selectBorrowBills.length||this.selectBorrowBills.length>1)return this.$message.error(this.$t("h.tips110"));if(-1!=this.selectBorrowBills[0].status)return this.$message.error(this.$t("h.tips111"));this.getMatchEditAssets(this.selectBorrowBills[0].assetIds),this.borrowForm._id=this.selectBorrowBills[0]._id,this.borrowForm.deptId=this.selectBorrowBills[0].deptId,this.borrowForm.staffId=this.selectBorrowBills[0].staffId,this.borrowForm.borrowData=this.selectBorrowBills[0].borrowData,this.borrowForm.borrowBackData=this.selectBorrowBills[0].borrowBackData,this.borrowForm.borrowBeizhu=this.selectBorrowBills[0].borrowBeizhu;let t=this.selectBorrowBills[0].assetIds.split(","),e=this.selectBorrowBills[0].fromState.split(",");t.forEach(((r,s)=>{this.assetIdsState.push({_id:t[s],state:e[s]})})),this.newBillTitle=this.$t("h.title13"),this.newBillsDialogVisible=!0},getMatchEditAssets(t){this.billAssetsLoading=!0,(0,k.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:[{key:"_id",handle:"OIS",value:t}]}}).then((({data:t})=>{if(this.billAssetsLoading=!1,0!=t.code)return this.$message.error(t.data);this.billAssets=t.data})).catch((()=>{this.billAssetsLoading=!1,this.$message.error(this.$t("h.tips18"))}))},deleteDialogVisibleClosed(){this.deleteErrorData=[]},deleteBorrowBills(){if(0==this.selectBorrowBills.length)return this.$message.error(this.$t("h.tips22"));for(let t=0;t<this.selectBorrowBills.length;t++)if(-1!=this.selectBorrowBills[t].status)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips116")});this.$confirm(this.$t("h.tips117"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{this.tableLoading=!0,this.deleteErrorData=[],this.multiDeleteBill(0)})).catch((()=>{this.$message.info(this.$t("h.tips98"))}))},multiDeleteBill(t){if(t>this.selectBorrowBills.length-1)return this.paginationForm.currentPage=1,this.getBorrowAndRetureBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.deleteErrorData.length?this.deleteDialogVisible=!0:this.$message.success(this.$t("h.tips118")));(0,k.SR)({func:"D0008",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.selectBorrowBills[t]._id,permissonId:32}}).then((({data:e})=>{0!=e.code&&this.deleteErrorData.push({roleRule:this.selectBorrowBills[t].roleRule,assetNames:this.selectBorrowBills[t].assetNames,reason:e.data}),this.multiDeleteBill(++t)})).catch((()=>{this.deleteErrorData.push({roleRule:this.selectBorrowBills[t].roleRule,assetNames:this.selectBorrowBills[t].assetNames,reason:this.$t("h.tips18")}),this.multiDeleteBill(++t)}))},openPrintSet(){this.$refs["vptRef"].printTempDialogVisible=!0},getBillPrintTemplate(){(0,k.Ys)({func:"S0034",userId:this.userInfo._id,token:this.userInfo.token,requstData:{type:"JY"}}).then((({data:t})=>{if(0!=t.code)return this.$message.error(t.data);this.billPrintTemplate=t.data,this.borrowTemplateId=localStorage.getItem("borrowTemplateId"),this.billPrintTemplate.some((t=>t._id==this.borrowTemplateId))||(this.borrowTemplateId=this.billPrintTemplate[0]._id,localStorage.setItem("borrowTemplateId",this.borrowTemplateId))})).catch((()=>{this.$message.error(this.$t("h.tips119"))}))},setBillPrintTemplate(t){this.borrowTemplateId=t,window.localStorage.setItem("borrowTemplateId",t)},goPrintBills(){return 0==this.selectBorrowBills.length?this.$message.error(this.$t("h.tips121")):this.selectBorrowBills.length>10?this.$message.error(this.$t("h.tips122")+10+this.$t("h.tips123")):void(this.$refs["vpdRef"].voucherPrintDialogVisible=!0)},assertsReturn(t){this.returnDrawer=!0,this.borrowAssetIds=t.assetIds,this.getReturnMatchAssets()},getReturnMatchAssets(){this.returnLoading=!0,(0,k.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:[{key:"_id",handle:"OIS",value:this.borrowAssetIds},{key:"stauss",handle:"OIS",value:0},{key:"state",handle:"OIS",value:2}],page:this.returnDetailPaginationForm.pageSize,index:this.returnDetailPaginationForm.currentPage}}).then((({data:t})=>{if(this.returnLoading=!1,0!=t.code)return this.$message.error(t.data);this.returnDetailTotal=t.data[0],this.returnDetailAssets=t.data[1]})).catch((()=>{this.returnLoading=!1,this.$message.error(this.$t("h.tips18"))}))},returnDrawerHandleClose(){this.returnDrawer=!1,this.returnDetailAssets=[],this.borrowAssetIds=null,this.$refs.returnFormRef.resetFields()},returnStaffSelectChange(t){if(!t)return!1;this.returnForm.deptId=this.staffData.find((e=>e._id==t)).deptId},returnDeptInput(t){if(!t)return!1;let e=this.staffData.filter((e=>e.deptId==t));if(e.length){let t=e.find((t=>t._id==this.returnForm.staffId));t||(this.returnForm.staffId="")}else this.returnForm.staffId=""},handleSelectionChangeAssets(t){this.returnAssets=t},sbumitReturnForm(){this.$refs.returnFormRef.validate((t=>{if(!t)return!1;if(!this.returnAssets.length)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips112")});const e=this.$loading(this.dialogLoading);let r=[],s=[],i=[];this.returnAssets.forEach((t=>{r.push(t._id),s.push(t.name),i.push(t.assetCode)})),(0,k.Vx)({func:"U0073",userId:this.userInfo._id,token:this.userInfo.token,requstData:{revertId:this.returnForm.revertId,deptId:this.returnForm.deptId,staffId:this.returnForm.staffId,date:this.returnForm.date,assetIds:r.join(","),assetNames:s.join(","),assertCodes:i.join(","),permissonId:87}}).then((({data:t})=>{if(e.close(),0!=t.code)return this.$message.error(t.data);this.returnDrawer=!1,this.paginationForm.currentPage=1,this.$message.success(t.data),this.getBorrowAndRetureBills()})).catch((()=>{e.close(),this.$message.error(this.$t("h.tips18"))}))}))},selectPrintAssets(t){this.printAssets=t},printBillAssets(){return 0!=this.billDetaulVal.status?this.$message.error(this.$t("h.tips115")):this.printAssets.length?void(this.$refs.apdRef.dialogVisible=!0):this.$message.error(this.$t("h.tips124"))}},created(){this.getBorrowAndRetureBills(),this.getDetps(),this.getBillPrintTemplate()}},A=x,y=r(1001),T=(0,y.Z)(A,s,i,!1,null,"d6643f42",null),P=T.exports}}]);