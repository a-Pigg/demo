"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[8017],{98884:function(e,t,i){i.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"dialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.title))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.dialogVisible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("ds-table",{attrs:{tableData:e.deleteErrorData,columns:e.deleteColumns,tableConfig:e.errorTableConfig}})],1)])},s=[],l=i(60983),n={components:{DsTable:l.Z},data(){return{errorTableConfig:{index:!0}}},props:{deleteDialogVisible:{type:Boolean,default:!1},deleteErrorData:{type:Array,default:()=>[]},deleteColumns:{type:Array},title:{type:String,default:"删除失败详情"}},computed:{dialogVisible:{get(){return this.deleteDialogVisible},set(e){this.$emit("update:deleteDialogVisible",e)}}},methods:{dialogVisibleClosed(){this.$emit("closed")}}},o=n,r=i(1001),h=(0,r.Z)(o,a,s,!1,null,"3e3e8f93",null),c=h.exports},93082:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-pagination"},[t("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},s=[],l={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e})},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize})}}},n=l,o=i(1001),r=(0,o.Z)(n,a,s,!1,null,"2377c114",null),h=r.exports},92003:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"left-panel"},[e._t("default")],2)},s=[],l={name:"DsQueryFormLeftPanel"},n=l,o=i(1001),r=(0,o.Z)(n,a,s,!1,null,"71d76034",null),h=r.exports},89782:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"right-panel"},[e._t("default")],2)},s=[],l={name:"DsQueryFormRightPanel"},n=l,o=i(1001),r=(0,o.Z)(n,a,s,!1,null,"c6443ba6",null),h=r.exports},19698:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-query-form"},[e._t("default")],2)},s=[],l={name:"DsQueryForm"},n=l,o=i(1001),r=(0,o.Z)(n,a,s,!1,null,"6c8bfb78",null),h=r.exports},66403:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-search"},[t("el-input",{attrs:{size:"small",placeholder:e.$t("h.keyword"),"prefix-icon":"el-icon-search"},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value="string"===typeof t?t.trim():t},expression:"value"}},[t("el-button",{attrs:{slot:"suffix",type:"text",size:"small"},on:{click:e.search},slot:"suffix"},[e._v(e._s(e.$t("h.Search")))])],1)],1)},s=[],l={name:"DsSearchBtn",data(){return{}},props:{searchValue:{type:String}},computed:{value:{get(){return this.searchValue},set(e){this.$emit("update:searchValue",e)}}},methods:{search(){this.$emit("search")},onInput(e){""==e&&this.search()}}},n=l,o=i(1001),r=(0,o.Z)(n,a,s,!1,null,"5bd7b965",null),h=r.exports},90376:function(e,t,i){i.r(t),i.d(t,{default:function(){return w}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"area"},[t("el-card",{staticClass:"area-card"},[t("div",{staticClass:"area-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.newBillsDialogVisible=!0}}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-button",{attrs:{type:"danger",size:"mini",disabled:e.isDeleteDisabled},on:{click:e.deleteAreas}},[e._v(e._s(e.$t("h.delBtn")))]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.readDialogVisible=!0}}},[e._v(e._s(e.$t("h.bulkBtn")))])],1),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.findAssetSearch}})],1)],1)],1),t("div",{staticClass:"area-card-content"},[t("div",{staticClass:"bills-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.loading,tableConfig:e.billsTableConfig,columns:e.billsColums,tableData:e.areaBills,rowKey:e=>e._id},on:{handleSelectionChange:e.handleSelectionChange},scopedSlots:e._u([{key:"operation",fn:function({scope:i}){return[t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-tickets"},on:{click:function(t){return e.oneKeyCheck(i.row)}}},[e._v(e._s(e.$t("h.oneClickInventory")))]),t("span",{staticClass:"line"}),t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.editAreaForm(i.row)}}},[e._v(e._s(e.$t("h.editBtn")))]),t("span",{staticClass:"line"}),t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteAreaForm(i.row)}}},[e._v(e._s(e.$t("h.delBtn")))])]}}])})],1),t("div",{staticClass:"bills-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getAreaBills}})],1)])]),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{title:e.newBillTitle,newBillsDialogVisible:e.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},opened:e.newBillsDialogOpened,close:e.newBillsDialogClose,sbumitForm:e.sbumitAreaForm}},[t("template",{slot:"form"},[t("el-form",{ref:"areaFormRef",attrs:{"label-width":"130px",model:e.areaForm,rules:e.areaFormRules}},[t("el-form-item",{attrs:{label:"*"+e.$t("h.areaCode"),prop:"code","label-width":"98px"}},[t("el-input",{model:{value:e.areaForm.code,callback:function(t){e.$set(e.areaForm,"code",t)},expression:"areaForm.code"}}),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("h.tips17"),placement:"top"}},[t("i",{staticClass:"el-icon-question",staticStyle:{"font-size":"20px",color:"#473bb4",position:"absolute",top:"10px",right:"-20px"}})])],1),t("el-form-item",{attrs:{label:e.$t("h.areaName2"),prop:"wareHouseName","label-width":"98px"}},[t("el-input",{model:{value:e.areaForm.wareHouseName,callback:function(t){e.$set(e.areaForm,"wareHouseName","string"===typeof t?t.trim():t)},expression:"areaForm.wareHouseName"}})],1)],1)],1)],2),t("ds-delete-detail",{attrs:{deleteDialogVisible:e.deleteDialogVisible,deleteColumns:e.deleteColumns,deleteErrorData:e.deleteErrorData},on:{"update:deleteDialogVisible":function(t){e.deleteDialogVisible=t},"update:delete-dialog-visible":function(t){e.deleteDialogVisible=t},closed:e.deleteDialogVisibleClosed}}),t("read-excel-file",{attrs:{readDialogVisible:e.readDialogVisible,setp:e.setp,percentage:e.percentage,errorText:e.errorText,title:e.$t("h.bulkBtn")},on:{"update:readDialogVisible":function(t){e.readDialogVisible=t},"update:read-dialog-visible":function(t){e.readDialogVisible=t},closed:e.readDialogVisibleClosed,download:e.downloadImportFile,submit:e.readDialogVisibleSubmit}},[t("upload-excel-file",{attrs:{value:e.file,loading:e.readLoading},on:{"update:value":function(t){e.file=t}}})],1),t("el-dialog",{attrs:{top:"0","custom-class":"oneKeyDialog","show-close":!1,visible:e.oneKeyDialogVisible,"before-close":e.oneKeyDialogBeforeClose},on:{"update:visible":function(t){e.oneKeyDialogVisible=t},closed:e.oneKeyDialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.$t("h.oneClickInventory")))]),t("span",{directives:[{name:"show",rawName:"v-show",value:null!=e.timer,expression:"timer != null"}],staticClass:"checking"},[e._v(e._s(e.$t("h.title133"))),t("i",{staticClass:"el-icon-loading"})])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.oneKeyDialogVisible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"btns"},[null==e.timer?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.startOneKeyCheck}},[e._v(e._s(e.$t("h.title143")))]):t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:e.endCheck}},[e._v(e._s(e.$t("h.title144")))]),t("el-select",{staticStyle:{margin:"0 10px"},attrs:{size:"mini",clearable:"",filterable:"",placeholder:e.$t("h.tips4")+e.$t("h.title129"),disabled:null!=e.timer,"value-key":"equipment_id"},on:{change:e.onChangePDT},model:{value:e.equimentOption,callback:function(t){e.equimentOption=t},expression:"equimentOption"}},e._l(e.equiments,(function(e){return t("el-option",{key:e.equipment_id,attrs:{label:e.name,value:e}})})),1),t("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",placeholder:e.$t("h.tips3")+e.$t("h.formTips39")+"IP"},model:{value:e.ip,callback:function(t){e.ip=t},expression:"ip"}},[t("el-tooltip",{attrs:{slot:"suffix",effect:"dark",content:e.$t("h.formTips40"),placement:"top-start"},slot:"suffix"},[t("el-button",{attrs:{type:"text",icon:"el-icon-info",size:"mini"}})],1)],1),t("el-select",{staticStyle:{margin:"0 10px"},attrs:{size:"mini",placeholder:e.$t("h.tips4")+e.$t("h.title145"),clearable:"",filterable:"",multiple:"","collapse-tags":"",disabled:null!=e.timer},on:{change:e.onChangeListingState},model:{value:e.listingState,callback:function(t){e.listingState=t},expression:"listingState"}},e._l(e.listingStateList,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1),t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:30,disabled:null!=e.timer},model:{value:e.timeOut,callback:function(t){e.timeOut=t},expression:"timeOut"}}),t("span",{staticStyle:{"margin-left":"3px"}},[e._v(e._s(e.$t("h.second")))]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success",size:"mini",disabled:null!=e.timer},on:{click:e.saveCheckResult}},[e._v(e._s(e.$t("h.saveBtn")+e.$t("h.inventoryResults")))])],1),t("div",{staticClass:"content"},[t("el-tabs",{on:{"tab-click":e.assetTabsClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$t("h.title134"),name:"not"}},[t("div",{staticClass:"table"},[t("ds-table",{ref:"notTableRef",attrs:{rowKey:e=>e._id,loading:e.oneKeyLoading,tableConfig:{},columns:e.columns,tableData:e.notAssets}})],1),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.notTotal,page:e.notPaginationForm.currentPage,limit:e.notPaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.notPaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.notPaginationForm,"pageSize",t)},pagination:e.getNotAssets}})],1)]),t("el-tab-pane",{attrs:{label:e.$t("h.title135"),name:"then"}},[t("div",{staticClass:"table"},[t("ds-table",{ref:"thenTableRef",attrs:{rowKey:e=>e._id,loading:e.oneKeyLoading,tableConfig:{},columns:e.columns,tableData:e.thenAssets}})],1),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.thenTotal,page:e.thenPaginationForm.currentPage,limit:e.thenPaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.thenPaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.thenPaginationForm,"pageSize",t)},pagination:e.getThenAssets}})],1)]),t("el-tab-pane",{attrs:{label:e.$t("h.title136"),name:"other"}},[t("div",{staticClass:"table"},[t("ds-table",{ref:"otherTableRef",attrs:{loading:e.oneKeyLoading,tableConfig:{},columns:e.columns,tableData:e.otherAssets}})],1),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.otherTotal,page:e.otherPaginationForm.currentPage,limit:e.otherPaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.otherPaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.otherPaginationForm,"pageSize",t)},pagination:e.getOtherAssets}})],1)])],1)],1)])]),t("el-dialog",{attrs:{top:"0","custom-class":"formDialog","show-close":!1,visible:e.formDialogVisible},on:{"update:visible":function(t){e.formDialogVisible=t},opened:e.formDialogVisibleOpened,closed:e.formDialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.$t("h.inventoryResults")+e.$t("h.saveBtn")))]),t("span",{staticClass:"tips"},[t("i",{staticClass:"el-icon-info"}),e._v(" "+e._s(e.$t("h.tips240")))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.formDialogVisible=!1}}})])]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.checkLoading,expression:"checkLoading"}],staticClass:"dialog-body"},[t("div",{staticClass:"form"},[t("el-form",{ref:"checkFormRef",attrs:{"label-width":"100px",model:e.checkForm,rules:e.checkFormRules}},[t("el-form-item",{attrs:{label:e.$t("h.stocktakingSheetName"),prop:"queryName"}},[t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.stocktakingSheetName")},model:{value:e.checkForm.queryName,callback:function(t){e.$set(e.checkForm,"queryName",t)},expression:"checkForm.queryName"}})],1),t("el-form-item",{attrs:{label:e.$t("h.creationTime"),prop:"createDate"}},[t("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.creationTime")},model:{value:e.checkForm.createDate,callback:function(t){e.$set(e.checkForm,"createDate",t)},expression:"checkForm.createDate"}})],1),t("el-form-item",{attrs:{label:e.$t("h.completionTime"),prop:"completeDate"}},[t("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.completionTime")},model:{value:e.checkForm.completeDate,callback:function(t){e.$set(e.checkForm,"completeDate",t)},expression:"checkForm.completeDate"}})],1)],1)],1),t("div",{staticClass:"btns"},[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.formDialogVisible=!1}}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitCheckForm}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)])])],1)},s=[],l=(i(57658),i(60983)),n=i(93082),o=i(66403),r=i(19698),h=i(52086),c=i(92003),d=i(89782),u=i(42041),m=i(98884),g=i(95641),p=i(5048),f=i(20629),b=i(76080),$=i(83151),v=i(79992),y=i(84105),k={components:{DsTable:l.Z,DsPagination:n.Z,DsSearchBtn:o.Z,DsQueryForm:r.Z,DsSelectTree:h.Z,DsQueryFormLeftPanel:c.Z,DsQueryFormRightPanel:d.Z,NewBillsDialog:u.Z,DsDeleteDetail:m.Z,ReadExcelFile:g.Z,UploadExcelFile:p.Z},data(){return{andLike:"",total:0,paginationForm:{currentPage:1,pageSize:20},loading:!1,billsTableConfig:{selection:!0,reserveSelection:!0},billsColums:$.uN,areaBills:[],selectAreaBills:[],newBillsDialogVisible:!1,newBillTitle:this.$t("h.title96"),dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},areaForm:{code:null,wareHouseId:"",wareHouseName:""},areaFormRules:{wareHouseName:[{required:!0,message:this.$t("h.tips3")+this.$t("h.areaName2"),trigger:"blur"}]},deleteDialogVisible:!1,deleteColumns:$.Wg,deleteErrorData:[],readDialogVisible:!1,file:{value:"",name:""},setp:"upload",percentage:0,errorText:"",readLoading:!1,mapKey:{"区域编码（必填）":"code","区域名称（必填）":"warehouseName"},oneKeyDialogVisible:!1,listingStateList:$.Fn,listingState:[],equiments:[],usedAnts:[],onekeyWareId:null,equimentOption:null,timeOut:30,ip:"http://127.0.0.1:7788",oneKeyLoading:!1,activeName:"not",notTotal:0,baseNotTotal:0,notPaginationForm:{currentPage:1,pageSize:20},notAssets:[],thenTotal:0,thenPaginationForm:{currentPage:1,pageSize:20},thenAssets:[],otherTotal:0,otherPaginationForm:{currentPage:1,pageSize:20},otherAssets:[],timer:null,allEPC:[],formDialogVisible:!1,checkLoading:!1,checkForm:{queryName:"",createDate:(0,v.X$)(),completeDate:(0,v.X$)()},checkFormRules:{queryName:[{required:!0,message:this.$t("h.tips3")+this.$t("h.stocktakingSheetName"),trigger:"blur"}],createDate:[{required:!0,message:this.$t("h.tips4")+this.$t("h.creationTime"),trigger:"change"}],completeDate:[{required:!0,message:this.$t("h.tips4")+this.$t("h.completionTime"),trigger:"change"}]}}},computed:{...(0,f.rn)(["userInfo","assetTableHeader","stateListData"]),isDeleteDisabled(){return!this.selectAreaBills.length},columns(){let e=[];return this.assetTableHeader.forEach((t=>{t.show&&("photo"==t.attr?e.push({type:"image",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label)}):"goalQuota"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label),showOverflowTooltip:!0,formatter:e=>100*e[t.attr]+"%"}):"file"==t.attr?e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label),slotName:"file"}):"assetCode"==t.attr?e.push({type:"detail",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label),showOverflowTooltip:!0}):"state"==t.attr?e.push({type:"assetState",prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label),formatter:e=>-1==e[t.attr]?this.$t("h.title137"):this.stateListData.find((i=>i._id==e[t.attr])).label}):e.push({prop:t.attr,label:t.label,fixed:t.fixed,width:(0,v.Uh)(t.label),showOverflowTooltip:!0}))})),e.push({prop:"printSize",label:this.$t("h.title57"),fixed:"right",showOverflowTooltip:!0,width:(0,v.Uh)(this.$t("h.title57"))}),e}},methods:{getAreaBills(){this.loading=!0,(0,b.Ys)({func:"S0003",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,andLike:this.andLike}}).then((({data:e})=>{if(this.loading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.areaBills=e.data[1]})).catch((()=>(this.loading=!1,this.$message.error(this.$t("h.tips18")))))},findAssetSearch(){this.paginationForm.currentPage=1,this.getAreaBills()},handleSelectionChange(e){this.selectAreaBills=e},editAreaForm(e){this.areaForm.wareHouseId=e._id,this.areaForm.code=e.code,this.areaForm.wareHouseName=e.warehouseName,this.newBillTitle=this.$t("h.title97"),this.newBillsDialogVisible=!0},deleteAreaForm(e){this.$confirm(this.$t("h.tips161"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{this.loading=!0,(0,b.SR)({func:"D0002",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:e._id,permissonId:57}}).then((({data:e})=>{if(0!=e.code)return this.loading=!1,this.$message.error(e.data);let t=Math.ceil((this.total-1)/this.paginationForm.pageSize),i=this.paginationForm.currentPage>t?t:this.paginationForm.currentPage;this.paginationForm.currentPage=i<1?1:i,this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),this.getAreaBills(),this.$message.success(this.$t("h.tips128"))})).catch((()=>{this.loading=!1,this.$message.error(this.$t("h.tips18"))}))})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips98")})}))},deleteDialogVisibleClosed(){this.deleteErrorData=[]},async deleteAreas(){if(!this.selectAreaBills.length)return this.$message.error(this.$t("h.tips98"));const e=await this.$confirm(this.$t("h.tips163"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).catch((e=>e));if("cancel"===e)return this.$message.info(this.$t("h.tips98"));this.loading=!0,this.deleteErrorData=[],this.multiDeleteArea(0)},multiDeleteArea(e){if(e>this.selectAreaBills.length-1)return this.paginationForm.currentPage=1,this.getAreaBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.deleteErrorData.length?this.deleteDialogVisible=!0:this.$message.success(this.$t("h.tips164")));(0,b.SR)({func:"D0002",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.selectAreaBills[e]._id,permissonId:24}}).then((({data:t})=>{0!=t.code&&this.deleteErrorData.push({code:this.selectAreaBills[e].code,name:this.selectAreaBills[e].warehouseName,reason:t.data}),this.multiDeleteArea(++e)})).catch((()=>{this.deleteErrorData.push({code:this.selectAreaBills[e].code,name:this.selectAreaBills[e].warehouseName,reason:this.$t("h.tips18")}),this.multiDeleteArea(++e)}))},newBillsDialogOpened(){this.$refs.areaFormRef.clearValidate()},newBillsDialogClose(){this.areaForm.wareHouseId="",this.areaForm.code=null,this.areaForm.wareHouseName="",this.newBillTitle=this.$t("h.title96")},sbumitAreaForm(){this.$refs.areaFormRef.validate((e=>{if(!e)return!1;const t=this.$loading(this.dialogLoading);let i=""==this.areaForm.wareHouseId?56:58;(0,b.Vx)({func:"U0003",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.areaForm.wareHouseId,code:this.areaForm.code,warehouseName:this.areaForm.wareHouseName,permissonId:i}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.newBillsDialogVisible=!1,this.getAreaBills(),this.$message.success(e.data)})).catch((()=>{t.close(),this.$message.error(this.$t("h.tips18"))}))}))},readDialogVisibleClosed(){this.file.value="",this.file.name="",this.setp="upload",this.percentage=0,this.errorText=""},downloadImportFile(){(0,v.M)(window.$EXCEL_URL+`${this.$t("h.assetTemplate3")}.xlsx`)},readDialogVisibleSubmit(){if(!this.file.value)return this.$notify.error({title:this.$t("h.title18"),message:this.$t("h.title93")});this.readExcel()},readExcel(){this.readLoading=!0;const e=new FileReader;e.onload=e=>{try{const t=e.target.result,i=y.ij(t,{type:"binary",cellDates:!1}),a=i.SheetNames[0],s=y.P6.sheet_to_json(i.Sheets[a]).splice(1);if(!s.length)return this.readLoading=!1,this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips131")});let l=[];for(let e=0;e<s.length;e++){let t={};for(let i in s[e])t[this.mapKey[i]]=s[e][i];l.push(t)}this.readLoading=!1,this.setp="loading",this.percentage=50,(0,b.Vx)({func:"U0059",userId:this.userInfo._id,token:this.userInfo.token,requstData:{item:l,permissonId:56}}).then((({data:e})=>{if(this.percentage=100,0!=e.code)return this.setp="result",void(this.errorText=e.data);this.setp="result",this.getAreaBills()})).catch((()=>{this.percentage=100,this.setp="result",this.errorText=this.$t("h.tips18")}))}catch(t){this.readLoading=!1,this.$notify({title:this.$t("h.title27"),message:this.$t("h.tips156")})}},e.readAsBinaryString(this.file.value)},oneKeyCheck(e){this.equiments=e.equiments.filter((e=>1==e.type)),this.onekeyWareId=e._id,this.oneKeyDialogVisible=!0,this.getNotAssets()},onChangePDT(e){e&&(this.usedAnts=this.areaBills.find((e=>e._id==this.onekeyWareId)).eaw.find((t=>t.equipmentId==e.equipment_id)).ant.split("").reverse().map(((e,t)=>1==e?t+1:-1)).filter((e=>-1!==e)))},assetTabsClick(e,t){"not"==e.name?this.getNotAssets():"then"==e.name?this.getThenAssets():"other"==e.name&&this.getOtherAssets()},getNotAssets(){let e=[{key:"warehouseId",handle:"OIS",value:this.onekeyWareId}];this.listingState.length&&e.push({key:"listingState",handle:"OIS",value:this.listingState.join(",")}),this.allEPC.forEach((t=>{e.push({key:"code",handle:"NIS",value:t})})),(0,b.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.notPaginationForm.pageSize,index:this.notPaginationForm.currentPage,item:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.notTotal=e.data[0],this.notAssets=this.setTableCostomKey(e.data[1])})).catch((()=>{}))},getThenAssets(){let e=[{key:"code",handle:"OIS",value:this.allEPC.join(",")},{key:"warehouseId",handle:"OIS",value:this.onekeyWareId}];this.listingState.length&&e.push({key:"listingState",handle:"OIS",value:this.listingState.join(",")}),(0,b.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.thenPaginationForm.pageSize,index:this.thenPaginationForm.currentPage,item:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.thenTotal=e.data[0],this.thenAssets=this.setTableCostomKey(e.data[1])})).catch((()=>{}))},getOtherAssets(){let e=[{key:"code",handle:"OIS",value:this.allEPC.join(",")},{key:"warehouseId",handle:"NIS",value:this.onekeyWareId}];this.listingState.length&&e.push({key:"listingState",handle:"NIS",value:this.listingState.join(",")}),(0,b.Ys)({func:"S0007",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.otherPaginationForm.pageSize,index:this.otherPaginationForm.currentPage,item:e}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.otherTotal=e.data[0],this.otherAssets=this.setTableCostomKey(e.data[1])})).catch((()=>{}))},onChangeListingState(){"not"==this.activeName?this.getNotAssets():"then"==this.activeName?this.getThenAssets():"other"==this.activeName&&this.getOtherAssets()},setTableCostomKey(e){return e.forEach((e=>{for(let t in e["jsons"])e[t]=e["jsons"][t];e.company=window.sessionStorage.getItem("loginCompanyName")})),e},oneKeyDialogVisibleClosed(){this.onekeyWareId=null,this.equiments=[],this.usedAnts=[],this.timeOut=30,this.equimentOption=null,this.ip="http://127.0.0.1:7788",this.activeName="not",this.notTotal=0,this.thenTotal=0,this.otherTotal=0,this.notPaginationForm.currentPage=1,this.thenPaginationForm.currentPage=1,this.otherPaginationForm.currentPage=1,this.notAssets=[],this.thenAssets=[],this.otherAssets=[],this.timer=null,this.allEPC=[],this.listingState=[]},startOneKeyCheck(){return this.equimentOption?""==this.ip?this.$message.error(this.$t("h.tips242")):(this.notTotal=0,this.thenTotal=0,this.otherTotal=0,this.notPaginationForm.currentPage=1,this.thenPaginationForm.currentPage=1,this.otherPaginationForm.currentPage=1,this.notAssets=[],this.thenAssets=[],this.otherAssets=[],this.allEPC=[],this.getNotAssets(),void(0,b.EQ)({rfidIp:this.equimentOption.ip,rfidRegion:"NA",power:30,antnum:this.equimentOption.antLength,usedAnts:this.usedAnts,readingDuration:this.timeOut},this.ip+"/Service?sendCode=4&param=1").then((({data:e})=>{if(0!=e.code)return this.$message.error(e.message);this.$message.success(e.message),this.startRequest()})).catch((()=>{this.$message.error(this.$t("h.tips232"))}))):this.$message.error(this.$t("h.tips241"))},endCheck(){(0,b.Y$)({rfidIp:this.equimentOption.ip},this.ip+"/Service?sendCode=4&param=4").then((({data:e})=>{console.log(e)})).catch((()=>{}))},startRequest(){this.timer&&(clearInterval(this.timer),this.timer=null);let e=this.timeOut;this.timer=setInterval((()=>{this.makeRequest(),e-=5,e<0&&(clearInterval(this.timer),this.timer=null)}),5e3)},makeRequest(){(0,b.nr)({rfidIp:this.equimentOption.ip,needNew:!0},this.ip+"/Service?sendCode=4&param=2").then((({data:e})=>{0!=e.code&&(clearInterval(this.timer),this.timer=null,this.$message.error(e.data)),e.state||(clearInterval(this.timer),this.timer=null),e.message.length&&(this.allEPC=[...this.allEPC,...e.message],"not"==this.activeName?this.getNotAssets():"then"==this.activeName?this.getThenAssets():"other"==this.activeName&&this.getOtherAssets())})).catch((()=>{clearInterval(this.timer),this.timer=null,this.$message.error(this.$t("h.tips18"))}))},oneKeyDialogBeforeClose(e){if(null==this.timer)return e();this.$confirm(this.$t("h.tips243")).then((t=>{e(),clearInterval(this.timer),this.timer=null})).catch((e=>{}))},saveCheckResult(){this.allEPC.length?this.formDialogVisible=!0:this.$confirm(this.$t("h.tips244")).then((e=>{this.formDialogVisible=!0})).catch((e=>{}))},formDialogVisibleOpened(){this.$refs.checkFormRef.clearValidate()},formDialogVisibleClosed(){this.checkForm.createDate="",this.checkForm.completeDate="",this.checkForm.queryName=""},submitCheckForm(){this.$refs.checkFormRef.validate((e=>{if(!e)return!1;this.checkLoading=!0,(0,b.Vx)({func:"U0085",userId:this.userInfo._id,token:this.userInfo.token,requstData:{warehouseId:this.onekeyWareId,epc:this.allEPC.join(","),createDate:this.checkForm.createDate,completeDate:this.checkForm.completeDate,queryName:this.checkForm.queryName,staffId:this.userInfo.staffId,staffName:this.userInfo.staffName,listingState:this.listingState.join(","),permissonId:44}}).then((({data:e})=>{if(this.checkLoading=!1,0!=e.code)return this.$message.error(e.data);this.$message.success(this.$t("h.tips245")),this.formDialogVisible=!1,this.oneKeyDialogVisible=!1})).catch((()=>{this.checkLoading=!1,this.$message.error(this.$t("h.tips18"))}))}))}},created(){this.getAreaBills();let e=[this.$t("h.fileDownload8"),this.$t("h.fileDownload9")];const t=[];for(var i in this.mapKey)t.push(i);let a=JSON.stringify(this.mapKey);for(let s=0;s<e.length;s++)a=a.replace(t[s],e[s]);this.mapKey=JSON.parse(a)}},D=k,C=i(1001),F=(0,C.Z)(D,a,s,!1,null,"0750c166",null),w=F.exports}}]);