"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[2682],{77243:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ConTransfer"},[t("el-card",{staticClass:"card"},[t("div",{staticClass:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.newBillsDialogVisible=!0}}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-dropdown",{attrs:{trigger:"click",disabled:e.isEditDisable},on:{command:e.editingOperations}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.editBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"modify"}},[e._v(e._s(e.$t("h.changeBtn")))]),t("el-dropdown-item",{attrs:{command:"delete"}},[e._v(e._s(e.$t("h.delBtn")))])],1)],1),t("el-button",{attrs:{type:"primary",size:"small",disabled:e.isEditDisable},on:{click:e.confirmConTransferDocuments}},[e._v(e._s(e.$t("h.confirmBtn")))]),t("el-dropdown",{staticStyle:{"margin-left":"0px"},attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(e._s(e.$t("h.formTips5"))+" "),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.goPrintBills.apply(null,arguments)}}},[e._v(e._s(e.$t("h.printBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.openPrintSet.apply(null,arguments)}}},[e._v(e._s(e.$t("h.tempSetBtn")))])],1)],1),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.exportFile}},[e._v(e._s(e.$t("h.exportBtn")))])],1),t("ds-query-form-right-panel",[t("ds-search-btn",{attrs:{searchValue:e.andLike},on:{"update:searchValue":function(t){e.andLike=t},"update:search-value":function(t){e.andLike=t},search:e.bodySearch}})],1)],1),t("div",{staticClass:"screen"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("ds-filter-tag",{attrs:{filterTagsData:e.highFilterTags},on:{handleCloseTag:e.handleCloseFilterTag}})],1),t("ds-query-form-right-panel",[t("span",{staticClass:"advancedSearch",on:{click:function(t){e.bodyFilteringVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])])],1)],1),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{contentWidth:"55%",title:e.$t("h.title168"),newBillsDialogVisible:e.newBillsDialogVisible,look:e.look,warning:e.warning},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},sbumitForm:e.conTransfer,close:e.bulkBillsDialogClose}},[t("template",{slot:"form"},[e.warning?t("p",{staticClass:"warning"},[e._v(" "+e._s(e.$t("h.formTips54"))+e._s(e.warningTitle)+e._s(e.$t("h.title169"))+" ")]):e._e(),t("el-row",{attrs:{gutter:45}},[t("el-form",{ref:"conTransferFillInDataRef",attrs:{"label-width":"80px",model:e.conTransferFillInData,rules:e.conTransferFillInDataRules,disabled:e.look}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.title173"),prop:"roleRule"}},[t("el-input",{attrs:{disabled:""},model:{value:e.conTransferFillInData.roleRule,callback:function(t){e.$set(e.conTransferFillInData,"roleRule",t)},expression:"conTransferFillInData.roleRule"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips64"),prop:"outHouseId"}},[t("el-cascader",{attrs:{options:e.warehouseData,props:{checkStrictly:!0},"show-all-levels":!1},model:{value:e.conTransferFillInData.outHouseId,callback:function(t){e.$set(e.conTransferFillInData,"outHouseId",t)},expression:"conTransferFillInData.outHouseId"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.transferDate"),prop:"useDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:e.$t("h.tips4")+e.$t("h.transferDate"),clearable:"","value-format":"yyyy-MM-dd"},model:{value:e.conTransferFillInData.useDate,callback:function(t){e.$set(e.conTransferFillInData,"useDate",t)},expression:"conTransferFillInData.useDate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips65"),prop:"inHouseId"}},[t("el-cascader",{attrs:{options:e.warehouseData,props:{checkStrictly:!0},"show-all-levels":!1},model:{value:e.conTransferFillInData.inHouseId,callback:function(t){e.$set(e.conTransferFillInData,"inHouseId",t)},expression:"conTransferFillInData.inHouseId"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips66"),prop:"useStaff"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.formTips66")},model:{value:e.conTransferFillInData.useStaff,callback:function(t){e.$set(e.conTransferFillInData,"useStaff",t)},expression:"conTransferFillInData.useStaff"}},e._l(e.employeeData,(function(e){return t("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips67"),prop:"staffName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.conTransferFillInData.staffName,callback:function(t){e.$set(e.conTransferFillInData,"staffName",t)},expression:"conTransferFillInData.staffName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips68"),prop:"createDate"}},[t("el-date-picker",{attrs:{disabled:"",type:"date"},model:{value:e.conTransferFillInData.createDate,callback:function(t){e.$set(e.conTransferFillInData,"createDate",t)},expression:"conTransferFillInData.createDate"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("h.formTips69"),prop:"remark"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:e.$t("h.tips3")+e.$t("h.formTips69")},model:{value:e.conTransferFillInData.remark,callback:function(t){e.$set(e.conTransferFillInData,"remark",t)},expression:"conTransferFillInData.remark"}})],1)],1)],1)],1)],1),t("template",{slot:"btns"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("span",{staticClass:"advancedSearch"},[e._v(e._s(e.$t("h.title170"))+" - "+e._s(e.$t("h.title147")))])]),t("ds-query-form-right-panel",[e.look?e._e():t("el-button",{attrs:{size:"small",type:"primary",disabled:e.warning},on:{click:function(t){e.articleDialogVisible=!0}}},[e._v(e._s(e.$t("h.title171")))]),e.look?e._e():t("el-button",{attrs:{size:"small",type:"primary",disabled:e.warning},on:{click:e.deleteArticleDetailsSelete}},[e._v(e._s(e.$t("h.title172")))])],1)],1)],1),t("template",{slot:"table"},[t("div",{staticClass:"bill-table"},[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.articleDetailsData,height:"400"},on:{"selection-change":e.articleDetailsSelete}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._l(e.newArticleDetailsColumns,(function(a,i){return t("el-table-column",{directives:[{name:"show",rawName:"v-show",value:a.label==e.$t("h.action"),expression:"column.label == $t('h.action')"}],key:i,attrs:{label:a.label,prop:a.prop,width:a.width||"",align:"center",fixed:a.fixed},scopedSlots:e._u([{key:"default",fn:function(i){return["image"==a.type?t("div",{staticClass:"table-image-cell"},[i.row[a.prop]?t("el-image",{attrs:{src:i.row[a.prop],"preview-src-list":[i.row[a.prop]]}}):t("div",{staticClass:"no-image"},[t("span",[e._v(e._s(e.$t("h.title51")))])])],1):e.look||"amount"!=a.slotName?e.look||"remark"!=a.slotName?t("div",{staticClass:"show-tooltip"},[t("span",[e._v(e._s(a.formatter?a.formatter(i.row,i.column):i.row[a.prop]))])]):[t("el-input",{model:{value:i.row[a.prop],callback:function(t){e.$set(i.row,a.prop,t)},expression:"scope.row[column.prop]"}})]:[t("el-input-number",{staticClass:"small-input",attrs:{"controls-position":"right",min:1},on:{change:function(t){return e.changeMoney(i.$index,i.row)}},model:{value:i.row[a.prop],callback:function(t){e.$set(i.row,a.prop,t)},expression:"scope.row[column.prop]"}})]]}}],null,!0)},[t("template",{slot:"header"},[t("span",{class:a.prop},[e._v(e._s(a.label))])])],2)}))],2)],1)])],2),t("el-dialog",{staticClass:"dialog-select-article",attrs:{title:"选择物品",visible:e.articleDialogVisible,width:"60%","before-close":e.articleDialogVisibleClose},on:{"update:visible":function(t){e.articleDialogVisible=t}}},[t("div",{staticClass:"dialog-body"},[e.subMenuList?t("el-tree",{staticClass:"el-menu-vertical-demo",attrs:{data:e.subMenuList,props:e.subMenuListProps,"highlight-current":"","node-key":"sortingId","current-node-key":"1","default-expanded-keys":["1"]},on:{"node-click":e.sortingDataSwitching},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("span",{},[t("span",{staticClass:"icon"},[null==i.children?[t("svg-icon",{staticClass:"childIcon",attrs:{"icon-file-name":"childGb"}})]:[t("svg-icon",{staticClass:"parentIcon",attrs:{"icon-file-name":"gb"}})]],2),t("span",{staticClass:"text",staticStyle:{"font-size":"14px"}},[e._v(" "+e._s(a.label)+" ")])])}}],null,!1,1594426155)}):e._e(),t("div",{staticClass:"right"},[t("div",{staticClass:"top"},[t("ds-search-btn",{attrs:{searchValue:e.articleAndLike},on:{"update:searchValue":function(t){e.articleAndLike=t},"update:search-value":function(t){e.articleAndLike=t},search:e.articleSearch}})],1),t("div",{staticClass:"screen"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("ds-filter-tag",{attrs:{filterTagsData:e.articleHighFilterTags},on:{handleCloseTag:e.articleHandleCloseFilterTag}})],1),t("ds-query-form-right-panel",[t("span",{staticClass:"advancedSearch",on:{click:function(t){e.addFilteringVisible=!0}}},[e._v(e._s(e.$t("h.advancedBtn")))])])],1)],1),t("el-table",{ref:"articleData",staticClass:"articleTable",attrs:{data:e.articleDataDisplay,height:"51.5vh"},on:{"selection-change":e.articleSelete}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._l(e.newArticleColumns,(function(a,i){return t("el-table-column",{key:i,attrs:{label:a.label,prop:a.prop,width:a.width||"",align:"center",fixed:a.fixed},scopedSlots:e._u([{key:"default",fn:function(i){return["image"==a.type?t("div",{staticClass:"table-image-cell"},[i.row[a.prop]?t("el-image",{attrs:{src:i.row[a.prop],"preview-src-list":[i.row[a.prop]]}}):t("div",{staticClass:"no-image"},[t("span",[e._v(e._s(e.$t("h.title51")))])])],1):t("div",{staticClass:"show-tooltip"},[t("span",[e._v(e._s(a.formatter?a.formatter(i.row,i.column):i.row[a.prop]))])])]}}],null,!0)})}))],2),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.articleTotal,page:e.articlePaginationForm.currentPage,limit:e.articlePaginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.articlePaginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.articlePaginationForm,"pageSize",t)},pagination:e.articleChangeSizePage}})],1)],1)],1),t("span",{staticClass:"footer-span",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:e.outArticleDialog}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.determineItemSelection}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)]),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.addFilteringVisible,modal:!1},on:{"update:filterDrawerVisible":function(t){e.addFilteringVisible=t},"update:filter-drawer-visible":function(t){e.addFilteringVisible=t},resetFilterForm:e.resetArticleFilterForm,submitFilterForm:e.submitArticleFilterForm}},[t("el-form",{ref:"advancedFiltering",attrs:{model:e.advancedFiltering,"label-width":"80px"}},[t("el-form-item",{attrs:{label:e.$t("h.price"),prop:"minPrice"}},[t("div",{staticClass:"inp-box"},[t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips72"),type:"number",min:"0"},on:{change:e.changeMinPrice},model:{value:e.advancedFiltering.minPrice,callback:function(t){e.$set(e.advancedFiltering,"minPrice",t)},expression:"advancedFiltering.minPrice"}}),e._v("    -     "),t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips73"),type:"number"},on:{change:e.changeMaxPrice},model:{value:e.advancedFiltering.maxPrice,callback:function(t){e.$set(e.advancedFiltering,"maxPrice",t)},expression:"advancedFiltering.maxPrice"}})],1)]),t("el-form-item",{attrs:{label:e.$t("h.formTips70"),prop:"minUpperSize"}},[t("div",{staticClass:"inp-box"},[t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips72"),type:"number",min:"0"},on:{change:e.changeMinUpperSize},model:{value:e.advancedFiltering.minUpperSize,callback:function(t){e.$set(e.advancedFiltering,"minUpperSize",t)},expression:"advancedFiltering.minUpperSize"}}),e._v("    -     "),t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips73"),type:"number"},on:{change:e.changeMaxUpperSize},model:{value:e.advancedFiltering.maxUpperSize,callback:function(t){e.$set(e.advancedFiltering,"maxUpperSize",t)},expression:"advancedFiltering.maxUpperSize"}})],1)]),t("el-form-item",{attrs:{label:e.$t("h.formTips71"),prop:"minLowerSize"}},[t("div",{staticClass:"inp-box"},[t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips72"),type:"number",min:"0"},on:{change:e.changeMinLowerSize},model:{value:e.advancedFiltering.minLowerSize,callback:function(t){e.$set(e.advancedFiltering,"minLowerSize",t)},expression:"advancedFiltering.minLowerSize"}}),e._v("    -     "),t("el-input",{staticClass:"input-small",attrs:{placeholder:e.$t("h.formTips73"),type:"number"},on:{change:e.changeMaxLowerSize},model:{value:e.advancedFiltering.maxLowerSize,callback:function(t){e.$set(e.advancedFiltering,"maxLowerSize",t)},expression:"advancedFiltering.maxLowerSize"}})],1)]),t("el-form-item",{attrs:{label:e.$t("h.fuzzyQuery"),prop:"andLike"}},[t("el-input",{model:{value:e.advancedFiltering.andLike,callback:function(t){e.$set(e.advancedFiltering,"andLike",t)},expression:"advancedFiltering.andLike"}})],1)],1)],1)],1),t("div",{staticClass:"body"},[t("ds-table",{ref:"assetTableDataDisplay",attrs:{loading:e.tableLoading,tableData:e.assetTableDataDisplay,tableConfig:e.assetTableConfig,columns:e.columns,rowKey:e=>e.roleRule,onlyKey:"roleRule"},on:{handleSelectionChange:e.bodySelete},scopedSlots:e._u([{key:"roleRule",fn:function({scope:a}){return[t("p",{staticClass:"inventory-name",on:{click:function(t){return e.lookDetails(a.row)}}},[e._v(" "+e._s(a.row.roleRule)+" ")])]}}])}),t("div",{staticClass:"pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.changeSizePage}})],1)],1),t("ds-filter-drawer",{attrs:{filterDrawerVisible:e.bodyFilteringVisible},on:{"update:filterDrawerVisible":function(t){e.bodyFilteringVisible=t},"update:filter-drawer-visible":function(t){e.bodyFilteringVisible=t},resetFilterForm:e.resetBodyFilterForm,submitFilterForm:e.submitBodyFilterForm}},[t("el-form",{ref:"bodyFiltering",attrs:{model:e.bodyFiltering,"label-width":"80px"}},[t("el-form-item",{attrs:{label:e.$t("h.state"),prop:"status"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.state")},model:{value:e.bodyFiltering.status,callback:function(t){e.$set(e.bodyFiltering,"status",t)},expression:"bodyFiltering.status"}},[t("el-option",{attrs:{label:e.$t("h.approved"),value:"0"}}),t("el-option",{attrs:{label:e.$t("h.pending"),value:"1"}}),t("el-option",{attrs:{label:e.$t("h.rejectBtn"),value:"2"}}),t("el-option",{attrs:{label:e.$t("h.draft"),value:"3"}})],1)],1),t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffId"}},[t("el-select",{attrs:{multiple:"",placeholder:e.$t("h.tips4")},model:{value:e.bodyFiltering.staffId,callback:function(t){e.$set(e.bodyFiltering,"staffId",t)},expression:"bodyFiltering.staffId"}},e._l(e.employeeData,(function(e){return t("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)],1),t("el-form-item",{attrs:{label:e.$t("h.creationTime"),prop:"createDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",placeholder:e.$t("h.tips4")+e.$t("h.creationTime"),clearable:"","start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate"),"value-format":"yyyy-MM-dd"},model:{value:e.bodyFiltering.createDate,callback:function(t){e.$set(e.bodyFiltering,"createDate",t)},expression:"bodyFiltering.createDate"}})],1),t("el-form-item",{attrs:{label:e.$t("h.formTips74"),prop:"useDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",placeholder:e.$t("h.tips4")+e.$t("h.formTips74"),clearable:"","start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate"),"value-format":"yyyy-MM-dd"},model:{value:e.bodyFiltering.useDate,callback:function(t){e.$set(e.bodyFiltering,"useDate",t)},expression:"bodyFiltering.useDate"}})],1),t("el-form-item",{attrs:{label:e.$t("h.formTips65"),prop:"inHouseId"}},[t("el-cascader",{attrs:{options:e.warehouseData,props:{checkStrictly:!0},"show-all-levels":!1},model:{value:e.bodyFiltering.inHouseId,callback:function(t){e.$set(e.bodyFiltering,"inHouseId",t)},expression:"bodyFiltering.inHouseId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.formTips64"),prop:"outHouseId"}},[t("el-cascader",{attrs:{options:e.warehouseData,props:{checkStrictly:!0},"show-all-levels":!1},model:{value:e.bodyFiltering.outHouseId,callback:function(t){e.$set(e.bodyFiltering,"outHouseId",t)},expression:"bodyFiltering.outHouseId"}})],1),t("el-form-item",{attrs:{label:e.$t("h.fuzzyQuery"),prop:"andLike"}},[t("el-input",{model:{value:e.bodyFiltering.andLike,callback:function(t){e.$set(e.bodyFiltering,"andLike",t)},expression:"bodyFiltering.andLike"}})],1)],1)],1),t("bill-print-template",{ref:"vptRef",attrs:{title:`${e.$t("h.formTips75")}`,selectId:e.conTransferTemplateId,voucherPrintTempList:e.billPrintTemplate}}),t("kc-bill-print-dialog",{ref:"vpdRef",attrs:{locationName:"conTransferTemplateId",userInfo:e.userInfo,voucherData:e.assetTableSelectData,voucherPrintTemplate:e.billPrintTemplate}})],1)],1)},s=[],r=(a(57658),a(30541),a(19698)),l=a(92003),n=a(89782),o=a(66403),h=a(60983),c=a(42041),d=a(5791),u=a(93082),m=a(17817),g=a(93390),p=a(17386),f=a(79992),D=a(83151),b=a(76080),F=a(20629),I={components:{DsQueryForm:r.Z,DsQueryFormLeftPanel:l.Z,DsQueryFormRightPanel:n.Z,DsSearchBtn:o.Z,DsTable:h.Z,NewBillsDialog:c.Z,DsFilterDrawer:d.Z,DsPagination:u.Z,DsFilterTag:m.Z,BillPrintTemplate:g.Z,KcBillPrintDialog:p.Z},data(){return{conTransferTemplateId:"",billPrintTemplate:[],userId:"",token:"",staffId:"",warning:!1,warningTitle:"",employeeData:[],deptId:"",isConTransfer:0,look:!1,isEditDisable:!0,andLike:"",tableLoading:!1,assetTableData:[],columns:D.ol,assetTableConfig:{selection:!0},paginationForm:{currentPage:1,pageSize:20},assetTableSelectData:[],houseNameData:[],bodyFilteringVisible:!1,bodyFiltering:{status:"",staffId:"",createDate:"",useDate:"",outHouseId:[],inHouseId:[],andLike:""},highFilterTags:[],warehouseData:[],newBillsDialogVisible:!1,conTransferFillInData:{roleRule:"调拨单号",outHouseId:[],useDate:(0,f.X$)(),inHouseId:[],useStaff:"",staffName:JSON.parse(sessionStorage.getItem("vuex")).userInfo.staffName,createDate:(0,f.X$)(),remark:""},conTransferFillInDataRules:{useStaff:[{required:!0,message:this.$t("h.tips4")+this.$t("h.formTips66"),trigger:"change"}]},sourceListData:[],newArticleDetailsColumns:D.Ft,articleDetailsData:[],selectArticleDetailsData:[],articleDialogVisible:!1,subMenuList:[],subMenuListProps:{children:"children",label:"name"},newArticleColumns:D.ho,articleData:[],articleAndLike:"",selectArticleData:[],articlePaginationForm:{currentPage:1,pageSize:20},difference:"all",recordSortingData:[],waitFilesData:!1,addFilteringVisible:!1,advancedFiltering:{minPrice:"",maxPrice:"",minUpperSize:"",maxUpperSize:"",minLowerSize:"",maxLowerSize:"",andLike:""},articleHighFilterTags:[]}},computed:{...(0,F.rn)(["userInfo"]),articleDataDisplay(){let e=0,t=this.articlePaginationForm.pageSize-1,a=[];if(1==this.articlePaginationForm.currentPage)for(let i=e;i<t;i++)this.articleData[i]&&a.push(this.articleData[i]);else for(let i=t*(this.articlePaginationForm.currentPage-1);i<t*this.articlePaginationForm.currentPage;i++)this.articleData[i]&&a.push(this.articleData[i]);return a},articleTotal(){return this.articleData.length},assetTableDataDisplay(){let e=[],t=0,a=this.paginationForm.pageSize-1;if(1==this.paginationForm.currentPage)for(let i=t;i<a;i++)this.assetTableData[i]&&e.push(this.assetTableData[i]);else for(let i=a*(this.paginationForm.currentPage-1);i<a*this.paginationForm.currentPage;i++)this.assetTableData[i]&&e.push(this.assetTableData[i]);return e},total(){return this.assetTableData.length}},methods:{toggleSelection(e){e?e.forEach((e=>{this.$refs.articleData.toggleRowSelection(e)})):this.$refs.articleData.clearSelection()},goPrintBills(){return 0==this.assetTableSelectData.length?this.$message.error(this.$t("h.tips121")):this.assetTableSelectData.length>10?this.$message.error(this.$t("h.tips122")+10+this.$t("h.tips123")):void(this.$refs["vpdRef"].voucherPrintDialogVisible=!0)},openPrintSet(){this.$refs["vptRef"].printTempDialogVisible=!0},articleHandleCloseFilterTag(e){switch(this.waitFilesData=!0,this.difference="individual",e.keyStr){case"price":this.advancedFiltering.maxPrice="",this.advancedFiltering.minPrice="";break;case"upperSize":this.advancedFiltering.maxUpperSize="",this.advancedFiltering.minUpperSize="";break;case"lowerSize":this.advancedFiltering.maxLowerSize="",this.advancedFiltering.minLowerSize="";break;default:this.advancedFiltering.andLike=""}this.articleHighFilterTags.splice(this.articleHighFilterTags.indexOf(e),1);let t=[{key:"price",value:"",handle:""},{key:"upperSize",value:"",handle:""},{key:"lowerSize",value:"",handle:""},{key:"andLike",value:"",handle:""}];this.articleHighFilterTags.forEach((e=>{t.forEach((t=>{e.keyStr==t.key&&(t.value=e.value,t.handle=e.handle)}))})),t=t.filter((e=>{if(e.value)return e})),(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,params:t}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);e.data?(this.articleData=e.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),this.recordSortingData=JSON.parse(JSON.stringify(e.data))):this.articleData=[];let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500);this.markArticle()})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)}))},handleCloseFilterTag(e){switch(e.keyStr){case"andLike":this.bodyFiltering.andLike="";break;case"status":this.bodyFiltering.status="";break;case"createDate":this.bodyFiltering.createDate="";break;case"staffId":this.bodyFiltering.staffId="";break;case"outHouseId":this.bodyFiltering.outHouseId=[];break;case"inHouseId":this.bodyFiltering.inHouseId=[];break;default:this.bodyFiltering.useDate="";break}this.highFilterTags.splice(this.highFilterTags.indexOf(e),1);let t={andLike:"",status:"",createDate:"",staffId:"",outHouseId:"",inHouseId:"",useDate:""};this.highFilterTags.forEach((e=>{for(let a in t)e.keyStr==a&&(t[a]="status"==a||"staffId"==a||"outHouseId"==a||"inHouseId"==a?e.uploadValue:e.value)}));for(let a in t)""!=t[a]&&","!=t[a]||delete t[a];(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:t}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.assetTableData=e.data,this.assetTableData?this.assetTableData.forEach((e=>{"0"==e.status?e.statusName=this.$t("h.approved"):"1"==e.status?e.statusName=this.$t("h.pending"):"2"==e.status?e.statusName=this.$t("h.rejectBtn"):"3"==e.status&&(e.statusName=this.$t("h.draft"))})):this.assetTableData=[]})).catch((e=>{this.$message.error(e)}))},changeMaxLowerSize(e){if(""==this.advancedFiltering.minLowerSize.trim()&&""==e)return;let t=/^[0-9]+$/;if(!t.test(e))return this.advancedFiltering.maxLowerSize=(1*this.advancedFiltering.minLowerSize+1).toString(),this.$message.error(this.$t("h.tips255"));(""==this.advancedFiltering.maxLowerSize.trim()||Number(this.advancedFiltering.maxLowerSize)<=Number(this.advancedFiltering.minLowerSize))&&(this.advancedFiltering.maxLowerSize=(1*this.advancedFiltering.minLowerSize+1).toString())},changeMinLowerSize(e){if(""==this.advancedFiltering.maxLowerSize.trim()&&""==e)return;let t=/^[0-9]+$/;if(!t.test(e))return this.advancedFiltering.minLowerSize="0",this.$message.error(this.$t("h.tips255"));(""==this.advancedFiltering.maxLowerSize.trim()||Number(this.advancedFiltering.maxLowerSize)<Number(e))&&(this.advancedFiltering.maxLowerSize=(1*e+1).toString())},changeMaxUpperSize(e){if(""==this.advancedFiltering.minUpperSize.trim()&&""==e)return;let t=/^[0-9]+$/;if(!t.test(e))return this.advancedFiltering.maxUpperSize=(1*this.advancedFiltering.minUpperSize+1).toString(),this.$message.error(this.$t("h.tips255"));(""==this.advancedFiltering.maxUpperSize.trim()||Number(this.advancedFiltering.maxUpperSize)<=Number(this.advancedFiltering.minUpperSize))&&(this.advancedFiltering.maxUpperSize=(1*this.advancedFiltering.minUpperSize+1).toString())},changeMinUpperSize(e){if(""==this.advancedFiltering.maxUpperSize.trim()&&""==e)return;let t=/^[0-9]+$/;if(!t.test(e))return this.advancedFiltering.minUpperSize="0",this.$message.error(this.$t("h.tips255"));(""==this.advancedFiltering.maxUpperSize.trim()||Number(this.advancedFiltering.maxUpperSize)<Number(e))&&(this.advancedFiltering.maxUpperSize=(1*e+1).toString())},changeMaxPrice(){(""==this.advancedFiltering.maxPrice.trim()||Number(this.advancedFiltering.maxPrice)<=Number(this.advancedFiltering.minPrice))&&(this.advancedFiltering.maxPrice=(1*this.advancedFiltering.minPrice+1).toString())},changeMinPrice(e){(""==this.advancedFiltering.maxPrice.trim()||Number(this.advancedFiltering.maxPrice)<Number(e))&&(this.advancedFiltering.maxPrice=(1*e+1).toString())},changeSizePage(e){this.paginationForm.currentPage=e.page,this.paginationForm.pageSize=e.limit},articleChangeSizePage(e){let t=this.selectArticleData;this.articlePaginationForm.currentPage=e.page,this.articlePaginationForm.pageSize=e.limit;let a=setTimeout((()=>{t&&t.length&&this.$nextTick((()=>{t.forEach((e=>{this.articleData.forEach((t=>{e.substanceId==t.substanceId&&(this.toggleSelection([t]),a&&clearTimeout(a))}))}))}))}),100)},exportFile(){(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:{pull:1}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);(0,f.M)(window.$EXCEL_URL+e.data),this.$message.success(this.$t("h.exportSuccessful"))})).catch((e=>{this.$message.error(e)}))},getWarehouseData(e,t){(0,b.C3)({func:"ST0001",userId:e,token:t,requstData:{}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);if(e.data){let t=[];e.data.forEach((e=>{e.disabled||"0"!=e.state||t.push({name:e.name,label:e.name,value:e.houseId,state:e.state,subId:e.subId}),this.houseNameData.push({name:e.name,value:e.houseId})})),this.warehouseData=this.tree(t,"-")}})).catch((e=>{this.$message.error(e)}))},getEmployeeData(){(0,b.Ys)({func:"S0005",userId:this.userId,token:this.token,requstData:{_id:""}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.employeeData=e.data,this.deptId=e.data.find((e=>e._id==this.userId)).deptId,e.data||(this.employeeData=[])})).catch((e=>{this.$message.error(e)}))},watchInhouse(e){for(let t=0;t<this.warehouseData.length;t++){if(this.warehouseData[t].value==e&&"-1"==this.warehouseData[t].state)return this.warning=!0,void(this.warningTitle=this.warehouseData[t].name);this.warehouseData.length-1==t&&(this.warning=!1,this.warningTitle="")}},watchOuthouse(e){for(let t=0;t<this.warehouseData.length;t++){if(this.warehouseData[t].value==e&&"-1"==this.warehouseData[t].state)return this.warning=!0,void(this.warningTitle=this.warehouseData[t].name);this.warehouseData.length-1==t&&(this.warning=!1,this.warningTitle="")}},tree(e,t){const a=[];return e.forEach((i=>{if(i.subId==t){const t=this.tree(e,i.value);t.length>0&&(i.children=t),a.push(i)}})),a},getClassificationData(){(0,b.C3)({func:"BO0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join()}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.subMenuList=[{children:null,name:this.$t("h.title174"),sortingId:"1"}],e.data&&e.data.length&&(this.subMenuList[0].children=[],e.data.forEach((e=>{this.subMenuList[0].children.push(e)})))})).catch((e=>{this.$message.error(e)}))},async sortingDataSwitching(e){"1"==e.sortingId?(this.difference="all",this.getFilesData()):(this.waitFilesData=!0,this.difference="individual",(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,sortingId:e.sortingId,params:[]}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data?e.data:this.$t("h.tips256"));e.data?(this.articleData=e.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),this.recordSortingData=JSON.parse(JSON.stringify(e.data))):this.articleData=[];let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500);this.markArticle()})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)})))},getFilesData(e){this.waitFilesData=!0;let t=[];(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,params:[]}}).then((({data:a})=>{if("-1"==a.code)return this.$message.error(a.data);a.data?(this.articleData=a.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),e&&this.articleDetailsData.length&&this.$nextTick((()=>{this.articleDetailsData.forEach((e=>{this.articleData.forEach((a=>{e.substanceId==a.substanceId&&(this.toggleSelection([a]),t.push(a))}))}))}))):this.articleData=[];let i=setTimeout((()=>{e&&this.articleDetailsData.length&&(this.selectArticleData=t),this.waitFilesData=!1,i&&clearTimeout(i)}),500);this.markArticle()})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)}))},articleSelete(e){if("all"!=this.difference||this.waitFilesData){if("individual"==this.difference&&!this.waitFilesData){let t=[];this.selectArticleData.forEach(((e,a)=>{this.recordSortingData.some((t=>e.sortingId==t.sortingId))&&t.unshift(a)})),t.forEach((e=>{this.selectArticleData.splice(e,1)})),this.selectArticleData=this.selectArticleData.concat(JSON.parse(JSON.stringify(e)))}}else this.selectArticleData=JSON.parse(JSON.stringify(e)),this.selectArticleData.forEach((e=>{e.amount||(e.amount=1),e.price||(e.price=0),e.money||(e.money=e.amount*e.price)}))},determineItemSelection(){this.articleDetailsData=this.selectArticleData,this.outArticleDialog(),this.articleHighFilterTags=[]},articleDetailsSelete(e){this.selectArticleDetailsData=e},markArticle(){this.articleDetailsData&&this.articleDetailsData.length&&this.articleDetailsData.forEach((e=>{this.articleData.forEach((t=>{e.substanceId==t.substanceId&&(t.amount=e.amount,t.price=e.price,t.money=e.money)}))}))},deleteArticleDetailsSelete(){if(!this.selectArticleDetailsData||!this.selectArticleDetailsData.length)return this.$message.error(this.$t("h.tips22"));for(let e=this.articleDetailsData.length-1;e>=0;e--)this.selectArticleDetailsData.forEach((t=>{this.articleDetailsData[e]&&this.articleDetailsData[e].substanceId==t.substanceId&&(this.articleDetailsData.splice(e,1),0==e&&this.$message.success(this.$t("h.tips128")))}));this.selectArticleDetailsData=[]},articleDialogVisibleClose(){this.articleDialogVisible=!1,this.articleAndLike="",this.subMenuList=[],this.articleData=[],this.difference="all"},outArticleDialog(){this.articleDialogVisible=!1,this.articleAndLike="",this.subMenuList=[],this.articleData=[],this.difference="all"},articleSearch(){this.waitFilesData=!0,this.difference="individual",(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,params:[{key:"andLike",value:this.articleAndLike,handle:"OIS"}]}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);e.data?(this.articleData=e.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),this.recordSortingData=JSON.parse(JSON.stringify(e.data))):this.articleData=[];let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500);this.markArticle()})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)}))},changeMoney(e,t){this.articleDetailsData[e].money=t.amount*t.price},conTransfer(){this.$refs["conTransferFillInDataRef"].validate((e=>{if(!e)return!1;if(!this.articleDetailsData||!this.articleDetailsData.length)return this.$message.error(this.$t("h.tips256"));let t=this.conTransferFillInData.inHouseId.length>1?this.conTransferFillInData.inHouseId[this.conTransferFillInData.inHouseId.length-1]:this.conTransferFillInData.inHouseId.join(),a=this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join();if(t==a)return this.$message.error(this.$t("h.tips257"));let i=!1,s=[];for(let r=0;r<this.articleDetailsData.length;r++)s.push({substanceId:this.articleDetailsData[r].substanceId,amount:this.articleDetailsData[r].amount,money:this.articleDetailsData[r].money,price:this.articleDetailsData[r].price,remark:this.articleDetailsData[r].remark}),this.articleDetailsData[r].money<1&&(i=!0);if(i)return this.$message.error(this.$t("h.tips258"));0==this.isConTransfer?(0,b.C3)({func:"AL0002",userId:this.userId,token:this.token,requstData:{createDate:this.conTransferFillInData.createDate,useDate:this.conTransferFillInData.useDate,staffId:this.staffId,remark:this.conTransferFillInData.remark,outHouseId:a,inHouseId:t,useStaff:this.conTransferFillInData.useStaff,deptId:this.deptId,details:s}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.$message.success(e.data),this.newBillsDialogVisible=!1,this.isConTransfer=0,this.$refs["conTransferFillInDataRef"].resetFields(),this.articleDetailsData=[],this.selectArticleDetailsData=[],this.getConTransferDocuments()})).catch((e=>{this.$message.error(e)})):1==this.isConTransfer&&(0,b.C3)({func:"AL0003",userId:this.userId,token:this.token,requstData:{allocateId:this.conTransferFillInData.allocateId,useDate:this.conTransferFillInData.useDate,remark:this.conTransferFillInData.remark,outHouseId:a,inHouseId:t,useStaff:this.conTransferFillInData.useStaff,deptId:this.deptId,details:s}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.$message.success(e.data),this.newBillsDialogVisible=!1,this.isConTransfer=0,this.$refs["conTransferFillInDataRef"].resetFields(),this.articleDetailsData=[],this.selectArticleDetailsData=[],this.getConTransferDocuments()})).catch((e=>{this.$message.error(e)}))}))},bulkBillsDialogClose(){this.$refs["conTransferFillInDataRef"].resetFields(),this.articleDetailsData=[],this.selectArticleDetailsData=[],this.look=!1,this.conTransferFillInData={roleRule:this.$t("h.title173"),outHouseId:[],useDate:(0,f.X$)(),inHouseId:[],useStaff:"",staffName:JSON.parse(sessionStorage.getItem("vuex")).userInfo.staffName,createDate:(0,f.X$)(),remark:""},this.isConTransfer=0},getConTransferDocuments(){(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:{}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);e.data&&e.data.length?(this.assetTableData=e.data,this.assetTableData.forEach((e=>{"0"==e.status?e.statusName=this.$t("h.approved"):"1"==e.status?e.statusName=this.$t("h.pending"):"2"==e.status?e.statusName=this.$t("h.rejectBtn"):"3"==e.status&&(e.statusName=this.$t("h.draft"))}))):this.assetTableData=[]})).catch((e=>{this.$message.error(e)}))},resetArticleFilterForm(){this.waitFilesData=!0,this.difference="individual",this.articleHighFilterTags=[],this.$refs["advancedFiltering"].resetFields(),this.advancedFiltering.maxPrice="",this.advancedFiltering.maxUpperSize="",this.advancedFiltering.maxLowerSize="",(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,params:[]}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);e.data?(this.articleData=e.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),this.recordSortingData=JSON.parse(JSON.stringify(e.data))):this.articleData=[];let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500);this.markArticle(),this.$refs["advancedFiltering"].resetFields(),this.addFilteringVisible=!1})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)}))},submitArticleFilterForm(){if(this.waitFilesData=!0,this.difference="individual",""!=this.advancedFiltering.minPrice.trim()&&""==this.advancedFiltering.maxPrice.trim()||""==this.advancedFiltering.minPrice.trim()&&""!=this.advancedFiltering.maxPrice.trim())return this.$message.error(this.$t("h.tips259"));if(""!=this.advancedFiltering.minUpperSize.trim()&&""==this.advancedFiltering.maxUpperSize.trim()||""==this.advancedFiltering.minUpperSize.trim()&&""!=this.advancedFiltering.maxUpperSize.trim())return this.$message.error(this.$t("h.tips259"));if(""!=this.advancedFiltering.minLowerSize.trim()&&""==this.advancedFiltering.maxLowerSize.trim()||""==this.advancedFiltering.minLowerSize.trim()&&""!=this.advancedFiltering.maxLowerSize.trim())return this.$message.error(this.$t("h.tips259"));let e=[{key:"price",value:this.advancedFiltering.minPrice+","+this.advancedFiltering.maxPrice,handle:"OIS"},{key:"upperSize",value:this.advancedFiltering.minUpperSize+","+this.advancedFiltering.maxUpperSize,handle:"OIS"},{key:"lowerSize",value:this.advancedFiltering.minLowerSize+","+this.advancedFiltering.maxLowerSize,handle:"OIS"},{key:"andLike",value:this.advancedFiltering.andLike,handle:"OIS"}];e=e.filter((e=>{if(e.value&&","!=e.value)return e})),(0,b.C3)({func:"BU0001",userId:this.userId,token:this.token,requstData:{houseId:this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join(),status:!1,params:e}}).then((({data:t})=>{if(this.articleHighFilterTags=[],"-1"==t.code)return this.$message.error(t.data);t.data?(this.articleData=t.data,this.articleData.forEach((e=>{e.image&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)})),this.recordSortingData=JSON.parse(JSON.stringify(t.data))):this.articleData=[];let a=setTimeout((()=>{this.waitFilesData=!1,a&&clearTimeout(a)}),500);this.markArticle(),e.forEach((e=>{"price"==e.key?this.articleHighFilterTags.push({name:this.$t("h.price"),value:e.value,keyStr:e.key,handle:e.handle}):"upperSize"==e.key?this.articleHighFilterTags.push({name:this.$t("h.formTips70"),value:e.value,keyStr:e.key,handle:e.handle}):"lowerSize"==e.key?this.articleHighFilterTags.push({name:this.$t("h.formTips71"),value:e.value,keyStr:e.key,handle:e.handle}):"andLike"==e.key&&this.articleHighFilterTags.push({name:this.$t("h.fuzzyQuery"),value:e.value,keyStr:e.key,handle:e.handle})})),this.addFilteringVisible=!1})).catch((e=>{this.$message.error(e);let t=setTimeout((()=>{this.waitFilesData=!1,t&&clearTimeout(t)}),500)}))},resetBodyFilterForm(){this.highFilterTags=[],this.$refs["bodyFiltering"].resetFields(),(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:{}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.assetTableData=e.data,this.assetTableData?this.assetTableData.forEach((e=>{"0"==e.status?e.statusName=this.$t("h.approved"):"1"==e.status?e.statusName=this.$t("h.pending"):"2"==e.status?e.statusName=this.$t("h.rejectBtn"):"3"==e.status&&(e.statusName=this.$t("h.draft"))})):this.assetTableData=[],this.bodyFilteringVisible=!1})).catch((e=>{this.$message.error(e)}))},submitBodyFilterForm(){let e={andLike:this.bodyFiltering.andLike,status:this.bodyFiltering.status,createDate:this.bodyFiltering.createDate?this.bodyFiltering.createDate.join():this.bodyFiltering.createDate,staffId:this.bodyFiltering.staffId?this.bodyFiltering.staffId.join():this.bodyFiltering.staffId,outHouseId:this.bodyFiltering.outHouseId.length>1?this.bodyFiltering.outHouseId[this.bodyFiltering.outHouseId.length-1]:this.bodyFiltering.outHouseId.join(),inHouseId:this.bodyFiltering.inHouseId.length>1?this.bodyFiltering.inHouseId[this.bodyFiltering.inHouseId.length-1]:this.bodyFiltering.inHouseId.join(),useDate:this.bodyFiltering.useDate?this.bodyFiltering.useDate.join():this.bodyFiltering.useDate};for(let t in e)""!=e[t]&&","!=e[t]||delete e[t];(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:e}).then((({data:t})=>{if(this.highFilterTags=[],"-1"==t.code)return this.$message.error(t.data);this.assetTableData=t.data,this.assetTableData?this.assetTableData.forEach((e=>{"0"==e.status?e.statusName=this.$t("h.approved"):"1"==e.status?e.statusName=this.$t("h.pending"):"2"==e.status?e.statusName=this.$t("h.rejectBtn"):"3"==e.status&&(e.statusName=this.$t("h.draft"))})):this.assetTableData=[];for(let a in e)if("andLike"==a)this.highFilterTags.push({name:this.$t("h.fuzzyQuery"),value:e[a],keyStr:a});else if("status"==a){let t="";"0"==e[a]?item.statusName=this.$t("h.approved"):"1"==e[a]?item.statusName=this.$t("h.pending"):"2"==e[a]?item.statusName=this.$t("h.rejectBtn"):"3"==e[a]&&(item.statusName=this.$t("h.draft")),this.highFilterTags.push({name:this.$t("h.state"),value:t,uploadValue:e[a],keyStr:a})}else if("createDate"==a)this.highFilterTags.push({name:this.$t("h.creationTime"),value:e[a],keyStr:a});else if("staffId"==a){let t="";this.employeeData.forEach((i=>{i._id==e[a]&&(t=i.name)})),this.highFilterTags.push({name:this.$t("h.creator"),value:t,uploadValue:e[a],keyStr:a})}else if("outHouseId"==a){let t="";this.houseNameData.forEach((i=>{i.value==e[a]&&(t=i.name)})),this.highFilterTags.push({name:this.$t("h.formTips64"),value:t,uploadValue:e[a],keyStr:a})}else if("inHouseId"==a){let t="";this.houseNameData.forEach((i=>{i.value==e[a]&&(t=i.name)})),this.highFilterTags.push({name:this.$t("h.formTips65"),value:t,uploadValue:e[a],keyStr:a})}else"useDate"==a&&this.highFilterTags.push({name:this.$t("h.formTips74"),value:e[a],keyStr:a});this.bodyFilteringVisible=!1})).catch((e=>{this.$message.error(e)}))},bodySearch(){(0,b.C3)({func:"AL0001",userId:this.userId,token:this.token,requstData:{andLike:this.andLike}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);e.data?(this.assetTableData=e.data,this.assetTableData.forEach((e=>{"0"==requstData[key]?e.statusName=this.$t("h.approved"):"1"==requstData[key]?e.statusName=this.$t("h.pending"):"2"==requstData[key]?e.statusName=this.$t("h.rejectBtn"):"3"==requstData[key]&&(e.statusName=this.$t("h.draft"))}))):this.assetTableData=[]})).catch((e=>{this.$message.error(e)}))},bodySelete(e){if(this.assetTableSelectData=e,0!=this.assetTableSelectData.length){for(let e=0;e<this.assetTableSelectData.length;e++){if("3"!=this.assetTableSelectData[e].status){this.isEditDisable=!0;break}if(e==this.assetTableSelectData.length-1){this.isEditDisable=!1;break}}this.assetTableSelectData.forEach((e=>{e.list[0].amount=e.details[0].amount,e.list[0].money=e.details[0].money}))}else this.isEditDisable=!0},editingOperations(e){"modify"==e?this.modifyReceiptDocuments():"delete"==e&&this.deleteReceiptDocuments()},modifyReceiptDocuments(){if(this.assetTableSelectData.length>1)return this.$message.error(this.$t("h.tips110"));this.newBillsDialogVisible=!0,this.isConTransfer=1,this.conTransferFillInData={roleRule:this.assetTableSelectData[0].roleRule,outHouseId:this.assetTableSelectData[0].outHouseId,useDate:this.assetTableSelectData[0].useDate,inHouseId:this.assetTableSelectData[0].inHouseId,useStaff:this.assetTableSelectData[0].useStaff,staffName:this.assetTableSelectData[0].staffId,createDate:this.assetTableSelectData[0].createDate,remark:this.assetTableSelectData[0].remark,allocateId:this.assetTableSelectData[0].allocateId},this.articleDetailsData=this.assetTableSelectData[0].list,this.assetTableSelectData[0].details.forEach(((e,t)=>{this.articleDetailsData[t].amount=e.amount,this.articleDetailsData[t].money=e.money,this.articleDetailsData[t].price=e.price,this.articleDetailsData[t].remark=e.remark,this.articleDetailsData[t].substanceId=e.substanceId})),this.articleDetailsData.forEach((e=>{e.image&&"h"!=e.image[0]&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)}))},deleteReceiptDocuments(){let e=[];this.assetTableSelectData.forEach((t=>e.push(t.allocateId)));let t=e.join();this.$confirm(this.$t("h.tips260"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{(0,b.C3)({func:"AL0004",userId:this.userId,token:this.token,requstData:{allocateId:t}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.$message({type:"success",message:this.$t("h.tips128")}),this.getConTransferDocuments()})).catch((e=>{this.$message.error(e)}))})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips98")})}))},confirmConTransferDocuments(){if(this.assetTableSelectData.length>1)return this.$message.error(this.$t("h.tips110"));let e=[];this.assetTableSelectData.forEach((t=>e.push(t.allocateId)));let t=e.join();(0,b.C3)({func:"AL0005",userId:this.userId,token:this.token,requstData:{allocateId:t}}).then((({data:e})=>{if("-1"==e.code)return this.$message.error(e.data);this.$message({type:"success",message:this.$t("h.tips261")}),this.getConTransferDocuments()})).catch((e=>{this.$message.error(e)}))},lookDetails(e){this.newBillsDialogVisible=!0,this.look=!0,this.conTransferFillInData={roleRule:e.roleRule,outHouseId:e.outHouseId,useDate:e.useDate,inHouseId:e.inHouseId,useStaff:e.useStaff,staffName:e.staffId,createDate:e.createDate,remark:e.remark,allocateId:e.allocateId},e.list?this.articleDetailsData=e.list:this.articleDetailsData=[],e.details&&e.details.forEach(((e,t)=>{this.articleDetailsData[t].amount=e.amount,this.articleDetailsData[t].money=e.money,this.articleDetailsData[t].price=e.price,this.articleDetailsData[t].remark=e.remark,this.articleDetailsData[t].substanceId=e.substanceId})),this.articleDetailsData.forEach((e=>{e.image&&"h"!=e.image[0]&&(e.image=window.$EXCEL_URL+"image/"+e.image,e.prop=e.image)}))},getBillPrintTemplate(){(0,b.Ys)({func:"S0034",userId:this.userInfo._id,token:this.userInfo.token,requstData:{type:"CTR"}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.billPrintTemplate=e.data,this.conTransferTemplateId=localStorage.getItem("conTransferTemplateId"),this.billPrintTemplate.some((e=>e._id==this.conTransferTemplateId))||(this.conTransferTemplateId=this.billPrintTemplate[0]._id,localStorage.setItem("conTransferTemplateId",this.conTransferTemplateId))})).catch((()=>{this.$message.error(this.$t("h.tips119"))}))}},watch:{articleDialogVisible:async function(e){e&&(this.getClassificationData(),await this.getFilesData(!0))},"conTransferFillInData.outHouseId":function(e){for(let t=0;t<this.warehouseData.length;t++){if(this.warehouseData[t].value==e&&"-1"==this.warehouseData[t].state)return this.warning=!0,void(this.warningTitle=this.warehouseData[t].name);this.warehouseData.length-1==t&&(this.warning=!1,this.warningTitle="",this.watchInhouse(this.conTransferFillInData.inHouseId.length>1?this.conTransferFillInData.inHouseId[this.conTransferFillInData.inHouseId.length-1]:this.conTransferFillInData.inHouseId.join()))}this.look||1==this.isConTransfer||(this.articleDetailsData=[])},"conTransferFillInData.inHouseId":function(e){for(let t=0;t<this.warehouseData.length;t++){if(this.warehouseData[t].value==e&&"-1"==this.warehouseData[t].state)return this.warning=!0,void(this.warningTitle=this.warehouseData[t].name);this.warehouseData.length-1==t&&(this.warning=!1,this.warningTitle="",this.watchOuthouse(this.conTransferFillInData.outHouseId.length>1?this.conTransferFillInData.outHouseId[this.conTransferFillInData.outHouseId.length-1]:this.conTransferFillInData.outHouseId.join()))}this.look||1==this.isConTransfer||(this.articleDetailsData=[])},articleDataDisplay:function(){this.selectArticleData&&this.selectArticleData.length&&this.$nextTick((()=>{this.selectArticleData.forEach((e=>{this.articleData.forEach((t=>{e.substanceId==t.substanceId&&this.toggleSelection([t])}))}))}))}},created(){window.localStorage.getItem("conTransferTemplateId")||window.localStorage.setItem("conTransferTemplateId",44),this.userId=JSON.parse(sessionStorage.getItem("vuex")).userInfo._id,this.token=JSON.parse(sessionStorage.getItem("vuex")).userInfo.token,this.staffId=JSON.parse(sessionStorage.getItem("vuex")).userInfo.staffId,this.getWarehouseData(this.userId,this.token),this.getConTransferDocuments(),this.getEmployeeData(),this.conTransferTemplateId=localStorage.getItem("conTransferTemplateId"),this.getBillPrintTemplate()}},T=I,v=a(1001),$=(0,v.Z)(T,i,s,!1,null,"51a49c56",null),S=$.exports}}]);