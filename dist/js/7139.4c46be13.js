"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[7139],{88565:function(e,t,i){i.d(t,{Z:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"changeGoodsDialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.dialogVisibleOpened}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.$t("h.title150"))+" "+e._s(e.$t("h.formTips46")))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.dialogVisible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("div",{staticClass:"change-goods-filter"},[t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"change-goods-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.loading,tableData:e.requstBills,columns:e.requstBillsColumns,tableConfig:e.requstBillsConfig,rowKey:e=>e.id},on:{handleSelectionChange:e.handleSelectionChange},scopedSlots:e._u([{key:"select",fn:function({scope:i}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.purchasingSelect(i.row)}}},[e._v(e._s(e.$t("h.title150")))])]}},{key:"expand",fn:function({scope:i}){return t("div",{staticClass:"detail-table"},[t("ds-table",{attrs:{tableData:i.row.details,tableConfig:e.detailsConfig,columns:e.detailColumns}})],1)}}])})],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getRequstBills}}),t("div",{staticClass:"btns"},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.save}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)],1)])},a=[],o=(i(57658),i(20629)),n=i(83151),l=i(60983),r=i(93082),c=i(76080),d={components:{DsTable:l.Z,DsPagination:r.Z},data(){return{loading:!1,total:0,paginationForm:{currentPage:1,pageSize:20},requstBills:[],selectRequstBills:[],detailColumns:n.jW,detailsConfig:{index:!0}}},props:{changeDialogVisible:{type:Boolean,default:!1},requstBillsConfig:{type:Object,default:()=>{}},requstBillsColumns:{type:Array,default:()=>[]},updateRequstSelectState:{type:Array,default:()=>[]}},computed:{...(0,o.rn)(["userInfo"]),dialogVisible:{get(){return this.changeDialogVisible},set(e){this.$emit("update:changeDialogVisible",e)}}},methods:{getRequstBills(){this.loading=!0,(0,c.Ys)({func:"S0062",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage}}).then((({data:e})=>{if(this.loading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.requstBills=e.data[1],this.requstBills.forEach((e=>{let t=[];e.details.forEach((e=>{t.push(e.skuName)})),e.goodDetails=t.join("/")}))})).catch((()=>{this.loading=!1,this.$message.error(this.$t("h.tips18"))}))},purchasingSelect(e){this.$emit("select",e)},save(){this.$emit("save",this.selectRequstBills)},handleSelectionChange(e){this.selectRequstBills=e},dialogVisibleOpened(){this.$refs.billsTableRef.$refs.dsTableRef.clearSelection(),this.updateRequstSelectState.forEach((e=>{let t=this.requstBills.find((t=>t.id==e.purchasingId));this.$refs.billsTableRef.$refs.dsTableRef.toggleRowSelection(t,!0)})),this.getRequstBills()}}},u=d,g=i(1001),h=(0,g.Z)(u,s,a,!1,null,"a66ad6d2",null),m=h.exports},31421:function(e,t,i){i.r(t),i.d(t,{default:function(){return D}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"receiving"},[t("el-card",{staticClass:"receiving-card"},[t("div",{staticClass:"receiving-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.newReveivingForm}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.editBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",[e._v(e._s(e.$t("h.changeBtn")))]),t("el-dropdown-item",[e._v(e._s(e.$t("h.delBtn")))])],1)],1),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$t("h.formTips5"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",[e._v(e._s(e.$t("h.printDoucmentBtn")))]),t("el-dropdown-item",[e._v(e._s(e.$t("h.templateSettings")))])],1)],1)],1),t("ds-query-form-right-panel",[t("ds-search-btn")],1)],1)],1),t("div",{staticClass:"receiving-card-content"},[t("div",{staticClass:"receiving-filter"},[t("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"}},[e._v(e._s(e.$t("h.advancedBtn")))])],1),t("div",{staticClass:"receiving-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.tableLoading,columns:e.receivingBillsColumns,tableConfig:e.receivingBillsConfig,tableData:e.receivingBills,rowKey:e=>e.id}})],1),t("div",{staticClass:"receiving-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)},pagination:e.getReceivingBills}})],1)])]),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{newBillsDialogVisible:e.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},opened:e.newBillsDialogOpened,close:e.newBillsDialogClose,sbumitForm:e.sbumitReveivingForm}},[t("template",{slot:"form"},[t("el-form",{ref:"receivingFormRef",attrs:{"label-width":"100px",model:e.receivingForm,rules:e.receivingRules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.deliveryDate"),prop:"receiptDate"}},[t("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.deliveryDate")},model:{value:e.receivingForm.receiptDate,callback:function(t){e.$set(e.receivingForm,"receiptDate",t)},expression:"receivingForm.receiptDate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.applicationDate"),prop:"date"}},[t("el-date-picker",{attrs:{type:"date",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd",placeholder:e.$t("h.tips4")+e.$t("h.applicationDate")},model:{value:e.receivingForm.date,callback:function(t){e.$set(e.receivingForm,"date",t)},expression:"receivingForm.date"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.assetAttributes"),prop:"goodsId"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.assetAttributes"),filterable:"",clearable:""},model:{value:e.receivingForm.goodsId,callback:function(t){e.$set(e.receivingForm,"goodsId",t)},expression:"receivingForm.goodsId"}},e._l(e.goodsData,(function(e){return t("el-option",{key:e.goodsqId,attrs:{label:e.name,value:e.goodsqId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips46"),prop:"roleRule"}},[t("el-input",{staticClass:"roleRule-input",attrs:{disabled:"",clearable:""},model:{value:e.receivingForm.roleRule,callback:function(t){e.$set(e.receivingForm,"roleRule",t)},expression:"receivingForm.roleRule"}}),""==e.receivingForm.roleRule?t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.changeDialogVisible=!0}}},[e._v(e._s(e.$t("h.title150")))]):e._e(),""!=e.receivingForm.roleRule?t("el-button",{attrs:{type:"danger"},on:{click:e.clearSelectBill}},[e._v(e._s(e.$t("h.title153")))]):e._e()],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.supplier"),prop:"vendorId"}},[t("el-select",{attrs:{placeholder:e.$t("h.tips4")+e.$t("h.supplier"),filterable:"",clearable:""},model:{value:e.receivingForm.vendorId,callback:function(t){e.$set(e.receivingForm,"vendorId",t)},expression:"receivingForm.vendorId"}},e._l(e.vendorData,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.creator"),prop:"staffId"}},[t("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:e.staffData,modelField:"_id",model:e.receivingForm.staffId,searchField:"andLike",func:"S0005",userInfo:e.userInfo},expression:"{\n                  options: staffData,\n                  modelField: '_id',\n                  model: receivingForm.staffId,\n                  searchField: 'andLike',\n                  func: 'S0005',\n                  userInfo: userInfo,\n                }"}],attrs:{disabled:"",placeholder:e.$t("h.tips4")+e.$t("h.creator"),clearable:"",filterable:"","filter-method":()=>{}},model:{value:e.receivingForm.staffId,callback:function(t){e.$set(e.receivingForm,"staffId",t)},expression:"receivingForm.staffId"}},e._l(e.staffData,(function(i){return t("el-option",{key:i._id,attrs:{label:i.name,value:i._id}},[t("span",[e._v(e._s(i.name+"("+i.code+")")+" -"+e._s(i.deptName))])])})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("h.changeDescription"),prop:"coment"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.receivingForm.coment,callback:function(t){e.$set(e.receivingForm,"coment",t)},expression:"receivingForm.coment"}})],1)],1)],1)],1)],1),t("template",{slot:"btns"},[t("div",[t("span",{staticClass:"title"},[e._v(e._s(e.$t("h.title154"))+" - "+e._s(e.$t("h.title147")))])]),t("div",{staticClass:"btns"},[t("el-button",{attrs:{type:"text",size:"small",disabled:""!=e.receivingForm.roleRule},on:{click:e.addReceivingGoods}},[e._v(e._s(e.$t("h.addBtn")))]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:e.deleteReceivingGoods}},[e._v(e._s(e.$t("h.delBtn")))])],1)]),t("template",{slot:"table"},[t("div",{staticClass:"bill-table"},[t("ds-table",{attrs:{tableConfig:e.receivingBillsConfig,columns:e.receivingGoodsColumns,tableData:e.receivingGoods,rowKey:e=>e.rowKeyId,sums:e.sums,summary:""},on:{getSummaries:e.getSummaries,handleSelectionChange:e.receivingGoodsSelectionChange},scopedSlots:e._u([{key:"tatolQuantity",fn:function({scope:i}){return[t("span",[t("el-input-number",{attrs:{precision:2,step:1,min:1,size:"mini"},on:{change:(t,s)=>e.onQuantityChange(t,s,i.row)},model:{value:i.row.tatolQuantity,callback:function(t){e.$set(i.row,"tatolQuantity",t)},expression:"scope.row.tatolQuantity"}})],1)]}},{key:"taxRate",fn:function({scope:i}){return[t("span",[t("el-input-number",{attrs:{precision:2,step:1,min:1,size:"mini"},on:{change:(t,s)=>e.onTaxRateChange(t,s,i.row)},model:{value:i.row.taxRate,callback:function(t){e.$set(i.row,"taxRate",t)},expression:"scope.row.taxRate"}})],1)]}}])})],1)])],2),t("change-goods-dialog",{attrs:{changeDialogVisible:e.changeDialogVisible,requstBillsConfig:e.requstBillsConfig,requstBillsColumns:e.requstBillsColumns},on:{"update:changeDialogVisible":function(t){e.changeDialogVisible=t},"update:change-dialog-visible":function(t){e.changeDialogVisible=t},select:e.requstGoodsSelect}}),t("sku-list-dialog",{attrs:{skuDialogVisible:e.skuDialogVisible,updateSkuSelectState:e.receivingGoods},on:{"update:skuDialogVisible":function(t){e.skuDialogVisible=t},"update:sku-dialog-visible":function(t){e.skuDialogVisible=t},save:e.requstGoodsSave}})],1)},a=[],o=(i(57658),i(30541),i(40466)),n=i(88565),l=i(42041),r=i(66403),c=i(60983),d=i(93082),u=i(19698),g=i(92003),h=i(89782),m=i(20629),p=i(76080),f=i(83151),v=i(39622),b={components:{SkuListDialog:o.Z,ChangeGoodsDialog:n.Z,NewBillsDialog:l.Z,DsSearchBtn:r.Z,DsTable:c.Z,DsPagination:d.Z,DsQueryForm:u.Z,DsQueryFormLeftPanel:g.Z,DsQueryFormRightPanel:h.Z},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},tableLoading:!1,receivingBillsColumns:f.Qm,receivingBillsConfig:{selection:!0,reserveSelection:!0},receivingBills:[],dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},staffData:[],vendorData:[],goodsData:[],newBillsDialogVisible:!1,receivingForm:{deptId:"",staffId:"",goodsId:"",receiptDate:"",date:"",coment:"",roleRule:"",purchasingId:"",permissonId:26},receivingRules:{},receivingGoodsColumns:f.N0,receivingGoods:[],selectReceivingGoods:[],sums:[],changeDialogVisible:!1,skuDialogVisible:!1,requstBillsConfig:{expand:!0,expandName:"",expandWidth:"50px",expandFixed:!1,soltName:"expand"},requstBillsColumns:[]}},computed:{...(0,m.rn)(["userInfo"])},methods:{getReceivingBills(){this.tableLoading=!0,(0,p.Ys)({func:"S0063",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage}}).then((({data:e})=>{if(console.log(e.data),this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data[0],this.receivingBills=e.data[1],this.receivingBills.forEach((e=>{let t=[];e.details.forEach((e=>{t.push(e.skuName)})),e.goodDetails=t.join("/")}))})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},getGoods(){(0,p.Ys)({func:"S0022",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.goodsData=e.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},getVendors(){(0,p.Ys)({func:"S0061",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.vendorData=e.data[1]})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},newReveivingForm(){this.newBillsDialogVisible=!0,this.receivingForm.staffId=this.userInfo._id},requstGoodsSelect(e){console.log(e),this.receivingForm.roleRule=e.roleRule,this.receivingForm.purchasingId=e.id,this.changeDialogVisible=!1,this.receivingGoods=e.details.map((e=>({rowKeyId:e.id,artclePurchasingId:e.id,proId:e.proId,skuName:e.skuName,skuType:e.skuType,skuUnit:e.skuUnit,quantity:e.quantity,tatolQuantity:e.quantity,price:e.price,taxRate:e.taxRate,taxPrint:e.taxPrint,noTaxAmount:e.noTaxAmount,amount:e.amount})))},clearSelectBill(){this.receivingGoods=[],this.receivingForm.roleRule="",this.receivingForm.purchasingId=""},onQuantityChange(e,t,i){i.price&&(i.amount=(i.price*i.tatolQuantity).toFixed(2),i.taxPrint=(i.amount/(1+i.taxRate/100)*(i.taxRate/100)).toFixed(2),i.noTaxAmount=(i.amount-i.amount/(1+i.taxRate/100)*(i.taxRate/100)).toFixed(2))},onTaxRateChange(e,t,i){i.taxPrint=(i.amount/(1+i.taxRate/100)*(i.taxRate/100)).toFixed(2),i.noTaxAmount=(i.amount-i.amount/(1+i.taxRate/100)*(i.taxRate/100)).toFixed(2)},addReceivingGoods(){this.skuDialogVisible=!0},requstGoodsSave(e){console.log(e),this.receivingGoods=e.map((e=>({rowKeyId:e.id,proId:e.id,skuName:e.assetTemplateName,skuType:e.specification,skuUnit:e.measureUnit,quantity:null,tatolQuantity:1,price:e.amount,taxRate:13,taxPrint:(e.amount/1.13*.13).toFixed(2),noTaxAmount:(e.amount-e.amount/1.13*.13).toFixed(2),amount:1*e.amount}))),this.skuDialogVisible=!1},receivingGoodsSelectionChange(e){this.selectReceivingGoods=e},deleteReceivingGoods(){this.selectReceivingGoods.forEach((e=>{this.receivingGoods.splice(this.receivingGoods.findIndex((t=>t.rowKeyId==e.rowKeyId)),1)}))},getSummaries(e){const{columns:t,data:i}=e;t.forEach(((e,t)=>{if(0===t)return void(this.sums[t]=this.$t("h.totalAmount"));const s=i.map((t=>Number(t[e.property])));s.every((e=>isNaN(e)))?this.sums[t]="N/A":this.sums[t]=s.reduce(((e,t)=>{const i=Number(t);return isNaN(i)?e:e+t}),0)}))},newBillsDialogOpened(){this.$refs.receivingFormRef.clearValidate()},newBillsDialogClose(){this.receivingGoods=[],this.selectReceivingGoods=[],this.sums=[],this.receivingForm.deptId="",this.receivingForm.staffId="",this.receivingForm.goodsId="",this.receivingForm.date="",this.receivingForm.coment="",this.receivingForm.vendorId="",this.receivingForm.purchasingId="",this.receivingForm.roleRule=""},sbumitReveivingForm(){this.$refs.receivingFormRef.validate((e=>{if(!e)return!1;if(!this.receivingGoods.length)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips248")});let t=!1;for(let a=0;a<this.receivingGoods.length;a++)if(!this.receivingGoods[a].tatolQuantity){t=!0;break}if(t)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips249")});const i=this.$loading(this.dialogLoading);let s=this.staffData.find((e=>e._id==this.userInfo._id)).deptId;(0,p.Vx)({func:"U0068",token:this.userInfo.token,userId:this.userInfo._id,requstData:{deptId:s,staffId:this.receivingForm.staffId,goodsId:this.receivingForm.goodsId,receiptDate:this.receivingForm.receiptDate,date:this.receivingForm.date,coment:this.receivingForm.coment,vendorId:this.receivingForm.vendorId,purchasingId:this.receivingForm.purchasingId,details:this.receivingGoods,permissonId:this.receivingForm.permissonId}}).then((({data:e})=>{if(i.close(),0!=e.code)return this.$message.error(e.data);this.$message.success(e.data),this.newBillsDialogVisible=!1,this.paginationForm.currentPage=1,this.getReceivingBills})).catch((()=>{i.close(),this.$message.error(this.$t("h.tips18"))}))}))}},created(){this.getReceivingBills(),this.getGoods(),this.getVendors(),this.requstBillsColumns=(0,v.Z)(f.hf),this.requstBillsColumns.unshift({label:this.$t("h.title150"),slotName:"select",width:"100"})}},y=b,F=i(1001),$=(0,F.Z)(y,s,a,!1,null,"5e91e628",null),D=$.exports},85117:function(e,t,i){var s=i(66330),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw a("Cannot delete property "+s(t)+" of "+s(e))}},30541:function(e,t,i){var s=i(82109),a=i(47908),o=i(26244),n=i(83658),l=i(85117),r=i(7207),c=1!==[].unshift(0),d=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();s({target:"Array",proto:!0,arity:1,forced:c||d},{unshift:function(e){var t=a(this),i=o(t),s=arguments.length;if(s){r(i+s);var c=i;while(c--){var d=c+s;c in t?t[d]=t[c]:l(t,d)}for(var u=0;u<s;u++)t[u]=arguments[u]}return n(t,i+s)}})},39622:function(e,t){function i(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function s(e,t=new WeakMap){if("symbol"===typeof e)return Symbol(e.description);if(!i(e))return e;if(e instanceof Set){const t=new Set;for(const i of e)t.add(s(i));return t}if(e instanceof Map){const t=new Map;for(const i of e)t.set(i[0],i[1]);return t}if("function"===typeof e)return e;if(t.get(e))return t.get(e);const a=Array.isArray(e)?[]:{};t.set(e,a);for(const i in e)a[i]=s(e[i],t);const o=Object.getOwnPropertySymbols(e);for(const i of o)a[Symbol(i.description)]=s(e[i],t);return a}t["Z"]=s}}]);