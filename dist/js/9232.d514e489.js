"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[9232],{5791:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"filter-drawer"},[e("el-drawer",{attrs:{title:t.$t("h.advancedBtn"),size:550,direction:"rtl",visible:t.drawer},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticClass:"filter-form"},[t._t("default")],2),e("div",{staticClass:"filter-btn"},[t._t("set"),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.submitFilterForm}},[t._v(t._s(t.$t("h.saveBtn")))]),e("el-button",{attrs:{size:"small"},on:{click:t.resetFilterForm}},[t._v(t._s(t.$t("h.resetBtn")))])],2)])],1)},s=[],r={name:"DsFilterDrawer",data(){return{}},props:{filterDrawerVisible:{type:Boolean}},computed:{drawer:{get(){return this.filterDrawerVisible},set(t){this.$emit("update:filterDrawerVisible",t)}}},methods:{submitFilterForm(){this.$emit("submitFilterForm")},resetFilterForm(){this.$emit("resetFilterForm")}}},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"05535b94",null),h=o.exports},17817:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-filter-tag"},t._l(t.tagsData,(function(i){return e("el-tag",{key:i.keyStr,attrs:{size:t.tagSize,effect:"dark",closable:""},on:{close:function(e){return t.handleClose(i)}}},[t._v(" "+t._s(i.name)+":"+t._s(i.value.length>8?i.value.substring(0,7)+"...":i.value)+" ")])})),1)},s=[],r={name:"DsFilterTag",data(){return{tags:[{name:this.$t("h.label1"),type:""},{name:this.$t("h.label2"),type:"success"},{name:this.$t("h.label3"),type:"info"},{name:this.$t("h.label4"),type:"warning"},{name:this.$t("h.label5"),type:"danger"}]}},props:{filterTagsData:{type:Array,default:()=>[]},tagSize:{type:String,default:"medium"}},computed:{tagsData:{get(){return this.filterTagsData},set(t){this.$emit("update:filterTagsData",t)}}},methods:{handleClose(t){this.$emit("handleCloseTag",t)}}},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"628dc1ca",null),h=o.exports},93082:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-pagination"},[e("el-pagination",t._b({attrs:{background:t.background,"current-page":t.currentPage,"page-size":t.pageSize,layout:t.layout,"page-sizes":t.pageSizes,total:t.total},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)},s=[],r={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(t){this.$emit("update:page",t)}},pageSize:{get(){return this.limit},set(t){this.$emit("update:limit",t)}}},methods:{handleSizeChange(t){this.$emit("pagination",{page:this.currentPage,limit:t})},handleCurrentChange(t){this.$emit("pagination",{page:t,limit:this.pageSize})}}},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"2377c114",null),h=o.exports},92003:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"left-panel"},[t._t("default")],2)},s=[],r={name:"DsQueryFormLeftPanel"},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"71d76034",null),h=o.exports},89782:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"right-panel"},[t._t("default")],2)},s=[],r={name:"DsQueryFormRightPanel"},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"c6443ba6",null),h=o.exports},19698:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-query-form"},[t._t("default")],2)},s=[],r={name:"DsQueryForm"},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"6c8bfb78",null),h=o.exports},66403:function(t,e,i){i.d(e,{Z:function(){return h}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ds-search"},[e("el-input",{attrs:{size:"small",placeholder:t.$t("h.keyword"),"prefix-icon":"el-icon-search"},on:{input:t.onInput},model:{value:t.value,callback:function(e){t.value="string"===typeof e?e.trim():e},expression:"value"}},[e("el-button",{attrs:{slot:"suffix",type:"text",size:"small"},on:{click:t.search},slot:"suffix"},[t._v(t._s(t.$t("h.Search")))])],1)],1)},s=[],r={name:"DsSearchBtn",data(){return{}},props:{searchValue:{type:String}},computed:{value:{get(){return this.searchValue},set(t){this.$emit("update:searchValue",t)}}},methods:{search(){this.$emit("search")},onInput(t){""==t&&this.search()}}},l=r,n=i(1001),o=(0,n.Z)(l,a,s,!1,null,"5bd7b965",null),h=o.exports},27378:function(t,e,i){i.r(e),i.d(e,{default:function(){return w}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"assset-history"},[e("el-card",{staticClass:"history-card"},[e("div",{staticClass:"history-card-header",attrs:{slot:"header"},slot:"header"},[e("ds-query-form",[e("ds-query-form-left-panel"),e("ds-query-form-right-panel",[e("ds-search-btn",{attrs:{searchValue:t.andLike},on:{"update:searchValue":function(e){t.andLike=e},"update:search-value":function(e){t.andLike=e},search:t.findBillsSearch}})],1)],1)],1),e("div",{staticClass:"history-card-content"},[e("div",{staticClass:"history-filter"},[e("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small",icon:"el-icon-refresh"},on:{click:t.getAssetHistoryBills}},[t._v(t._s(t.$t("h.refreshList")))])],1),e("div",{staticClass:"history-table"},[e("ds-table",{ref:"printTableRef",attrs:{loading:t.tableLoading,rowKey:t=>t.assetCode,tableData:t.printHistoryBills,columns:t.columns,tableConfig:t.tableConfig},scopedSlots:t._u([{key:"operation",fn:function({scope:i}){return[e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.checkHistoryDetail(i.row.assetCode)}}},[t._v(t._s(t.$t("h.viewDetails")))])]}}])})],1),e("div",{staticClass:"history-pagination"},[e("ds-pagination",{attrs:{small:"",total:t.total,page:t.paginationForm.currentPage,limit:t.paginationForm.pageSize},on:{"update:page":function(e){return t.$set(t.paginationForm,"currentPage",e)},"update:limit":function(e){return t.$set(t.paginationForm,"pageSize",e)},pagination:t.getAssetHistoryBills}})],1)])]),e("asset-history-detail",{attrs:{historyDialogVisible:t.historyDialogVisible,code:t.historyAssetCode},on:{"update:historyDialogVisible":function(e){t.historyDialogVisible=e},"update:history-dialog-visible":function(e){t.historyDialogVisible=e},closed:t.historyAssetCodeClosed}})],1)},s=[],r=(i(57658),i(60983)),l=i(66403),n=i(19698),o=i(93082),h=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{top:"0","custom-class":"dialog","show-close":!1,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},opened:t.dialogVisibleOpened,closed:t.dialogVisibleClosed}},[e("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"left"},[e("span",[t._v(t._s(t.$t("h.assetHistoryDetails")))])]),e("div",{staticClass:"right"},[e("i",{staticClass:"el-icon-close",on:{click:function(e){t.dialogVisible=!1}}})])]),e("div",{staticClass:"dialog-body"},[e("div",{staticClass:"detail-filter"},[e("ds-filter-tag",{attrs:{filterTagsData:t.highFilterTags},on:{handleCloseTag:t.handleCloseFilterTag}}),e("el-button",{staticClass:"advanced-filter-btn",attrs:{type:"text",size:"small"},on:{click:function(e){t.filterDrawerVisible=!0}}},[t._v(t._s(t.$t("h.advancedBtn")))])],1),e("div",{staticClass:"detail-table"},[e("ds-table",{attrs:{loading:t.tableLoading,tableData:t.assetHistoryDetail,columns:t.columns}})],1),e("div",{staticClass:"detail-pagination"},[e("ds-pagination",{attrs:{small:"",total:t.total,page:t.paginationForm.currentPage,limit:t.paginationForm.pageSize},on:{"update:page":function(e){return t.$set(t.paginationForm,"currentPage",e)},"update:limit":function(e){return t.$set(t.paginationForm,"pageSize",e)},pagination:t.getAssetHistoryDetail}})],1)])]),e("ds-filter-drawer",{attrs:{filterDrawerVisible:t.filterDrawerVisible},on:{"update:filterDrawerVisible":function(e){t.filterDrawerVisible=e},"update:filter-drawer-visible":function(e){t.filterDrawerVisible=e},submitFilterForm:t.submitFilterForm,resetFilterForm:t.resetFilterForm}},[e("el-form",{ref:"filterFormRef",attrs:{"label-width":"100px",model:t.filterForm}},[e("el-form-item",{attrs:{label:t.$t("h.processingDate"),prop:"date"}},[e("el-date-picker",{attrs:{type:"daterange","range-separator":t.$t("h.to"),"start-placeholder":t.$t("h.startDate"),"end-placeholder":t.$t("h.endDate"),"value-format":"yyyy-MM-dd"},model:{value:t.filterForm.date,callback:function(e){t.$set(t.filterForm,"date",e)},expression:"filterForm.date"}})],1),e("el-form-item",{attrs:{label:t.$t("h.business"),prop:"type"}},[e("el-select",{attrs:{placeholder:t.$t("h.tips4")+t.$t("h.business"),"collapse-tags":"",multiple:"",clearable:""},model:{value:t.filterForm.type,callback:function(e){t.$set(t.filterForm,"type",e)},expression:"filterForm.type"}},t._l(t.historyTypeData,(function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t._id}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("h.advancedSearch5"),prop:"userName"}},[e("el-select",{directives:[{name:"load-more",rawName:"v-load-more",value:{options:t.staffData,modelField:"name",model:t.filterForm.userName.join(","),searchField:"andLike",func:"S0005",userInfo:t.userInfo},expression:"{\n            options: staffData,\n            modelField: 'name',\n            model: filterForm.userName.join(','),\n            searchField: 'andLike',\n            func: 'S0005',\n            userInfo: userInfo,\n          }"}],attrs:{placeholder:t.$t("h.tips4")+t.$t("h.advancedSearch1"),multiple:"",clearable:"",filterable:"","allow-create":"","filter-method":()=>{}},model:{value:t.filterForm.userName,callback:function(e){t.$set(t.filterForm,"userName",e)},expression:"filterForm.userName"}},t._l(t.staffData,(function(i){return e("el-option",{key:i._id,attrs:{label:i.name,value:i.name}},[e("span",[t._v(t._s(i.name+"("+i.code+")")+" -"+t._s(i.deptName))])])})),1)],1)],1)],1)],1)},u=[],d=i(76080),c=i(20629),p=i(83151),f=i(17817),g=i(5791),m={components:{DsTable:r.Z,DsPagination:o.Z,DsFilterTag:f.Z,DsFilterDrawer:g.Z},data(){return{total:0,paginationForm:{pageSize:20,currentPage:1},tableLoading:!1,columns:p.ii,assetHistoryDetail:[],filterDrawerVisible:!1,filterForm:{date:[],type:[],userName:[]},highFilterTags:[],staffData:[],historyTypeData:p.Bw}},props:{historyDialogVisible:{type:Boolean,default:!1},code:{type:String,default:""}},computed:{...(0,c.rn)(["userInfo"]),dialogVisible:{get(){return this.historyDialogVisible},set(t){this.$emit("update:historyDialogVisible",t)}}},methods:{getAssetHistoryDetail(){this.tableLoading=!0,null==this.filterForm.date&&(this.filterForm.date=[]),(0,d.Ys)({func:"S0046",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,assetCode:this.code,type:this.filterForm.type.join(","),date:this.filterForm.date.join(","),userName:this.filterForm.userName.join(",")}}).then((({data:t})=>{if(this.tableLoading=!1,0!=t.code)return this.$message.error(t.data);this.total=t.data[0],t.data[1].forEach((t=>{let e={1:this.$t("h.Using"),2:this.$t("h.Revert"),3:this.$t("h.Borrow"),5:this.$t("h.Allocation"),6:this.$t("h.Repair"),7:this.$t("h.Scrap"),8:this.$t("h.Received"),9:this.$t("h.Check"),10:this.$t("h.assetDeletion"),11:this.$t("h.assetModification"),12:this.$t("h.Return")};t.typeName=e[t.type]})),this.assetHistoryDetail=t.data[1]})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},dialogVisibleOpened(){this.getAssetHistoryDetail()},dialogVisibleClosed(){this.assetHistoryDetail=[],this.highFilterTags=[],this.filterForm.date=[],this.filterForm.type=[],this.filterForm.userName=[],this.paginationForm.currentPage=1,this.paginationForm.pageSize=20,this.total=0,this.$emit("closed")},staffRemoteMethod(t){if(!t)return this.staffData=[],!1;(0,d.Ys)({func:"S0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{andLike:t}}).then((({data:t})=>{if(t.code)return this.$message.error(t.data);this.staffData=t.data})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},mapHighFilterTags(){this.highFilterTags=[];for(let t in this.filterForm)if(this.filterForm[t]&&this.filterForm[t].length)if("date"==t){let e={};e.name=this.$t("h.processingDate"),e.keyStr=t,e.value=this.filterForm[t].join(this.$t("h.to")),this.highFilterTags.push(e)}else if("type"==t){let e={},i=[];this.filterForm[t].forEach((t=>{let e=this.historyTypeData.find((e=>e._id==t)).name;i.push(e)})),e.name=this.$t("h.business"),e.keyStr=t,e.value=i.join(","),this.highFilterTags.push(e)}else if("userName"==t){let e={};e.name=this.$t("h.advancedSearch5"),e.keyStr=t,e.value=this.filterForm[t].join(","),this.highFilterTags.push(e)}},handleCloseFilterTag(t){this.highFilterTags.splice(this.highFilterTags.indexOf(t),1),this.filterForm[t.keyStr]=[],this.paginationForm.currentPage=1,this.getAssetHistoryDetail()},submitFilterForm(){this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getAssetHistoryDetail()},resetFilterForm(){this.$refs["filterFormRef"].resetFields(),this.filterDrawerVisible=!1,this.mapHighFilterTags(),this.paginationForm.currentPage=1,this.getAssetHistoryDetail()}}},b=m,y=i(1001),F=(0,y.Z)(b,h,u,!1,null,"dd45d790",null),v=F.exports,D=i(92003),$=i(89782),C=i(79992),_={components:{DsTable:r.Z,DsSearchBtn:l.Z,DsQueryForm:n.Z,DsPagination:o.Z,AssetHistoryDetail:v,DsQueryFormLeftPanel:D.Z,DsQueryFormRightPanel:$.Z},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},andLike:"",tableLoading:!1,tableConfig:{},printHistoryBills:[],historyDialogVisible:!1,historyAssetCode:""}},computed:{...(0,c.rn)(["userInfo","assetTableHeader"]),columns(){let t=[];return this.assetTableHeader.forEach((e=>{"assetCode"==e.attr?t.push({prop:e.attr,label:e.label,fixed:e.fixed,minWidth:(0,C.Uh)(e.label),showOverflowTooltip:!0}):"name"==e.attr&&t.push({prop:"assetName",label:e.label,fixed:e.fixed,minWidth:(0,C.Uh)(e.label),showOverflowTooltip:!0})})),t.push({label:this.$t("h.action"),sortable:!1,slotName:"operation",width:"110",fixed:"left"}),t}},methods:{getAssetHistoryBills(){this.tableLoading=!0,(0,d.Ys)({func:"S0046",userId:this.userInfo._id,token:this.userInfo.token,requstData:{page:this.paginationForm.pageSize,index:this.paginationForm.currentPage,andLike:this.andLike}}).then((({data:t})=>{if(this.tableLoading=!1,0!=t.code)return this.$message.error(t.data);this.total=t.data[0],this.printHistoryBills=t.data[1]})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},checkHistoryDetail(t){this.historyAssetCode=t,this.historyDialogVisible=!0},historyAssetCodeClosed(){this.historyAssetCode=""},findBillsSearch(){this.paginationForm.currentPage=1,this.getAssetHistoryBills()}},created(){this.getAssetHistoryBills()}},k=_,S=(0,y.Z)(k,a,s,!1,null,"18e7b506",null),w=S.exports}}]);