"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[6995],{93082:function(e,t,a){a.d(t,{Z:function(){return d}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-pagination"},[t("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[],s={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e})},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize})}}},n=s,o=a(1001),r=(0,o.Z)(n,l,i,!1,null,"2377c114",null),d=r.exports},92003:function(e,t,a){a.d(t,{Z:function(){return d}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"left-panel"},[e._t("default")],2)},i=[],s={name:"DsQueryFormLeftPanel"},n=s,o=a(1001),r=(0,o.Z)(n,l,i,!1,null,"71d76034",null),d=r.exports},19698:function(e,t,a){a.d(t,{Z:function(){return d}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-query-form"},[e._t("default")],2)},i=[],s={name:"DsQueryForm"},n=s,o=a(1001),r=(0,o.Z)(n,l,i,!1,null,"6c8bfb78",null),d=r.exports},66126:function(e,t,a){a.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"upload"},[e.fileValue.value?t("div",{staticClass:"upload-icon"},[t("button",{staticClass:"close-btn",on:{click:e.cancalUploadFile}},[t("i",{staticClass:"el-icon-close"})]),t("i",{staticClass:"el-icon-document"}),t("h5",{staticClass:"file-name"},[e._v(e._s(e.fileValue.name))])]):t("div",{staticClass:"upload-btn"},[t("input",{ref:"uploadInputRef",attrs:{type:"file",id:"upload-btn-input",accept:".xlsx, .xls"},on:{change:e.handleFileChange}}),t("i",{staticClass:"el-icon-plus"})])])},i=[],s=a(79992),n={data(){return{}},props:{value:{type:Object,default:()=>({value:"",name:""})},loading:{type:Boolean,default:!1}},computed:{fileValue:{get(){return this.value},set(e){this.$emit("update:value",e)}}},methods:{handleFileChange(e){const t=e.target.files[0].type,a="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",l="application/vnd.ms-excel";let i=!0;t!==a&&t!==l&&(i=!1);let n=!0,o=this.getFileExtension(e.target.files[0].name);if("xls"!=o&&"xlsx"!=o&&(n=!1),!i&&!n)return this.$notify.error({title:this.$t("h.title27"),message:this.$t("h.tips108")});(0,s.sT)(e.target.files[0]).then((t=>{this.fileValue.value=t,this.fileValue.name=e.target.files[0].name})).catch((()=>{this.cancalUploadFile(),this.$message.error(this.$t("h.tips109"))}))},cancalUploadFile(e){e.preventDefault(),this.fileValue.value="",this.fileValue.name=""},getFileExtension(e){return e.split(".").pop()}}},o=n,r=a(1001),d=(0,r.Z)(o,l,i,!1,null,"09bbdb75",null),u=d.exports},19528:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"excel-info"},[t("el-card",{staticClass:"excel-info-card"},[t("div",{staticClass:"excel-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.newDialogVisible=!0}}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-dropdown",{attrs:{trigger:"click"}},[t("el-button",{attrs:{size:"mini"}},[e._v(" "+e._s(e.$t("h.editBtn"))),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return e.editTemplate.apply(null,arguments)}}},[e._v(e._s(e.$t("h.changeBtn")))]),t("el-dropdown-item",{nativeOn:{click:function(t){return e.deteleTemplate.apply(null,arguments)}}},[e._v(e._s(e.$t("h.delBtn")))])],1)],1)],1)],1)],1),t("div",{staticClass:"excel-card-content"},[t("div",{staticClass:"bills-table"},[t("ds-table",{ref:"tableRef",attrs:{onlyKey:"name",loading:e.tableLoading,tableData:e.templateBills.slice((e.paginationForm.currentPage-1)*e.paginationForm.pageSize,e.paginationForm.currentPage*e.paginationForm.pageSize),columns:e.templateColumns,tableConfig:e.tempTableConfig,rowKey:e=>e.name},on:{handleSelectionChange:e.handleSelectionChange}})],1),t("div",{staticClass:"bills-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)}}})],1)])]),t("new-bills-dialog",{attrs:{visible:e.newDialogVisible,excelFileBase64:e.excelFile.value,excelFileName:e.excelFile.name},on:{"update:visible":function(t){e.newDialogVisible=t},dialogVisibleClosed:e.newDialogVisibleClosed,updateExcelInfo:e.getTemplateBills}},[t("upload-excel-base64",{attrs:{value:e.excelFile},on:{"update:value":function(t){e.excelFile=t}}})],1),t("edit-bills-dialog",{attrs:{visible:e.editDialogVisible,templateEditTableData:e.editTableData},on:{"update:visible":function(t){e.editDialogVisible=t},dialogVisibleClosed:e.editDialogVisbileClosed,updateExcelInfo:e.getTemplateBills}})],1)},i=[],s=a(19698),n=a(92003),o=a(60983),r=a(93082),d=a(66126),u=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{fullscreen:"","custom-class":"dialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.dialogVisibleOpened,closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog_title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title_left"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-back",circle:"",plain:"",size:"small"},on:{click:function(t){e.dialogVisible=!1}}}),t("span",[e._v(e._s(e.$t("h.title84")))])],1),t("div",{staticClass:"title_right"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitTemplate}},[e._v(e._s(e.$t("h.confirmBtn")))]),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("h.cancelBtn")))])],1)]),t("div",{staticClass:"dialog_body"},[t("div",{staticClass:"file_info"},[t("el-form",{ref:"elFormRef",attrs:{"label-width":"200px","label-position":"left",rules:e.excelIdenFormRules,inline:!0,model:e.excelIdenForm}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.advancedSearch2")+":",prop:"fileName"}},[t("el-input",{model:{value:e.excelIdenForm.fileName,callback:function(t){e.$set(e.excelIdenForm,"fileName",t)},expression:"excelIdenForm.fileName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("h.formTips20")+":",prop:"rowHeadNum"}},[t("el-input",{model:{value:e.excelIdenForm.rowHeadNum,callback:function(t){e.$set(e.excelIdenForm,"rowHeadNum",t)},expression:"excelIdenForm.rowHeadNum"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("h.formTips21")+":",prop:"rowDataNum"}},[t("el-input",{model:{value:e.excelIdenForm.rowDataNum,callback:function(t){e.$set(e.excelIdenForm,"rowDataNum",t)},expression:"excelIdenForm.rowDataNum"}})],1)],1)],1)],1),t("el-row",[t("el-col",{staticClass:"file",attrs:{span:8}},[t("span",[e._v(e._s(e.$t("h.title85"))+":")]),e._t("default")],2),t("el-col",{staticClass:"file",attrs:{span:8}},[t("el-button",{attrs:{type:"text"},on:{click:e.createTemplateTable}},[e._v(e._s(e.$t("h.title86")))])],1)],1)],1),t("div",{staticClass:"notNllAndUnqiue"},[t("el-popover",{attrs:{placement:"top-start"}},[t("div",{staticClass:"tag_box"},e._l(e.notNullHeadCheckData,(function(a){return t("el-tag",{key:a._id,attrs:{size:"small",effect:"dark"}},[e._v(e._s(a.nameShow))])})),1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"text"},slot:"reference"},[e._v(e._s(e.$t("h.title87"))+"("+e._s(e.notNullHeadCheckData.length)+") ")])],1),t("el-popover",{attrs:{placement:"top-start"}},[t("div",{staticClass:"tag_box"},e._l(e.uniqueHeadCheckData,(function(a){return t("el-tag",{key:a._id,attrs:{size:"small",effect:"dark"}},[e._v(e._s(a.nameShow))])})),1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"text"},slot:"reference"},[e._v(e._s(e.$t("h.title88"))+"("+e._s(e.uniqueHeadCheckData.length)+") ")])],1)],1),t("div",{staticClass:"edit-table"},[t("ds-table",{attrs:{loading:e.tableLoading,rowKey:e=>e._id,columns:e.loaclExcelColumns,tableConfig:e.loaclExcelConfig,tableData:e.localExcelData},scopedSlots:e._u([{key:"system",fn:function({scope:a}){return[t("el-select",{attrs:{size:"mini","value-key":"nameShow",placeholder:e.$t("h.tips4"),filterable:"",clearable:""},on:{change:t=>e.onSelectChange(t,a.row)},model:{value:a.row.systemId,callback:function(t){e.$set(a.row,"systemId",t)},expression:"scope.row.systemId"}},e._l(e.systemTableData,(function(e){return t("el-option",{key:e.dbDataName,attrs:{label:e.nameShow,value:e._id}})})),1)]}},{key:"type",fn:function({scope:a}){return[t("el-select",{attrs:{disabled:"",size:"mini"},model:{value:a.row.type,callback:function(t){e.$set(a.row,"type",t)},expression:"scope.row.type"}},e._l(e.valueType,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)]}},{key:"character",fn:function({scope:a}){return[t("el-checkbox",{attrs:{disabled:e.isSystemNotNull(a.row.dbDataName),"true-label":1,"false-label":0},model:{value:a.row.notNull,callback:function(t){e.$set(a.row,"notNull",t)},expression:"scope.row.notNull"}},[e._v(e._s(e.$t("h.title89")))]),t("el-checkbox",{attrs:{disabled:e.isSystemUnique(a.row.dbDataName),"true-label":1,"false-label":0},on:{change:t=>e.onUniqueChange(t,a.row)},model:{value:a.row.unique,callback:function(t){e.$set(a.row,"unique",t)},expression:"scope.row.unique"}},[e._v(e._s(e.$t("h.title90")))])]}},{key:"default",fn:function({scope:a}){return["String"==a.row.type||"Double"==a.row.type?t("el-input",{attrs:{disabled:1==a.row.unique,placeholder:e.$t("h.tips3")+e.$t("h.title91"),size:"mini",clearable:""},on:{change:t=>e.onDefaultValChange(t,a.row)},model:{value:a.row.defaultVal,callback:function(t){e.$set(a.row,"defaultVal",t)},expression:"scope.row.defaultVal"}}):"Date"==a.row.type?t("el-date-picker",{staticStyle:{width:"135px"},attrs:{disabled:1==a.row.unique,type:"date",size:"mini",placeholder:e.$t("h.tips4")+e.$t("h.date"),clearable:"","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate"),"value-format":"yyyy-MM-dd"},model:{value:a.row.defaultVal,callback:function(t){e.$set(a.row,"defaultVal",t)},expression:"scope.row.defaultVal"}}):t("span")]}},{key:"range",fn:function({scope:a}){return[t("span",[e._v(e._s(a.row.rangeSt)+"-"+e._s(a.row.rangeEnd))])]}}])},[t("template",{slot:"format"}),t("template",{slot:"rule"})],2)],1)])])},c=[],h=(a(57658),a(20629)),m=a(76080),p=a(83151),f=a(39622),b=a(8433),g={components:{DsTable:o.Z},data(){return{tableLoading:!1,excelIdenForm:{fileName:"",rowHeadNum:null,rowDataNum:null},excelIdenFormRules:{fileName:[{required:!0,message:this.$t("h.tips3")+this.$t("h.advancedSearch2"),trigger:"blur"}],rowHeadNum:[{required:!0,message:this.$t("h.tips3")+this.$t("h.formTips20"),trigger:"blur"}],rowDataNum:[{required:!0,message:this.$t("h.tips3")+this.$t("h.formTips21"),trigger:"blur"}]},loaclExcelConfig:{index:!0},loaclExcelColumns:p.vf,localExcelData:[],systemTableData:[],valueType:[{label:this.$t("h.tips142"),value:"String"},{label:this.$t("h.tips143"),value:"Double"},{label:this.$t("h.date"),value:"Date"}],initNotNull:[],initUnique:[]}},props:{visible:{type:Boolean,default:!1},excelFileBase64:String,excelFileName:String},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},notNullHeadCheckData(){let e=[];return this.systemTableData.forEach((t=>{if(t.notNull){const a=this.localExcelData.filter((e=>t.dbDataName==e.dbDataName)).length;a||e.push(t)}})),e},uniqueHeadCheckData(){let e=[];return this.systemTableData.forEach((t=>{if(t.unique){const a=this.localExcelData.filter((e=>t.dbDataName==e.dbDataName)).length;a||e.push(t)}})),e},...(0,h.rn)(["userInfo"])},watch:{excelFileBase64(e){""==e&&(this.localExcelData=[],this.$refs["elFormRef"].resetFields(),this.getUserAssetTableHead())}},methods:{...(0,h.nv)(["GET_ASSETFORMHEADER"]),dialogVisibleOpened(){this.getUserAssetTableHead()},dialogVisibleClosed(){this.localExcelData=[],this.systemTableData=[],this.initNotNull=[],this.initUnique=[],this.$refs["elFormRef"].resetFields(),this.$emit("dialogVisibleClosed")},isSystemNotNull(e){return"assetCode"==e||"type"==e||"name"==e||"inData"==e||"source"==e||"goodsName"==e||"num"==e||"assertPosition"==e||!e},isSystemUnique(e){return"assetCode"==e||!e},getUserAssetTableHead(){(0,m.Ys)({func:"S0048",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);e.data.item.sort(((e,t)=>e.sort-t.sort)),e.data.item.sort(((e,t)=>t.notNull-e.notNull)),e.data.item.splice(e.data.item.findIndex((e=>"photo"==e.dbDataName)),1),e.data.item.splice(e.data.item.findIndex((e=>"file"==e.dbDataName)),1),e.data.item.splice(e.data.item.findIndex((e=>"state"==e.dbDataName)),1),this.systemTableData=e.data.item.map(((e,t)=>({_id:t,colFmt:"",colName:"",colType:"",dbDataName:e.dbDataName,nameShow:e.nameShow,dbFmt:e.format,notNull:e.notNull,rangeEnd:e.rangeEnd,rangeSt:e.rangeSt,type:e.type,unique:e.unique,defaultVal:e.defaultVal}))),this.systemTableData.forEach((e=>{null==e.dbFmt&&(e.dbFmt=""),null==e.rangeSt&&(e.rangeSt=""),null==e.rangeEnd&&(e.rangeEnd=""),null==e.defaultVal&&(e.defaultVal=""),e.notNull&&this.initNotNull.push(e),e.unique&&this.initUnique.push(e)})),this.systemTableData.push({_id:this.systemTableData.length,colFmt:"",colName:"",colType:"",dbDataName:"otherData",nameShow:this.$t("h.other"),dbFmt:"",notNull:0,rangeEnd:"",rangeSt:"",type:"String",unique:0,defaultVal:""})})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},createTemplateTable(){if(!this.excelFileBase64)return this.$message.error(this.$t("h.title28"));this.excelIdenForm.fileName||(this.excelIdenForm.fileName=this.excelFileName),this.$refs["elFormRef"].validate((e=>{e&&(this.tableLoading=!0,(0,b.Z)({url:"http://127.0.0.1:7788/Service/",method:"post",params:{sendCode:"2",param:"1"},data:{inputType:"fileBase64",excelFile:this.excelFileBase64.split("base64,")[1],fileName:this.excelFileName,titleRow:this.excelIdenForm.rowHeadNum,dataRow:this.excelIdenForm.rowDataNum}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(`${this.$t("h.tips144")}:${e.code}`);const t=JSON.parse(e.message).item;this.localExcelData=t.map(((e,t)=>({_id:t,colFmt:e.format,colName:e.name,colType:e.type,dbDataName:"",dbFmt:"",defaultVal:"",nameShow:"",notNull:null,rangeEnd:null,rangeSt:null,type:"",unique:null,systemId:null})))})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips145"))})))}))},onSelectChange(e,t){if(""===e)return this.localExcelData[t._id].dbDataName="",this.localExcelData[t._id].dbFmt="",this.localExcelData[t._id].defaultVal="",this.localExcelData[t._id].nameShow="",this.localExcelData[t._id].notNull=null,this.localExcelData[t._id].rangeEnd=null,this.localExcelData[t._id].rangeSt=null,this.localExcelData[t._id].type="",this.localExcelData[t._id].unique=null,void(this.localExcelData[t._id].systemId=null);const a=this.localExcelData.filter((t=>t.systemId==e)).length;if(a>1)return this.localExcelData[t._id].systemId=null,this.$message.error(`${t.dbDataName}${this.$t("h.tips146")}`);this.localExcelData[t._id].dbDataName=this.systemTableData[e].dbDataName,this.localExcelData[t._id].dbFmt=this.systemTableData[e].dbFmt,this.localExcelData[t._id].defaultVal=this.systemTableData[e].defaultVal,this.localExcelData[t._id].nameShow=this.systemTableData[e].nameShow,this.localExcelData[t._id].notNull=this.systemTableData[e].notNull,this.localExcelData[t._id].rangeEnd=this.systemTableData[e].rangeEnd,this.localExcelData[t._id].rangeSt=this.systemTableData[e].rangeSt,this.localExcelData[t._id].type=this.systemTableData[e].type,this.localExcelData[t._id].unique=this.systemTableData[e].unique},onUniqueChange(e,t){if(e){let e=this.uniqueHeadCheckData.length;if(this.localExcelData.forEach((t=>{t.unique&&(e+=1)})),e>2)return this.localExcelData[t._id].unique=0,this.$message.error(this.$t("h.tips147"))}e&&(this.localExcelData[t._id].defaultVal="",this.localExcelData[t._id].notNull=1),e||(this.localExcelData[t._id].defaultVal=this.systemTableData[t.systemId].defaultVal,this.localExcelData[t._id].notNull=this.systemTableData[t.systemId].notNull)},onDefaultValChange(e,t){const a=t.rangeSt,l=t.rangeEnd;if("String"==t.type){if(a&&e.length<a)return this.localExcelData[t._id].defaultVal=null,this.$message.error(`${this.$t("h.tips148")}${a}`);if(l&&e.length>l)return this.localExcelData[t._id].defaultVal=null,this.$message.error(`${this.$t("h.tips149")}${l}`)}if("Double"==t.type){const i=Number(e);if(0!=i&&!i)return this.localExcelData[t._id].defaultVal=null,this.$message.error(this.$t("h.tips3")+this.$t("h.tips150"));if(a&&Number(e)<Number(a))return this.localExcelData[t._id].defaultVal=null,this.$message.error(`${this.$t("h.tips148")}${a}`);if(l&&Number(e)>Number(l))return this.localExcelData[t._id].defaultVal=null,this.$message.error(`${this.$t("h.tips149")}${l}`)}},submitTemplate(){const e=this.$loading({target:".el-dialog"});if(this.notNullHeadCheckData.length)return e.close(),this.$message.error(this.$t("h.tips151"));let t=(0,f.Z)(this.localExcelData.filter((e=>e.dbDataName)));t.forEach((e=>{delete e.nameShow,delete e._id,delete e.systemId})),(0,m.Vx)({func:"U0052",userId:this.userInfo._id,token:this.userInfo.token,requstData:{permissonId:77,fig:!0,infoType:3,colRow:this.excelIdenForm.rowHeadNum,valRow:this.excelIdenForm.rowDataNum,name:this.excelIdenForm.fileName,item:t}}).then((({data:t})=>{if(e.close(),0!=t.code)return this.$message.error(t.data);this.$message.success(t.data),this.dialogVisible=!1,this.$emit("updateExcelInfo"),this.GET_ASSETFORMHEADER()})).catch((()=>(e.close(),this.$message.error(this.$t("h.tips18")))))}}},D=g,y=a(1001),_=(0,y.Z)(D,u,c,!1,null,"59f60223",null),N=_.exports,$=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{fullscreen:"","custom-class":"edit_dialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.dialogVisibleOpened,closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog_title",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"title_left"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-back",circle:"",plain:"",size:"small"},on:{click:function(t){e.dialogVisible=!1}}}),t("span",[e._v(e._s(e.$t("h.tips152")))])],1),t("div",{staticClass:"title_right"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitEditTemplate}},[e._v(e._s(e.$t("h.confirmBtn")))]),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("h.cancelBtn")))])],1)]),t("div",{staticClass:"dialog_body"},[t("div",{staticClass:"file_info"},[t("el-form",{ref:"elFormRef",attrs:{"label-width":"110px","label-position":"left",rules:e.excelIdenFormRules,inline:!0,model:e.excelIdenForm}},[t("el-row",[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.advancedSearch2")+":",prop:"fileName"}},[t("el-input",{model:{value:e.excelIdenForm.fileName,callback:function(t){e.$set(e.excelIdenForm,"fileName",t)},expression:"excelIdenForm.fileName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.formTips20")+":",prop:"rowHeadNum"}},[t("el-input",{model:{value:e.excelIdenForm.rowHeadNum,callback:function(t){e.$set(e.excelIdenForm,"rowHeadNum",t)},expression:"excelIdenForm.rowHeadNum"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:e.$t("h.formTips21")+":",prop:"rowDataNum"}},[t("el-input",{model:{value:e.excelIdenForm.rowDataNum,callback:function(t){e.$set(e.excelIdenForm,"rowDataNum",t)},expression:"excelIdenForm.rowDataNum"}})],1)],1)],1)],1)],1),t("div",{staticClass:"notNllAndUnqiue"},[t("el-popover",{attrs:{placement:"top-start"}},[t("div",{staticClass:"tag_box"},e._l(e.notNullHeadCheckData,(function(a){return t("el-tag",{key:a._id,attrs:{size:"small",effect:"dark"}},[e._v(e._s(a.nameShow))])})),1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"text"},slot:"reference"},[e._v(e._s(e.$t("h.title87"))+"("+e._s(e.notNullHeadCheckData.length)+") ")])],1),t("el-popover",{attrs:{placement:"top-start"}},[t("div",{staticClass:"tag_box"},e._l(e.uniqueHeadCheckData,(function(a){return t("el-tag",{key:a._id,attrs:{size:"small",effect:"dark"}},[e._v(e._s(a.nameShow))])})),1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"text"},slot:"reference"},[e._v(e._s(e.$t("h.title88"))+"("+e._s(e.uniqueHeadCheckData.length)+") ")])],1)],1),t("div",{staticClass:"edit-table"},[t("ds-table",{attrs:{loading:e.tableLoading,rowKey:e=>e._id,columns:e.editColumns,tableConfig:e.editConfig,tableData:e.editTableData},scopedSlots:e._u([{key:"system",fn:function({scope:a}){return[t("el-select",{attrs:{size:"mini",placeholder:e.$t("h.tips4"),filterable:"",clearable:""},on:{change:t=>e.onSelectChange(t,a.row)},model:{value:a.row.dbDataName,callback:function(t){e.$set(a.row,"dbDataName",t)},expression:"scope.row.dbDataName"}},e._l(e.systemTableData,(function(e){return t("el-option",{key:e._id,attrs:{label:e.nameShow,value:e.dbDataName}})})),1)]}},{key:"type",fn:function({scope:a}){return[t("el-select",{attrs:{disabled:"",size:"mini"},model:{value:a.row.type,callback:function(t){e.$set(a.row,"type",t)},expression:"scope.row.type"}},e._l(e.valueType,(function(e){return t("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)]}},{key:"character",fn:function({scope:a}){return[t("el-checkbox",{attrs:{disabled:e.isSystemNotNull(a.row.dbDataName),"true-label":1,"false-label":0},model:{value:a.row.notNull,callback:function(t){e.$set(a.row,"notNull",t)},expression:"scope.row.notNull"}},[e._v(e._s(e.$t("h.title89")))]),t("el-checkbox",{attrs:{disabled:e.isSystemUnique(a.row.dbDataName),"true-label":1,"false-label":0},on:{change:t=>e.onUniqueChange(t,a.row)},model:{value:a.row.unique,callback:function(t){e.$set(a.row,"unique",t)},expression:"scope.row.unique"}},[e._v(e._s(e.$t("h.title90")))])]}},{key:"default",fn:function({scope:a}){return["String"==a.row.type||"Double"==a.row.type?t("el-input",{attrs:{placeholder:e.$t("h.tips3")+e.$t("h.title91"),size:"mini",clearable:"",disabled:1==a.row.unique},model:{value:a.row.defaultVal,callback:function(t){e.$set(a.row,"defaultVal",t)},expression:"scope.row.defaultVal"}}):"Date"==a.row.type?t("el-date-picker",{staticStyle:{width:"139px"},attrs:{disabled:1==a.row.unique,type:"date",size:"mini",placeholder:e.$t("h.tips4")+e.$t("h.date"),clearable:"","range-separator":e.$t("h.to"),"start-placeholder":e.$t("h.startDate"),"end-placeholder":e.$t("h.endDate"),"value-format":"yyyy-MM-dd"},model:{value:a.row.defaultVal,callback:function(t){e.$set(a.row,"defaultVal",t)},expression:"scope.row.defaultVal"}}):t("span")]}},{key:"range",fn:function({scope:a}){return[t("span",[e._v(e._s(a.row.rangeSt)+"-"+e._s(a.row.rangeEnd))])]}}])},[t("template",{slot:"format"}),t("template",{slot:"rule"})],2)],1)])])},x=[],v={components:{DsTable:o.Z},data(){return{excelIdenForm:{fileName:"",rowHeadNum:null,rowDataNum:null},excelIdenFormRules:{fileName:[{required:!0,message:this.$t("h.tips3")+this.$t("h.advancedSearch2"),trigger:"blur"}],rowHeadNum:[{required:!0,message:this.$t("h.tips3")+this.$t("h.formTips20"),trigger:"blur"}],rowDataNum:[{required:!0,message:this.$t("h.tips3")+this.$t("h.formTips21"),trigger:"blur"}]},valueType:[{label:this.$t("h.tips142"),value:"String"},{label:this.$t("h.tips143"),value:"Double"},{label:this.$t("h.date"),value:"Date"}],tableLoading:!1,editConfig:{index:!0},editColumns:p.vf,editTableData:[],systemTableData:[],initNotNull:[],initUnique:[]}},props:{visible:{type:Boolean,default:!1},templateEditTableData:{type:Array,default(){return[]}}},computed:{...(0,h.rn)(["userInfo"]),dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},notNullHeadCheckData(){let e=[];return this.systemTableData.forEach((t=>{if(t.notNull){const a=this.editTableData.filter((e=>t.dbDataName==e.dbDataName)).length;a||e.push(t)}})),e},uniqueHeadCheckData(){let e=[];return this.systemTableData.forEach((t=>{if(t.unique){const a=this.editTableData.filter((e=>t.dbDataName==e.dbDataName)).length;a||e.push(t)}})),e}},methods:{...(0,h.nv)(["GET_ASSETFORMHEADER"]),dialogVisibleOpened(){this.getUserAssetTableHead(),this.editTableData=this.templateEditTableData[0].content.item,this.editTableData.forEach(((e,t)=>e._id=t)),this.excelIdenForm.fileName=this.templateEditTableData[0].content.name,this.excelIdenForm.rowHeadNum=this.templateEditTableData[0].content.colRow,this.excelIdenForm.rowDataNum=this.templateEditTableData[0].content.valRow},dialogVisibleClosed(){this.editTableData=[],this.systemTableData=[],this.initNotNull=[],this.initUnique=[],this.$refs["elFormRef"].resetFields(),this.$emit("dialogVisibleClosed")},onSelectChange(e,t){if(""===e)return this.editTableData[t._id].dbFmt="",this.editTableData[t._id].defaultVal="",this.editTableData[t._id].notNull=null,this.editTableData[t._id].rangeEnd=null,this.editTableData[t._id].rangeSt=null,this.editTableData[t._id].type="",void(this.editTableData[t._id].unique=null);let a=this.editTableData.filter((t=>t.dbDataName==e)).length;if(a>1)return this.editTableData[t._id].dbDataName="",this.$message.error(`${this.$t("h.tips146")}`);const l=this.systemTableData.find((t=>t.dbDataName==e));this.editTableData[t._id].dbDataName=l.dbDataName,this.editTableData[t._id].dbFmt=l.dbFmt,this.editTableData[t._id].defaultVal=l.defaultVal,this.editTableData[t._id].notNull=l.notNull,this.editTableData[t._id].rangeEnd=l.rangeEnd,this.editTableData[t._id].rangeSt=l.rangeSt,this.editTableData[t._id].type=l.type,this.editTableData[t._id].unique=l.unique},onUniqueChange(e,t){if(e){let e=this.uniqueHeadCheckData.length;if(this.editTableData.forEach((t=>{t.unique&&(e+=1)})),e>2)return this.editTableData[t._id].unique=0,this.$message.error(this.$t("h.tips147"))}if(e&&(this.editTableData[t._id].defaultVal="",this.editTableData[t._id].notNull=1),!e){const e=this.systemTableData.find((e=>e.dbDataName==t.dbDataName));this.editTableData[t._id].defaultVal=e.defaultVal,this.editTableData[t._id].notNull=e.notNull}},isSystemNotNull(e){return"assetCode"==e||"type"==e||"name"==e||"inData"==e||"source"==e||"goodsName"==e||"num"==e||"assertPosition"==e||!e},isSystemUnique(e){return"assetCode"==e||!e},getUserAssetTableHead(){(0,m.Ys)({func:"S0048",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);e.data.item.sort(((e,t)=>e.sort-t.sort)),e.data.item.sort(((e,t)=>t.notNull-e.notNull)),e.data.item.splice(e.data.item.findIndex((e=>"photo"==e.dbDataName)),1),e.data.item.splice(e.data.item.findIndex((e=>"file"==e.dbDataName)),1),e.data.item.splice(e.data.item.findIndex((e=>"state"==e.dbDataName)),1),this.systemTableData=e.data.item.map(((e,t)=>({_id:t,colFmt:"",colName:"",colType:"",dbDataName:e.dbDataName,nameShow:e.nameShow,dbFmt:e.format,notNull:e.notNull,rangeEnd:e.rangeEnd,rangeSt:e.rangeSt,type:e.type,unique:e.unique,defaultVal:e.defaultVal}))),this.systemTableData.push({_id:this.systemTableData.length,colFmt:"",colName:"",colType:"",dbDataName:"otherData",nameShow:this.$t("h.other"),dbFmt:"",notNull:0,rangeEnd:"",rangeSt:"",type:"String",unique:0,defaultVal:""}),this.systemTableData.forEach((e=>{null==e.dbFmt&&(e.dbFmt=""),null==e.rangeSt&&(e.rangeSt=""),null==e.rangeEnd&&(e.rangeEnd=""),null==e.defaultVal&&(e.defaultVal=""),e.notNull&&this.initNotNull.push(e),e.unique&&this.initUnique.push(e)}))})).catch((()=>{this.$message.error(this.$t("h.tips18"))}))},submitEditTemplate(){const e=this.$loading({target:".edit_dialog"});return this.notNullHeadCheckData.length?(e.close(),this.$message.error(this.$t("h.tips153"))):"默认模板"==this.templateEditTableData[0].content.name?(e.close(),this.$message.error(this.$t("h.tips154"))):void this.$refs["elFormRef"].validate((t=>{if(!t)return;let a=(0,f.Z)(this.editTableData.filter((e=>e.dbDataName)));a.forEach((e=>delete e._id)),(0,m.Vx)({func:"U0052",userId:this.userInfo._id,token:this.userInfo.token,requstData:{permissonId:77,fig:!1,infoType:3,dbSize:this.templateEditTableData[0].content.dbSize,colRow:this.excelIdenForm.rowHeadNum,valRow:this.excelIdenForm.rowDataNum,aname:this.templateEditTableData[0].content.name,name:this.excelIdenForm.fileName,item:a}}).then((({data:t})=>{if(e.close(),0!=t.code)return this.$message.error(t.data);this.$message.success(t.data),this.dialogVisible=!1;const a=setTimeout((()=>{clearTimeout(a),this.$emit("updateExcelInfo"),this.GET_ASSETFORMHEADER()}),1e3)})).catch((()=>{e.close(),this.$message.error(this.$t("h.tips18"))}))}))}}},w=v,T=(0,y.Z)(w,$,x,!1,null,"7a5eca0e",null),S=T.exports,E={components:{DsTable:o.Z,DsPagination:r.Z,DsQueryForm:s.Z,DsQueryFormLeftPanel:n.Z,UploadExcelBase64:d.Z,EditBillsDialog:S,NewBillsDialog:N},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},tableLoading:!1,tempTableConfig:{selection:!0,reserveSelection:!0},templateColumns:p.wU,templateBills:[],selectTemplateBills:[],newDialogVisible:!1,excelFile:{value:"",name:""},editDialogVisible:!1,editTableData:[]}},computed:{...(0,h.rn)(["userInfo"])},methods:{getTemplateBills(){this.tableLoading=!0,(0,m.Ys)({func:"S0045",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.templateBills=Object.keys(e.data).map((t=>e.data[t]?{name:t.replace(".txt",""),content:JSON.parse(e.data[t])}:{name:t.replace(".txt",""),content:e.data[t]})),this.total=this.templateBills.length})).catch((()=>{this.tableLoading=!1,this.$message.error(this.$t("h.tips18"))}))},handleSelectionChange(e){this.selectTemplateBills=e},newDialogVisibleClosed(){this.excelFile.value="",this.excelFile.name=""},editDialogVisbileClosed(){this.editTableData=[],this.$refs.tableRef.$refs["dsTableRef"].clearSelection()},editTemplate(){return this.selectTemplateBills.length?this.selectTemplateBills.length>1?this.$message.error(this.$t("h.tips87")):(this.editTableData=JSON.parse(JSON.stringify(this.selectTemplateBills)),void(this.editDialogVisible=!0)):this.$message.error(this.$t("h.tips22"))},deteleTemplate(){if(!this.selectTemplateBills.length)return this.$message.error(this.$t("h.tips22"));this.tableLoading=!0;const e=this.selectTemplateBills.map((e=>e.name));(0,m.SR)({func:"D0026",userId:this.userInfo._id,token:this.userInfo.token,requstData:{permissonId:77,name:e}}).then((({data:e})=>{if(this.tableLoading=!1,0!=e.code)return this.$message.error(e.data);this.$message.success(e.data),this.$refs["tableRef"].$refs["dsTableRef"].clearSelection();let t=setTimeout((()=>{clearTimeout(t),this.getTemplateBills()}),500)})).catch((e=>(console.log(e),this.tableLoading=!1,this.$message.error(this.$t("h.tips18")))))}},created(){this.getTemplateBills()}},F=E,C=(0,y.Z)(F,l,i,!1,null,"7acb7abb",null),k=C.exports},39622:function(e,t){function a(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function l(e,t=new WeakMap){if("symbol"===typeof e)return Symbol(e.description);if(!a(e))return e;if(e instanceof Set){const t=new Set;for(const a of e)t.add(l(a));return t}if(e instanceof Map){const t=new Map;for(const a of e)t.set(a[0],a[1]);return t}if("function"===typeof e)return e;if(t.get(e))return t.get(e);const i=Array.isArray(e)?[]:{};t.set(e,i);for(const a in e)i[a]=l(e[a],t);const s=Object.getOwnPropertySymbols(e);for(const a of s)i[Symbol(a.description)]=l(e[a],t);return i}t["Z"]=l}}]);