"use strict";(self["webpackChunk_4010_assetweb"]=self["webpackChunk_4010_assetweb"]||[]).push([[3493],{42041:function(e,t,s){s.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"dialog",fullscreen:"",visible:e.dialogVisible,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.dialogVisibleOpened,close:e.dialogVisibleClose,closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left",circle:""},on:{click:function(t){e.dialogVisible=!1}}}),t("span",{staticClass:"title"},[e._v(e._s(e.title))])],1),t("div",{staticClass:"right"},[t("el-button",{attrs:{size:"small"},on:{click:e.cancalFrom}},[e._v(e._s(e.$t("h.cancelBtn")))]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.sbumitForm}},[e._v(e._s(e.$t("h.confirmBtn")))])],1)]),t("div",{ref:"dialogbodyRef",staticClass:"dialog-body"},[t("div",{staticClass:"content",style:"width:"+e.contentWidth},[t("div",{staticClass:"form-label"},[e._t("form")],2),t("div",{staticClass:"table-label"},[t("div",{staticClass:"table-label-head"},[e._t("btns")],2),t("div",{staticClass:"table-label-content"},[e._t("table")],2)])])])])},l=[],a=s(63042),o={data(){return{}},props:{title:{type:String,default:a.a.t("h.title12")},newBillsDialogVisible:{type:Boolean,default:!1},contentWidth:{type:String,default:"950px"}},computed:{dialogVisible:{get(){return this.newBillsDialogVisible},set(e){this.$emit("update:newBillsDialogVisible",e)}}},methods:{cancalFrom(){this.dialogVisible=!1},sbumitForm(){this.$emit("sbumitForm")},dialogVisibleClose(){this.$emit("close"),this.$refs.dialogbodyRef.scrollTop=0},dialogVisibleClosed(){this.$emit("closed")},dialogVisibleOpened(){this.$emit("opened")}}},r=o,n=s(1001),d=(0,n.Z)(r,i,l,!1,null,"130c4832",null),c=d.exports},98884:function(e,t,s){s.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"0","custom-class":"dialog","show-close":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.dialogVisibleClosed}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[t("div",{staticClass:"left"},[t("span",[e._v(e._s(e.title))])]),t("div",{staticClass:"right"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){e.dialogVisible=!1}}})])]),t("div",{staticClass:"dialog-body"},[t("ds-table",{attrs:{tableData:e.deleteErrorData,columns:e.deleteColumns,tableConfig:e.errorTableConfig}})],1)])},l=[],a=s(60983),o={components:{DsTable:a.Z},data(){return{errorTableConfig:{index:!0}}},props:{deleteDialogVisible:{type:Boolean,default:!1},deleteErrorData:{type:Array,default:()=>[]},deleteColumns:{type:Array},title:{type:String,default:"删除失败详情"}},computed:{dialogVisible:{get(){return this.deleteDialogVisible},set(e){this.$emit("update:deleteDialogVisible",e)}}},methods:{dialogVisibleClosed(){this.$emit("closed")}}},r=o,n=s(1001),d=(0,n.Z)(r,i,l,!1,null,"3e3e8f93",null),c=d.exports},93082:function(e,t,s){s.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-pagination"},[t("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},l=[],a={name:"DsPagination",data(){return{}},props:{total:{required:!0,type:Number},pageSizes:{type:Array,default(){return[20,50,100]}},page:{type:Number,default:1},limit:{type:Number,default:20},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e})},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize})}}},o=a,r=s(1001),n=(0,r.Z)(o,i,l,!1,null,"2377c114",null),d=n.exports},92003:function(e,t,s){s.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"left-panel"},[e._t("default")],2)},l=[],a={name:"DsQueryFormLeftPanel"},o=a,r=s(1001),n=(0,r.Z)(o,i,l,!1,null,"71d76034",null),d=n.exports},19698:function(e,t,s){s.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ds-query-form"},[e._t("default")],2)},l=[],a={name:"DsQueryForm"},o=a,r=s(1001),n=(0,r.Z)(o,i,l,!1,null,"6c8bfb78",null),d=n.exports},96222:function(e,t,s){s.r(t),s.d(t,{default:function(){return $}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"roles"},[t("el-card",{staticClass:"roles-card"},[t("div",{staticClass:"roles-card-header",attrs:{slot:"header"},slot:"header"},[t("ds-query-form",[t("ds-query-form-left-panel",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.newRolesForm}},[e._v(e._s(e.$t("h.newBtn")))]),t("el-button",{attrs:{size:"mini"},on:{click:e.deleteRoles}},[e._v(e._s(e.$t("h.delBtn")))])],1)],1)],1),t("div",{staticClass:"roles-card-content"},[t("div",{staticClass:"bills-table"},[t("ds-table",{ref:"billsTableRef",attrs:{loading:e.loading,tableConfig:e.billsTableConfig,columns:e.billsColums,tableData:e.rolesBills.slice((e.paginationForm.currentPage-1)*e.paginationForm.pageSize,e.paginationForm.currentPage*e.paginationForm.pageSize),rowKey:e=>e._id},on:{handleSelectionChange:e.handleSelectionChange},scopedSlots:e._u([{key:"operation",fn:function({scope:s}){return[t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.editRolesForm(s.row)}}},[e._v(e._s(e.$t("h.editBtn")))]),t("span",{staticClass:"line"}),t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteRolesForm(s.row)}}},[e._v(e._s(e.$t("h.delBtn")))])]}}])})],1),t("div",{staticClass:"bills-pagination"},[t("ds-pagination",{attrs:{small:"",total:e.total,page:e.paginationForm.currentPage,limit:e.paginationForm.pageSize},on:{"update:page":function(t){return e.$set(e.paginationForm,"currentPage",t)},"update:limit":function(t){return e.$set(e.paginationForm,"pageSize",t)}}})],1)])]),t("new-bills-dialog",{staticClass:"new-bill-dialog",attrs:{title:e.newBillTitle,newBillsDialogVisible:e.newBillsDialogVisible},on:{"update:newBillsDialogVisible":function(t){e.newBillsDialogVisible=t},"update:new-bills-dialog-visible":function(t){e.newBillsDialogVisible=t},opened:e.newBillsDialogOpened,closed:e.newBillsDialogClosed,sbumitForm:e.sbumitRolesForm}},[t("template",{slot:"form"},[t("el-form",{ref:"rolesFormRef",attrs:{"label-width":"130px",model:e.rolesForm,rules:e.rolesFormRules}},[t("el-form-item",{attrs:{label:e.$t("h.roleName"),prop:"rolesName"}},[t("el-input",{model:{value:e.rolesForm.rolesName,callback:function(t){e.$set(e.rolesForm,"rolesName",t)},expression:"rolesForm.rolesName"}})],1)],1),t("div",{staticClass:"permissons-tree"},[t("el-tree",{ref:"treeRef",attrs:{"node-key":"id","show-checkbox":"","default-expand-all":"",data:e.rolesPermissons,props:e.rolesPermissonsProps,"default-checked-keys":e.defKeys},scopedSlots:e._u([{key:"default",fn:function({node:s}){return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(e.$t(`h.${s.label}`)))])])}}])})],1)],1)],2),t("ds-delete-detail",{attrs:{deleteDialogVisible:e.deleteDialogVisible,deleteColumns:e.deleteColumns,deleteErrorData:e.deleteErrorData},on:{"update:deleteDialogVisible":function(t){e.deleteDialogVisible=t},"update:delete-dialog-visible":function(t){e.deleteDialogVisible=t},closed:e.deleteDialogVisibleClosed}})],1)},l=[],a=(s(57658),s(60983)),o=s(93082),r=s(19698),n=s(92003),d=s(42041),c=s(98884),u=s(83151),h=s(20629),g=s(76080),m={components:{DsTable:a.Z,DsPagination:o.Z,DsQueryForm:r.Z,DsQueryFormLeftPanel:n.Z,NewBillsDialog:d.Z,DsDeleteDetail:c.Z},data(){return{total:0,paginationForm:{currentPage:1,pageSize:20},loading:!1,billsTableConfig:{selection:!0,reserveSelection:!0},billsColums:u.iy,rolesBills:[],selectRolesBills:[],rolesPermissons:[],rolesPermissonsProps:{label:"name",children:"children"},defKeys:[],newBillsDialogVisible:!1,newBillTitle:this.$t("h.title100"),dialogLoading:{target:".new-bill-dialog",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"},rolesForm:{_id:"",rolesName:""},rolesFormRules:{rolesName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},deleteDialogVisible:!1,deleteColumns:u.z0,deleteErrorData:[]}},computed:{...(0,h.rn)(["userInfo"])},methods:{getRolesBills(){this.loading=!0,(0,g.Ys)({func:"S0002",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(this.loading=!1,0!=e.code)return this.$message.error(e.data);this.total=e.data.length,this.rolesBills=e.data})).catch((()=>{this.loading=!1,this.$message.error("服务器网络异常，查询角色列表失败")}))},getRolesPermissons(){(0,g.Ys)({func:"S0020",userId:this.userInfo._id,token:this.userInfo.token,requstData:{}}).then((({data:e})=>{if(0!=e.code)return this.$message.error(e.data);this.rolesPermissons=e.data})).catch((()=>{this.$message.error("服务器网络错误，查询权限列表失败")}))},handleSelectionChange(e){this.selectRolesBills=e},newRolesForm(){this.rolesPermissons=JSON.parse(JSON.stringify(this.rolesPermissons)),this.newBillsDialogVisible=!0},editRolesForm(e){this.rolesPermissons=JSON.parse(JSON.stringify(this.rolesPermissons)),this.getDefKefs(e.menuList,this.defKeys),this.rolesForm._id=e._id,this.rolesForm.rolesName=e.roleName,this.newBillTitle=this.$t("h.title101"),this.newBillsDialogVisible=!0},deleteRolesForm(e){this.$confirm(this.$t("h.tips167"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).then((()=>{if(1==e._id)return this.$message.error(this.$t("h.tips168"));this.loading=!0,(0,g.SR)({func:"D0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:e._id,permissonId:54}}).then((({data:e})=>{if(0!=e.code)return this.loading=!1,this.$message.error(e.data);this.getRolesBills(),this.$message.success({message:this.$t("h.tips128")})})).catch((()=>{this.loading=!1,this.$message.error(this.$t("h.tips18"))}))})).catch((()=>{this.$message({type:"info",message:this.$t("h.tips98")})}))},async deleteRoles(){if(!this.selectRolesBills.length)return this.$message.error(this.$t("h.tips162"));const e=await this.$confirm(this.$t("h.tips163"),this.$t("h.title18"),{confirmButtonText:this.$t("h.confirmBtn"),cancelButtonText:this.$t("h.cancelBtn"),type:"warning"}).catch((e=>e));if("cancel"===e)return this.$message.info(this.$t("h.tips98"));this.loading=!0,this.deleteErrorData=[],this.multiDeleteRole(0)},multiDeleteRole(e){if(e>this.selectRolesBills.length-1)return this.paginationForm.currentPage=1,this.getRolesBills(),this.$refs["billsTableRef"].$refs["dsTableRef"].clearSelection(),void(this.deleteErrorData.length?this.deleteDialogVisible=!0:this.$message.success(this.$t("h.tips98")));(0,g.SR)({func:"D0005",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.selectRolesBills[e]._id,permissonId:54}}).then((({data:t})=>{0!=t.code&&this.deleteErrorData.push({name:this.selectRolesBills[e].roleName,reason:t.data}),this.multiDeleteRole(++e)})).catch((()=>{this.deleteErrorData.push({name:this.selectRolesBills[e].roleName,reason:this.$t("h.tips18")}),this.multiDeleteRole(++e)}))},newBillsDialogOpened(){this.$refs.rolesFormRef.clearValidate(),this.$refs.billsTableRef.$refs.dsTableRef.clearSelection()},newBillsDialogClosed(){this.defKeys=[],this.rolesForm.rolesName="",this.rolesForm._id="",this.newBillTitle=this.$t("h.title100")},sbumitRolesForm(){this.$refs.rolesFormRef.validate((e=>{if(!e)return!1;const t=this.$loading(this.dialogLoading),s=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedKeys()],i=""==this.rolesForm._id?53:55;(0,g.Vx)({func:"U0014",userId:this.userInfo._id,token:this.userInfo.token,requstData:{_id:this.rolesForm._id,roleName:this.rolesForm.rolesName,pid:s.join(","),permissonId:i}}).then((({data:e})=>{if(t.close(),0!=e.code)return this.$message.error(e.data);this.newBillsDialogVisible=!1,this.getRolesBills(),this.$message.success(e.data)})).catch((()=>{t.close(),this.$message.error(this.$t("h.tips18"))}))}))},getDefKefs(e,t){if(e)for(let s=0;s<e.length;s++){let i=e[s];i.children?this.getDefKefs(i.children,t):t.push(i.id)}else t=[]},deleteDialogVisibleClosed(){this.deleteErrorData=[]}},created(){this.getRolesBills(),this.getRolesPermissons()}},f=m,p=s(1001),b=(0,p.Z)(f,i,l,!1,null,"36d0bb06",null),$=b.exports}}]);